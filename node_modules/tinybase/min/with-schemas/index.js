const e=e=>typeof e,t="",s=e(t),n=e(!0),o=e(0),l=e(e),r="type",a="default",i="Listener",c="Result",d="add",u="Has",g="Ids",h="Table",f=h+"s",I=h+g,b="Row",w=b+"Count",L=b+g,C="Sorted"+b+g,R="Cell",T=R+g,v="Value",p=v+"s",S=v+g,y=e=>t+e,V=(e,t)=>e.startsWith(t),M=(e,t)=>e.endsWith(t),m=(e,s=t,n)=>e.split(s,n),E=globalThis,k=Math,D=k.max,H=k.min,J=k.floor,x=isFinite,F=e=>null==e,Q=(e,t,s)=>F(e)?s?.():t(e),z=e=>e==s||e==n,N=t=>e(t)==s,O=t=>e(t)==l,W=e=>Array.isArray(e),A=(e,t,s)=>e.slice(t,s),P=e=>e.length,_=()=>{},j=(e,t)=>e.includes(t),B=(e,t)=>e.every(t),U=(e,t)=>P(e)===P(t)&&B(e,((e,s)=>t[s]===e)),q=(e,t)=>B(e,((s,n)=>0==n||t(e[n-1],s)<=0)),G=(e,t)=>e.sort(t),K=(e,t)=>e.forEach(t),X=(e,t)=>e.map(t),Y=e=>$(e,((e,t)=>e+t),0),Z=e=>0==P(e),$=(e,t,s)=>e.reduce(t,s),ee=(e,...t)=>e.push(...t),te=e=>e.pop(),se=e=>e.shift(),ne=Object,oe=e=>ne.getPrototypeOf(e),le=ne.entries,re=ne.isFrozen,ae=e=>!F(e)&&Q(oe(e),(e=>e==ne.prototype||F(oe(e))),(()=>!0)),ie=ne.keys,ce=ne.freeze,de=(e=[])=>ne.fromEntries(e),ue=(e,t)=>t in e,ge=(e,t)=>(delete e[t],e),he=(e,t)=>K(le(e),(([e,s])=>t(s,e))),fe=(e,t)=>X(le(e),(([e,s])=>t(s,e))),Ie=e=>ae(e)&&0==(e=>P(ie(e)))(e),be=(e,t,s)=>(ue(e,t)||(e[t]=s()),e[t]),we=(e,t,s,n=0)=>F(e)||!ae(e)||!n&&Ie(e)||re(e)?(s?.(),!1):(fe(e,((s,n)=>{t(s,n)||ge(e,n)})),!!n||!Ie(e)),Le=e=>t=>$(ye(t),((t,s)=>t+e(s)),0),Ce=e=>e?.size??0,Re=Le(Ce),Te=Le(Re),ve=Le(Te),pe=(e,t)=>e?.has(t)??!1,Se=e=>F(e)||0==Ce(e),ye=e=>[...e?.values()??[]],Ve=e=>e.clear(),Me=(e,t)=>e?.forEach(t),me=(e,t)=>e?.delete(t),Ee=e=>new Map(e),ke=e=>[...e?.keys()??[]],De=(e,t)=>e?.get(t),He=(e,t)=>Me(e,((e,s)=>t(s,e))),Je=(e,t,s)=>F(s)?(me(e,t),e):e?.set(t,s),xe=(e,t,s,n)=>(pe(e,t)?n?.(De(e,t)):Je(e,t,s()),De(e,t)),Fe=(e,t,s,n=Je)=>(fe(t,((t,n)=>s(e,n,t))),He(e,(s=>ue(t,s)?0:n(e,s))),e),Qe=(e,t,s,n)=>{const o={};return Me(e,((e,l)=>{if(!s?.(e,l)){const s=t?t(e,l):e;n?.(s)||(o[l]=s)}})),o},ze=(e,t,s)=>Qe(e,(e=>Qe(e,t,s)),Se,Ie),Ne=(e,t,s)=>Qe(e,(e=>ze(e,t,s)),Se,Ie),Oe=(e,t)=>{const s=Ee();return Me(e,((e,n)=>s.set(n,t?.(e)??e))),s},We=e=>Oe(e,Oe),Ae=e=>Oe(e,We),Pe=(e,t,s,n,o=0)=>Q((s?xe:De)(e,t[o],o>P(t)-2?s:Ee),(l=>{if(o>P(t)-2)return n?.(l)&&Je(e,t[o]),l;const r=Pe(l,t,s,n,o+1);return Se(l)&&Je(e,t[o]),r})),_e=t=>{const s=e(t);return z(s)||s==o&&x(t)?s:void 0},je=e=>F(e)||!F(_e(e)),Be=(e,t,s,n,o)=>F(o)?e.delCell(t,s,n,!0):e.setCell(t,s,n,o),Ue=(e,t,s)=>F(s)?e.delValue(t):e.setValue(t,s),qe=e=>new Set(W(e)||F(e)?e:[e]),Ge=(e,t)=>e?.add(t),Ke=(e,t,s,n,o)=>{const l=e.hasRow,r=Ee(),a=Ee(),i=Ee(),c=Ee(),d=Ee(),u=Ee(),g=(t,s,...n)=>{const o=xe(u,t,qe);return K(n,(t=>Ge(o,t)&&s&&e.callListener(t))),n},h=(t,...s)=>Q(De(u,t),(n=>{K(Z(s)?ye(n):s,(t=>{e.delListener(t),me(n,t)})),Se(n)&&Je(u,t)})),f=(e,s)=>{Je(r,e,s),pe(a,e)||(Je(a,e,t()),Je(c,e,Ee()),Je(d,e,Ee()),o(i))},I=e=>{Je(r,e),Je(a,e),Je(c,e),Je(d,e),h(e),o(i)};return[()=>e,()=>ke(r),e=>He(a,e),e=>pe(a,e),e=>De(r,e),e=>De(a,e),(e,t)=>Je(a,e,t),f,(t,n,o,r,a)=>{f(t,n);const i=Ee(),u=Ee(),I=De(c,t),b=De(d,t),w=t=>{const o=s=>e.getCell(n,t,s),c=De(I,t),d=l(n,t)?s(r(o,t)):void 0;if(c===d||W(c)&&W(d)&&U(c,d)||Je(i,t,[c,d]),!F(a)){const e=De(b,t),s=l(n,t)?a(o,t):void 0;e!=s&&Je(u,t,s)}},L=e=>{o((()=>{Me(i,(([,e],t)=>Je(I,t,e))),Me(u,((e,t)=>Je(b,t,e)))}),i,u,I,b,e),Ve(i),Ve(u)};He(I,w),e.hasTable(n)&&K(e.getRowIds(n),(e=>{pe(I,e)||w(e)})),L(!0),h(t),g(t,0,e.addRowListener(n,null,((e,t,s)=>w(s))),e.addTableListener(n,(()=>L())))},I,e=>n(e,i),()=>He(u,I),g,h]},Xe=(e,s)=>N(e)?t=>t(e):e??(()=>s??t),Ye=(e,t)=>{const s=new WeakMap;return n=>{s.has(n)||s.set(n,e(n));const o=s.get(n);return t?.(o),o}},Ze=/^\d+$/,$e=()=>{const e=[];let s=0;return[n=>(n?se(e):null)??t+s++,t=>{Ze.test(t)&&P(e)<1e3&&ee(e,t)}]},et=e=>{let s;const[n,o]=$e(),l=Ee();return[(o,r,a,i=[],c=()=>[])=>{s??=e();const d=n(1);return Je(l,d,[o,r,a,i,c]),Ge(Pe(r,a??[t],qe),d),d},(e,n,...o)=>K(((e,s=[t])=>{const n=[],o=(e,t)=>t==P(s)?ee(n,e):null===s[t]?Me(e,(e=>o(e,t+1))):K([s[t],null],(s=>o(De(e,s),t+1)));return o(e,0),n})(e,n),(e=>Me(e,(e=>De(l,e)[0](s,...n??[],...o))))),e=>Q(De(l,e),(([,s,n])=>(Pe(s,n??[t],void 0,(t=>(me(t,e),Se(t)?1:0))),Je(l,e),o(e),n))),e=>Q(De(l,e),(([e,,t=[],n,o])=>{const l=(...r)=>{const a=P(r);a==P(t)?e(s,...r,...o(r)):F(t[a])?K(n[a]?.(...r)??[],(e=>l(...r,e))):l(...r,t[a])};l()}))]},tt=Ye((e=>{let s,n,o,l=100,r=Ee(),a=Ee(),i=1;const c=Ee(),d=Ee(),[u,g,h]=et((()=>J)),f=Ee(),I=Ee(),b=[],w=[],L=(t,s)=>{i=0,e.transaction((()=>{const[n,o]=De(f,s);Me(n,((s,n)=>Me(s,((s,o)=>Me(s,((s,l)=>Be(e,n,o,l,s[t]))))))),Me(o,((s,n)=>Ue(e,n,s[t])))})),i=1},C=e=>{Je(f,e),Je(I,e),g(d,[e])},R=(e,t)=>K(((e,t)=>e.splice(0,t))(e,t??P(e)),C),T=()=>R(b,P(b)-l),v=()=>Q(s,(()=>{ee(b,s),T(),R(w),s=void 0,o=1})),p=()=>{s=te(b),o=1};let S,y;const V=(e=t)=>(F(s)&&(s=t+n++,Je(f,s,[r,a]),D(s,e),r=Ee(),a=Ee(),o=1),s),M=()=>{Z(b)||(((e,...t)=>{e.unshift(...t)})(w,V()),L(0,s),s=te(b),o=1)},m=()=>{Z(w)||(ee(b,s),s=se(w),L(1,s),o=1)},E=()=>{o&&(g(c),o=0)},k=e=>{const t=V(e);return E(),t},D=(e,t)=>(H(e)&&De(I,e)!==t&&(Je(I,e,t),g(d,[e])),J),H=e=>pe(f,e),J={setSize:e=>(l=e,T(),J),addCheckpoint:k,setCheckpoint:D,getStore:()=>e,getCheckpointIds:()=>[[...b],s,[...w]],forEachCheckpoint:e=>He(I,e),hasCheckpoint:H,getCheckpoint:e=>De(I,e),goBackward:()=>(M(),E(),J),goForward:()=>(m(),E(),J),goTo:e=>{const t=j(b,e)?M:j(w,e)?m:null;for(;!F(t)&&e!=s;)t();return E(),J},addCheckpointIdsListener:e=>u(e,c),addCheckpointListener:(e,t)=>u(t,d,[e]),delListener:e=>(h(e),J),clear:()=>(R(b),R(w),F(s)||C(s),s=void 0,n=0,k(),J),clearForward:()=>(Z(w)||(R(w),g(c)),J),destroy:()=>{e.delListener(S),e.delListener(y)},getListenerStats:()=>({checkpointIds:Re(c),checkpoint:Re(d)}),_registerListeners:()=>{S=e.addCellListener(null,null,null,((e,t,s,n,o,l)=>{if(i){v();const e=xe(r,t,Ee),a=xe(e,s,Ee),i=xe(a,n,(()=>[l,void 0]));i[1]=o,i[0]===o&&Se(Je(a,n))&&Se(Je(e,s))&&Se(Je(r,t))&&p(),E()}})),y=e.addValueListener(null,((e,t,s,n)=>{if(i){v();const e=xe(a,t,(()=>[n,void 0]));e[1]=s,e[0]===s&&Se(Je(a,t))&&p(),E()}}))}};return ce(J.clear())}),(e=>e._registerListeners())),st=m("-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz"),nt=Ee(X(st,((e,t)=>[e,t]))),ot=e=>st[63&e],lt=(e,t)=>De(nt,e[t])??0,rt=E.crypto?e=>E.crypto.getRandomValues(e):e=>X(e,(()=>J(256*k.random()))),at=(e,t)=>(e??0)<(t??0)?-1:1,it=(e=16)=>$(rt(new Uint8Array(e)),((e,t)=>e+ot(t)),""),ct=Ye((e=>{const s=Ee(),n=Ee(),[o,l,r]=et((()=>C)),[a,i,c,d,u,g,h,,f,I,b,w]=Ke(e,Ee,(e=>F(e)?t:W(e)?X(e,y):y(e)),o,l),L=(t,s,n)=>{const o=u(t);Me(n,((t,n)=>s(n,(s=>Me(t,(t=>s(t,(s=>e.forEachCell(o,t,s)))))))))},C={setIndexDefinition:(e,t,o,r,a,i=at)=>{const c=F(a)?void 0:([e],[t])=>a(e,t);return f(e,t,((t,o,a,d,u,f)=>{let I=0;const b=qe(),w=qe(),L=g(e);if(Me(o,(([e,t],s)=>{const n=qe(e),o=qe(t);Me(n,(e=>me(o,e)?me(n,e):0)),Me(n,(e=>{Ge(b,e),Q(De(L,e),(t=>{me(t,s),Se(t)&&(Je(L,e),I=1)}))})),Me(o,(e=>{Ge(b,e),pe(L,e)||(Je(L,e,qe()),I=1),Ge(De(L,e),s),F(r)||Ge(w,e)}))})),t(),Se(u)||(f?He(L,(e=>Ge(w,e))):He(a,(e=>Q(De(d,e),(e=>Ge(w,e))))),Me(w,(e=>{const t=(t,s)=>i(De(u,t),De(u,s),e),s=[...De(L,e)];q(s,t)||(Je(L,e,qe(G(s,t))),Ge(b,e))}))),(I||f)&&!F(c)){const t=[...L];q(t,c)||(h(e,Ee(G(t,c))),I=1)}I&&l(s,[e]),Me(b,(t=>l(n,[e,t])))}),Xe(o),Q(r,Xe)),C},delIndexDefinition:e=>(I(e),C),getStore:a,getIndexIds:i,forEachIndex:e=>c(((t,s)=>e(t,(e=>L(t,e,s))))),forEachSlice:(e,t)=>L(e,t,g(e)),hasIndex:d,hasSlice:(e,t)=>pe(g(e),t),getTableId:u,getSliceIds:e=>ke(g(e)),getSliceRowIds:(e,t)=>ye(De(g(e),t)),addIndexIdsListener:b,addSliceIdsListener:(e,t)=>o(t,s,[e]),addSliceRowIdsListener:(e,t,s)=>o(s,n,[e,t]),delListener:e=>(r(e),C),destroy:w,getListenerStats:()=>({sliceIds:Re(s),sliceRowIds:Te(n)})};return ce(C)})),dt=Ee([["avg",[(e,t)=>Y(e)/t,(e,t,s)=>e+(t-e)/(s+1),(e,t,s)=>e+(e-t)/(s-1),(e,t,s,n)=>e+(t-s)/n]],["max",[e=>D(...e),(e,t)=>D(t,e),(e,t)=>t==e?void 0:e,(e,t,s)=>s==e?void 0:D(t,e)]],["min",[e=>H(...e),(e,t)=>H(t,e),(e,t)=>t==e?void 0:e,(e,t,s)=>s==e?void 0:H(t,e)]],["sum",[e=>Y(e),(e,t)=>e+t,(e,t)=>e-t,(e,t,s)=>e-s+t]]]),ut=(e,t,s,n,o,l=!1)=>{if(Se(s))return;const[r,a,i,c]=o;return l||=F(e),Me(n,(([s,n])=>{l||(e=F(s)?a?.(e,n,t++):F(n)?i?.(e,s,t--):c?.(e,n,s,t),l||=F(e))})),l?r(ye(s),Ce(s)):e},gt=Ye((e=>{const s=Ee(),[n,o,l]=et((()=>w)),[r,a,i,c,d,u,g,,h,f,I,b]=Ke(e,_,(e=>isNaN(e)||F(e)||!0===e||!1===e||e===t?void 0:1*e),n,o),w={setMetricDefinition:(e,t,n,l,r,a,i)=>{const c=O(n)?[n,r,a,i]:De(dt,n)??De(dt,"sum");return h(e,t,((t,n,l,r,a,i)=>{const d=u(e),h=Ce(r);i||=F(d),t();let f=ut(d,h,r,n,c,i);x(f)||(f=void 0),f!=d&&(g(e,f),o(s,[e],f,d))}),Xe(l,1)),w},delMetricDefinition:e=>(f(e),w),getStore:r,getMetricIds:a,forEachMetric:i,hasMetric:c,getTableId:d,getMetric:u,addMetricIdsListener:I,addMetricListener:(e,t)=>n(t,s,[e]),delListener:e=>(l(e),w),destroy:b,getListenerStats:()=>({metric:Re(s)})};return ce(w)})),ht=Ye((e=>{const s=e.createStore,n=s(),o=s(),l=Ee(),{addListener:r,callListeners:a,delListener:u}=o,[g,f,I,v,p,,,S,,y,V,M,m,E]=Ke(e,(()=>!0),_,r,a),k=(e,t,...s)=>K(s,(s=>Ge(xe(xe(l,t,Ee),e,qe),s))),D=e=>{Q(De(l,e),(e=>{He(e,((e,t)=>Me(t,(t=>e.delListener(t))))),Ve(e)})),K([o,n],(t=>t.delTable(e)))},H=(e,t,s)=>k(t,e,t.addStartTransactionListener(s.startTransaction),t.addDidFinishTransactionListener((()=>s.finishTransaction()))),J={setQueryDefinition:(s,l,r)=>{S(s,l),D(s);const a=[],i=[[null,[l,null,null,[],Ee()]]],c=[],d=[],u=[];r({select:(e,s)=>{const n=O(e)?[P(a)+t,e]:[F(s)?e:s,t=>t(e,s)];return ee(a,n),{as:e=>n[0]=e}},join:(e,t,s)=>{const n=F(s)||O(t)?null:t,o=F(n)?t:s,l=[e,[e,n,O(o)?o:e=>e(o),[],Ee()]];return ee(i,l),{as:e=>l[0]=e}},where:(e,t,s)=>ee(c,O(e)?e:F(s)?s=>s(e)===t:n=>n(e,t)===s),group:(e,t,s,n,o)=>{const l=[e,[e,O(t)?[t,s,n,o]:De(dt,t)??[(e,t)=>t]]];return ee(d,l),{as:e=>l[0]=e}},having:(e,t)=>ee(u,O(e)?e:s=>s(e)===t)});const g=Ee(a);if(Se(g))return J;const h=Ee(i);He(h,((e,[,t])=>Q(De(h,t),(({3:t})=>F(e)?0:ee(t,e)))));const f=Ee(d);let I=n;if(Se(f)&&Z(u))I=o;else{H(s,I,o);const e=Ee();He(f,((t,[s,n])=>Ge(xe(e,s,qe),[t,n])));const t=qe();He(g,(s=>pe(e,s)?0:Ge(t,s)));const n=Ee(),l=(t,n,l,r)=>Q(t,(([a,i,c,d])=>{He(n,((t,[s])=>{const n=xe(a,t,Ee),o=De(n,l),i=r?void 0:s;if(o!==i){const s=qe([[o,i]]),r=Ce(n);Je(n,l,i),Me(De(e,t),(([e,t])=>{const o=ut(d[e],r,n,s,t);d[e]=F(_e(o))?null:o}))}})),Se(i)||!B(u,(e=>e((e=>d[e]))))?o.delRow(s,c):F(c)?t[2]=o.addRow(s,d):o.setRow(s,c,d)}));k(I,s,I.addRowListener(s,null,((o,r,a,i)=>{const c=[],d=[],u=Ee(),g=I.hasRow(s,a);let h=!g;Me(t,(e=>{const[t,n,o]=i(s,a,e);ee(c,n),ee(d,o),h||=t})),He(e,(e=>{const[t,,n]=i(s,a,e);(h||t)&&Je(u,e,[n])})),h&&l(Pe(n,c,void 0,(([,e])=>(me(e,a),Se(e)))),u,a,1),g&&l(Pe(n,d,(()=>{const e={};return Me(t,(t=>e[t]=I.getCell(s,a,t))),[Ee(),qe(),void 0,e]}),(([,e])=>{Ge(e,a)})),u,a)})))}H(s,e,I);const b=(t,n,o,r)=>{const a=t=>e.getCell(n,o,t);K(r,(n=>{const[o,,l,r,i]=De(h,n),c=l?.(a,t),[d,u]=De(i,t)??[];c!=d&&(F(u)||E(s,u),Je(i,t,F(c)?null:[c,...m(s,1,e.addRowListener(o,c,(()=>b(t,o,c,r))))]))})),(t=>{const n=(s,n)=>e.getCell(...F(n)?[l,t,s]:s===l?[l,t,n]:[De(h,s)?.[0],De(De(h,s)?.[4],t)?.[0],n]);I.transaction((()=>B(c,(e=>e(n)))?He(g,((e,o)=>Be(I,s,t,e,o(n,t)))):I.delRow(s,t)))})(t)},{3:w}=De(h,null);return I.transaction((()=>m(s,1,e.addRowListener(l,null,((t,n,o)=>{e.hasRow(l,o)?b(o,l,o,w):(I.delRow(s,o),Me(h,(({4:e})=>Q(De(e,o),(([,t])=>{E(s,t),Je(e,o)})))))}))))),J},delQueryDefinition:e=>(D(e),y(e),J),getStore:g,getQueryIds:f,forEachQuery:I,hasQuery:v,getTableId:p,addQueryIdsListener:e=>V((()=>e(J))),delListener:e=>(u(e),J),destroy:M,getListenerStats:()=>{const{tables:e,tableIds:t,transaction:s,...n}=o.getListenerStats();return n}};return fe({[h]:[1,1],[h+T]:[0,1],[w]:[0,1],[L]:[0,1],[C]:[0,5],[b]:[1,2],[T]:[0,2],[R]:[1,3]},(([e,t],s)=>{K(e?["get","has","forEach"]:["get"],(e=>J[e+c+s]=(...t)=>o[e+s](...t))),J[d+c+s+i]=(...e)=>o[d+s+i](...A(e,0,t),((s,...n)=>e[t](J,...n)),!0)})),ce(J)})),ft=Ye((e=>{const s=Ee(),n=Ee(),o=Ee(),l=Ee(),[r,a,i]=et((()=>v)),[c,d,u,g,h,f,,,I,b,w,L]=Ke(e,(()=>[Ee(),Ee(),Ee(),Ee()]),(e=>F(e)?void 0:e+t),r,a),C=(e,t,s)=>Q(f(e),(([n,,o])=>{if(!pe(o,t)){const l=qe();if(h(e)!=T(e))Ge(l,t);else{let e=t;for(;!F(e)&&!pe(l,e);)Ge(l,e),e=De(n,e)}if(s)return l;Je(o,t,l)}return De(o,t)})),R=(e,t)=>Q(f(e),(([,,e])=>Je(e,t))),T=e=>De(s,e),v={setRelationshipDefinition:(e,t,r,i)=>(Je(s,e,r),I(e,t,((t,s)=>{const r=qe(),i=qe(),c=qe(),[d,u]=f(e);Me(s,(([t,s],n)=>{F(t)||(Ge(i,t),Q(De(u,t),(e=>{me(e,n),Se(e)&&Je(u,t)}))),F(s)||(Ge(i,s),pe(u,s)||Je(u,s,qe()),Ge(De(u,s),n)),Ge(r,n),Je(d,n,s),He(De(l,e),(t=>{pe(C(e,t),n)&&Ge(c,t)}))})),t(),Me(r,(t=>a(n,[e,t]))),Me(i,(t=>a(o,[e,t]))),Me(c,(t=>{R(e,t),a(l,[e,t])}))}),Xe(i)),v),delRelationshipDefinition:e=>(Je(s,e),b(e),v),getStore:c,getRelationshipIds:d,forEachRelationship:t=>u((s=>t(s,(t=>e.forEachRow(h(s),t))))),hasRelationship:g,getLocalTableId:h,getRemoteTableId:T,getRemoteRowId:(e,t)=>De(f(e)?.[0],t),getLocalRowIds:(e,t)=>ye(De(f(e)?.[1],t)),getLinkedRowIds:(e,t)=>F(f(e))?[t]:ye(C(e,t,!0)),addRelationshipIdsListener:w,addRemoteRowIdListener:(e,t,s)=>r(s,n,[e,t]),addLocalRowIdsListener:(e,t,s)=>r(s,o,[e,t]),addLinkedRowIdsListener:(e,t,s)=>(C(e,t),r(s,l,[e,t])),delListener:e=>(R(...i(e)??[]),v),destroy:L,getListenerStats:()=>({remoteRowId:Te(n),localRowIds:Te(o),linkedRowIds:Te(l)})};return ce(v)})),It=new E.TextEncoder,bt=e=>{let t=2166136261;return K(It.encode(e),(e=>{t^=e,t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24)})),t>>>0},wt=([e,t])=>Ct(e,t),Lt=([e,t,s])=>[e,t,s],Ct=(e,t)=>t?[e,t]:[e],Rt=(e,t,s)=>[e,t,s],Tt=e=>e[2],vt=(e,t)=>bt(e+":"+t),pt=(e,t)=>t>e?(e?bt(e):0)^bt(t):0,St=(e,t)=>((e??"")>(t??"")?e:t)??"",yt=(e,t,s)=>{t>e[1]&&(e[1]=t),e[2]=s>>>0},Vt=(e=t)=>Ct(de(),e),Mt=(e=t)=>[Ee(),e,0],mt=([e,t,s],n=Lt)=>[Qe(e,n),t,s],Et=([e,t],s=wt)=>Ct(Qe(e,s),t),kt=(t,s)=>W(t)&&3==P(t)&&N(t[1])&&e(t[2])==o&&x(t[2])&&s(t[0]),Dt=e=>[e,e],Ht=(e,t=Re)=>t(e[0])+t(e[1]),Jt=()=>[Ee(),Ee()],xt=e=>[...e],Ft=([e,t])=>e===t,Qt=JSON.stringify,zt=JSON.parse,Nt=e=>Qt(e,((e,t)=>t instanceof Map?ne.fromEntries([...t]):t)),Ot=(e,t,s)=>Je(e,t,De(e,t)==-s?void 0:s),Wt=()=>{let e,t,s=!1,n=!1,l=0,c=[];const g=Ee(),C=Ee(),V=Ee(),M=Ee(),m=Ee(),E=Ee(),k=Ee(),D=Ee(),H=Ee(),J=Ee(),x=Ee(),N=Ee(),P=Ee(),_=Ee(),B=qe(),q=Ee(),Y=Ee(),Z=Ee(),$=Ee(),te=Jt(),se=Jt(),ne=Jt(),oe=Jt(),le=Jt(),re=Jt(),ae=Jt(),ie=Jt(),de=Jt(),he=Jt(),be=Jt(),Le=Jt(),ye=Jt(),Pe=Jt(),je=Jt(),Ke=Jt(),Xe=Jt(),Ye=Jt(),Ze=Jt(),tt=Jt(),st=Jt(),nt=Jt(),ot=Ee(),lt=Jt(),[rt,it,ct,dt]=et((()=>Os)),ut=e=>{if(!we(e,((e,t)=>j([r,a],t))))return!1;const t=e[r];return!(!z(t)&&t!=o||(_e(e[a])!=t&&ge(e,a),0))},gt=W,ht=(t,s)=>(!e||pe(x,s)||Yt(s))&&we(t,((e,t)=>ft(s,t,e)),(()=>Yt(s))),ft=(e,t,s,n)=>we(n?s:Lt(s,e,t),((n,o)=>Q(It(e,t,o,n),(e=>(s[o]=e,!0)),(()=>!1))),(()=>Yt(e,t))),It=(t,s,n,o)=>e?Q(De(De(x,t),n),(e=>_e(o)!=e[r]?Yt(t,s,n,o,e[a]):o),(()=>Yt(t,s,n,o))):F(_e(o))?Yt(t,s,n,o):o,bt=(e,t)=>we(t?e:Ct(e),((t,s)=>Q(wt(s,t),(t=>(e[s]=t,!0)),(()=>!1))),(()=>Zt())),wt=(e,s)=>t?Q(De(P,e),(t=>_e(s)!=t[r]?Zt(e,s,t[a]):s),(()=>Zt(e,s))):F(_e(s))?Zt(e,s):s,Lt=(e,t,s)=>(Q(De(N,t),(([n,o])=>{Me(n,((t,s)=>{ue(e,s)||(e[s]=t)})),Me(o,(n=>{ue(e,n)||Yt(t,s,n)}))})),e),Ct=e=>(t&&(Me(_,((t,s)=>{ue(e,s)||(e[s]=t)})),Me(B,(t=>{ue(e,t)||Zt(t)}))),e),Rt=e=>Fe(x,e,((e,t,s)=>{const n=Ee(),o=qe();Fe(xe(x,t,Ee),s,((e,t,s)=>{Je(e,t,s),Q(s[a],(e=>Je(n,t,e)),(()=>Ge(o,t)))})),Je(N,t,[n,o])}),((e,t)=>{Je(x,t),Je(N,t)})),Tt=e=>Fe(P,e,((e,t,s)=>{Je(P,t,s),Q(s[a],(e=>Je(_,t,e)),(()=>Ge(B,t)))}),((e,t)=>{Je(P,t),Je(_,t),me(B,t)})),vt=e=>Ie(e)?ks():ys(e),pt=e=>Fe(Z,e,((e,t,s)=>St(t,s)),((e,t)=>At(t))),St=(e,t)=>Fe(xe(Z,e,(()=>(Bt(e,1),Je(q,e,$e()),Je(Y,e,Ee()),Ee()))),t,((t,s,n)=>yt(e,t,s,n)),((t,s)=>Pt(e,t,s))),yt=(e,t,s,n,o)=>Fe(xe(t,s,(()=>(Ut(e,s,1),Ee()))),n,((t,n,o)=>Vt(e,s,t,n,o)),((n,l)=>_t(e,t,s,n,l,o))),Vt=(e,t,s,n,o)=>{pe(s,n)||qt(e,t,n,1);const l=De(s,n);o!==l&&(Gt(e,t,n,l,o),Je(s,n,o))},Mt=(e,t,s,n,o)=>Q(De(t,s),(t=>Vt(e,s,t,n,o)),(()=>yt(e,t,s,Lt({[n]:o},e,s)))),mt=e=>Ie(e)?Js():Vs(e),Et=e=>Fe($,e,((e,t,s)=>kt(t,s)),((e,t)=>jt(t))),kt=(e,t)=>{pe($,e)||Kt(e,1);const s=De($,e);t!==s&&(Xt(e,s,t),Je($,e,t))},Qt=e=>De(Z,e)??St(e,{}),At=e=>St(e,{}),Pt=(e,t,s)=>{const[,n]=De(q,e);n(s),yt(e,t,s,{},!0)},_t=(e,t,s,n,o,l)=>{const r=De(De(N,e)?.[0],o);if(!F(r)&&!l)return Vt(e,s,n,o,r);const a=t=>{Gt(e,s,t,De(n,t)),qt(e,s,t,-1),Je(n,t)};F(r)?a(o):He(n,a),Se(n)&&(Ut(e,s,-1),Se(Je(t,s))&&(Bt(e,-1),Je(Z,e),Je(q,e),Je(Y,e)))},jt=e=>{const t=De(_,e);if(!F(t))return kt(e,t);Xt(e,De($,e)),Kt(e,-1),Je($,e)},Bt=(e,t)=>Ot(g,e,t),Ut=(e,t,s)=>Ot(xe(M,e,Ee),t,s)&&Je(V,e,xe(V,e,(()=>0))+s),qt=(e,t,s,n)=>{const o=De(Y,e),l=De(o,s)??0;(0==l&&1==n||1==l&&-1==n)&&Ot(xe(C,e,Ee),s,n),Je(o,s,l!=-n?l+n:null),Ot(xe(xe(m,e,Ee),t,Ee),s,n)},Gt=(e,t,s,n,o)=>{xe(xe(xe(E,e,Ee),t,Ee),s,(()=>[n,0]))[1]=o,c[3]?.(e,t,s,o)},Kt=(e,t)=>Ot(k,e,t),Xt=(e,t,s)=>{xe(D,e,(()=>[t,0]))[1]=s,c[4]?.(e,s)},Yt=(e,t,s,n,o)=>(ee(xe(xe(xe(H,e,Ee),t,Ee),s,(()=>[])),n),o),Zt=(e,t,s)=>(ee(xe(J,e,(()=>[])),t),s),$t=(e,t,s)=>Q(De(De(De(E,e),t),s),(([e,t])=>[!0,e,t]),(()=>[!1,...Dt(fs(e,t,s))])),es=e=>Q(De(D,e),(([e,t])=>[!0,e,t]),(()=>[!1,...Dt(ws(e))])),ts=e=>Se(H)||Se(Ke[e])?0:Me(e?Ae(H):H,((t,s)=>Me(t,((t,n)=>Me(t,((t,o)=>it(Ke[e],[s,n,o],t))))))),ss=e=>Se(J)||Se(Xe[e])?0:Me(e?Oe(J):J,((t,s)=>it(Xe[e],[s],t))),ns=(e,t,s,n)=>{if(!Se(e))return it(t,n,(()=>Qe(e))),He(e,((e,t)=>it(s,[...n??[],e],1==t))),1},os=e=>{const t=Ls();t!=s&&it(te[e],void 0,t);const n=Se(he[e]),o=Se(ye[e])&&Se(Pe[e])&&Se(de[e])&&Se(be[e])&&Se(re[e])&&Se(ae[e])&&Se(ie[e])&&n&&Se(ne[e])&&Se(oe[e]),l=Se(je[e])&&Se(Le[e])&&Se(le[e])&&Se(se[e]);if(!o||!l){const t=e?[Oe(g),We(C),Oe(V),We(M),Ae(m),Ae(E)]:[g,C,V,M,m,E];if(!o){ns(t[0],ne[e],oe[e]),Me(t[1],((t,s)=>ns(t,re[e],ae[e],[s]))),Me(t[2],((t,s)=>{0!=t&&it(ie[e],[s],ds(s))}));const s=qe();Me(t[3],((t,o)=>{ns(t,de[e],be[e],[o])&&!n&&(it(he[e],[o,null]),Ge(s,o))})),n||Me(t[5],((t,n)=>{if(!pe(s,n)){const s=qe();Me(t,(e=>Me(e,(([t,n],o)=>n!==t?Ge(s,o):me(e,o))))),Me(s,(t=>it(he[e],[n,t])))}})),Me(t[4],((t,s)=>Me(t,((t,n)=>ns(t,ye[e],Pe[e],[s,n])))))}if(!l){let s;Me(t[5],((t,n)=>{let o;Me(t,((t,l)=>{let r;Me(t,(([t,a],i)=>{a!==t&&(it(je[e],[n,l,i],a,t,$t),s=o=r=1)})),r&&it(Le[e],[n,l],$t)})),o&&it(le[e],[n],$t)})),s&&it(se[e],void 0,$t)}}},ls=e=>{const t=ps();t!=n&&it(Ye[e],void 0,t);const s=Se(tt[e])&&Se(st[e]),o=Se(nt[e])&&Se(Ze[e]);if(!s||!o){const t=e?[Oe(k),Oe(D)]:[k,D];if(s||ns(t[0],tt[e],st[e]),!o){let s;Me(t[1],(([t,n],o)=>{n!==t&&(it(nt[e],[o],n,t,es),s=1)})),s&&it(Ze[e],void 0,es)}}},rs=(e,...t)=>(Qs((()=>e(...X(t,y)))),Os),as=()=>Ne(Z),is=()=>ke(Z),cs=e=>ke(De(Y,y(e))),ds=e=>Ce(De(Z,y(e))),us=e=>ke(De(Z,y(e))),gs=(e,t,s,n=0,o)=>{return X(A(G((l=De(Z,y(e)),r=(e,s)=>[F(t)?s:De(e,y(t)),s],X([...l?.entries()??[]],(([e,t])=>r(t,e)))),(([e],[t])=>at(e,t)*(s?-1:1))),n,F(o)?o:n+o),(([,e])=>e));var l,r},hs=(e,t)=>ke(De(De(Z,y(e)),y(t))),fs=(e,t,s)=>De(De(De(Z,y(e)),y(t)),y(s)),Is=()=>Qe($),bs=()=>ke($),ws=e=>De($,y(e)),Ls=()=>!Se(Z),Cs=e=>pe(Z,y(e)),Rs=(e,t)=>pe(De(Y,y(e)),y(t)),Ts=(e,t)=>pe(De(Z,y(e)),y(t)),vs=(e,t,s)=>pe(De(De(Z,y(e)),y(t)),y(s)),ps=()=>!Se($),Ss=e=>pe($,y(e)),ys=e=>rs((()=>(e=>we(e,ht,Yt))(e)?pt(e):0)),Vs=e=>rs((()=>bt(e)?Et(e):0)),Ms=e=>{try{vt(zt(e))}catch{}return Os},ms=t=>rs((()=>{if((e=we(t,(e=>we(e,ut))))&&(Rt(t),!Se(Z))){const e=as();ks(),ys(e)}})),Es=e=>rs((()=>{if(t=(e=>we(e,ut))(e)){const s=Is();Fs(),Js(),t=!0,Tt(e),Vs(s)}})),ks=()=>rs((()=>pt({}))),Ds=e=>rs((e=>pe(Z,e)?At(e):0),e),Hs=(e,t)=>rs(((e,t)=>Q(De(Z,e),(s=>pe(s,t)?Pt(e,s,t):0))),e,t),Js=()=>rs((()=>Et({}))),xs=()=>rs((()=>{Rt({}),e=!1})),Fs=()=>rs((()=>{Tt({}),t=!1})),Qs=(e,t)=>{if(-1!=l){zs();const s=e();return Ns(t),s}},zs=()=>(-1!=l&&l++,1==l&&(c[0]?.(),it(ot)),Os),Ns=e=>(l>0&&(l--,0==l&&(l=1,ts(1),Se(E)||os(1),ss(1),Se(D)||ls(1),e?.(Os)&&(Me(E,((e,t)=>Me(e,((e,s)=>Me(e,(([e],n)=>Be(Os,t,s,n,e))))))),Ve(E),Me(D,(([e],t)=>Ue(Os,t,e))),Ve(D)),it(lt[0],void 0),l=-1,ts(0),Se(E)||os(0),ss(0),Se(D)||ls(0),c[1]?.(),it(lt[1],void 0),c[2]?.(),l=0,s=Ls(),n=ps(),K([g,C,V,M,m,E,H,k,D,J],Ve))),Os),Os={getContent:()=>[as(),Is()],getTables:as,getTableIds:is,getTable:e=>ze(De(Z,y(e))),getTableCellIds:cs,getRowCount:ds,getRowIds:us,getSortedRowIds:gs,getRow:(e,t)=>Qe(De(De(Z,y(e)),y(t))),getCellIds:hs,getCell:fs,getValues:Is,getValueIds:bs,getValue:ws,hasTables:Ls,hasTable:Cs,hasTableCell:Rs,hasRow:Ts,hasCell:vs,hasValues:ps,hasValue:Ss,getTablesJson:()=>Nt(Z),getValuesJson:()=>Nt($),getJson:()=>Nt([Z,$]),getTablesSchemaJson:()=>Nt(x),getValuesSchemaJson:()=>Nt(P),getSchemaJson:()=>Nt([x,P]),hasTablesSchema:()=>e,hasValuesSchema:()=>t,setContent:e=>rs((()=>{const t=O(e)?e():e;gt(t)&&(([e,t])=>{(Ie(e)?ks:ys)(e),(Ie(t)?Js:Vs)(t)})(t)})),setTables:ys,setTable:(e,t)=>rs((e=>ht(t,e)?St(e,t):0),e),setRow:(e,t,s)=>rs(((e,t)=>ft(e,t,s)?yt(e,Qt(e),t,s):0),e,t),addRow:(e,t,s=!0)=>Qs((()=>{let n;return ft(e,n,t)&&(e=y(e),yt(e,Qt(e),n=((e,t)=>{const[s]=De(q,e);let n;do{n=s(t)}while(pe(De(Z,e),n));return n})(e,s?1:0),t)),n})),setPartialRow:(e,t,s)=>rs(((e,t)=>{if(ft(e,t,s,1)){const n=Qt(e);fe(s,((s,o)=>Mt(e,n,t,o,s)))}}),e,t),setCell:(e,t,s,n)=>rs(((e,t,s)=>Q(It(e,t,s,O(n)?n(fs(e,t,s)):n),(n=>Mt(e,Qt(e),t,s,n)))),e,t,s),setValues:Vs,setPartialValues:e=>rs((()=>bt(e,1)?fe(e,((e,t)=>kt(t,e))):0)),setValue:(e,t)=>rs((e=>Q(wt(e,O(t)?t(ws(e)):t),(t=>kt(e,t)))),e),applyChanges:e=>rs((()=>{fe(e[0],((e,t)=>F(e)?Ds(t):fe(e,((e,s)=>F(e)?Hs(t,s):fe(e,((e,n)=>Be(Os,t,s,n,e))))))),fe(e[1],((e,t)=>Ue(Os,t,e)))})),setTablesJson:Ms,setValuesJson:e=>{try{mt(zt(e))}catch{}return Os},setJson:e=>rs((()=>{try{const[t,s]=zt(e);vt(t),mt(s)}catch{Ms(e)}})),setTablesSchema:ms,setValuesSchema:Es,setSchema:(e,t)=>rs((()=>{ms(e),Es(t)})),delTables:ks,delTable:Ds,delRow:Hs,delCell:(e,t,s,n)=>rs(((e,t,s)=>Q(De(Z,e),(o=>Q(De(o,t),(l=>pe(l,s)?_t(e,o,t,l,s,n):0))))),e,t,s),delValues:Js,delValue:e=>rs((e=>pe($,e)?jt(e):0),e),delTablesSchema:xs,delValuesSchema:Fs,delSchema:()=>rs((()=>{xs(),Fs()})),transaction:Qs,startTransaction:zs,getTransactionChanges:()=>[Qe(E,((e,t)=>-1===De(g,t)?void 0:Qe(e,((e,s)=>-1===De(De(M,t),s)?void 0:Qe(e,(([,e])=>e),(e=>Ft(e)))),Se,Ie)),Se,Ie),Qe(D,(([,e])=>e),(e=>Ft(e))),1],getTransactionLog:()=>[!Se(E),!Se(D),Ne(E,xt,Ft),Ne(H),Qe(D,xt,Ft),Qe(J),Qe(g),ze(M),Ne(m),Qe(k)],finishTransaction:Ns,forEachTable:e=>Me(Z,((t,s)=>e(s,(e=>Me(t,((t,s)=>e(s,(e=>He(t,e))))))))),forEachTableCell:(e,t)=>He(De(Y,y(e)),t),forEachRow:(e,t)=>Me(De(Z,y(e)),((e,s)=>t(s,(t=>He(e,t))))),forEachCell:(e,t,s)=>He(De(De(Z,y(e)),y(t)),s),forEachValue:e=>He($,e),addSortedRowIdsListener:(e,t,s,n,o,l,r)=>{let a=gs(e,t,s,n,o);return rt((()=>{const r=gs(e,t,s,n,o);U(r,a)||(a=r,l(Os,e,t,s,n,o,a))}),he[r?1:0],[e,t],[is])},addStartTransactionListener:e=>rt(e,ot),addWillFinishTransactionListener:e=>rt(e,lt[0]),addDidFinishTransactionListener:e=>rt(e,lt[1]),callListener:e=>(dt(e),Os),delListener:e=>(ct(e),Os),getListenerStats:()=>({hasTables:Ht(te),tables:Ht(se),tableIds:Ht(ne),hasTable:Ht(oe),table:Ht(le),tableCellIds:Ht(re),hasTableCell:Ht(ae,Te),rowCount:Ht(ie),rowIds:Ht(de),sortedRowIds:Ht(he),hasRow:Ht(be,Te),row:Ht(Le,Te),cellIds:Ht(ye,Te),hasCell:Ht(Pe,ve),cell:Ht(je,ve),invalidCell:Ht(Ke,ve),hasValues:Ht(Ye),values:Ht(Ze),valueIds:Ht(tt),hasValue:Ht(st),value:Ht(nt),invalidValue:Ht(Xe),transaction:Re(ot)+Ht(lt)}),isMergeable:()=>!1,createStore:Wt,addListener:rt,callListeners:it,setInternalListeners:(e,t,s,n,o)=>c=[e,t,s,n,o]};return fe({[u+f]:[0,te,[],()=>[Ls()]],[f]:[0,se],[I]:[0,ne],[u+h]:[1,oe,[is],e=>[Cs(...e)]],[h]:[1,le,[is]],[h+T]:[1,re,[is]],[u+h+R]:[2,ae,[is,cs],e=>[Rs(...e)]],[w]:[1,ie,[is]],[L]:[1,de,[is]],[u+b]:[2,be,[is,us],e=>[Ts(...e)]],[b]:[2,Le,[is,us]],[T]:[2,ye,[is,us]],[u+R]:[3,Pe,[is,us,hs],e=>[vs(...e)]],[R]:[3,je,[is,us,hs],e=>Dt(fs(...e))],InvalidCell:[3,Ke],[u+p]:[0,Ye,[],()=>[ps()]],[p]:[0,Ze],[S]:[0,tt],[u+v]:[1,st,[bs],e=>[Ss(...e)]],[v]:[1,nt,[bs],e=>Dt(ws(e[0]))],InvalidValue:[1,Xe]},(([e,t,s,n],o)=>{Os[d+o+i]=(...o)=>rt(o[e],t[o[e+1]?1:0],e>0?A(o,0,e):void 0,s,n)})),ce(Os)},At=2**36,Pt=2**30,_t=2**24,jt=2**18,Bt=4096,Ut={HasTable:1,Table:1,TableCellIds:1,HasTableCell:2,RowCount:1,RowIds:1,SortedRowIds:5,HasRow:2,Row:2,CellIds:2,HasCell:3,Cell:3,HasValue:1,Value:1,InvalidCell:3,InvalidValue:1},qt=(e=t)=>[Mt(e),Mt(e)],Gt=e=>{let s=1,n=qt(),o=0;const l=Ee(),r=qe(),[a,c]=(e=>{let t=0,s=-1;const n=Q(e,(e=>{const t=bt(e);return ot(t/_t)+ot(t/jt)+ot(t/Bt)+ot(t/64)+ot(t)}),(()=>it(5))),o=e=>{const n=t,[o,l]=F(e)||""==e?[0,0]:[lt(r=e,0)*At+lt(r,1)*Pt+lt(r,2)*_t+lt(r,3)*jt+lt(r,4)*Bt+64*lt(r,5)+lt(r,6),lt(r,7)*jt+lt(r,8)*Bt+64*lt(r,9)+lt(r,10)];var r;t=D(n,o,E.HLC_TIME??Date.now()),s=t==n?t==o?D(s,l):s:t==o?l:-1};return[()=>{return o(),l=++s,ot((e=t)/At)+ot(e/Pt)+ot(e/_t)+ot(e/jt)+ot(e/Bt)+ot(e/64)+ot(e)+ot(l/jt)+ot(l/Bt)+ot(l/64)+ot(l)+n;var e,l},o]})(e),u=Wt(),g=e=>{const t=s;return s=0,e(),s=t,w},h=(e,s=0)=>{const o={},l={},[[r,a=t,i=0],d]=e,[u,g]=n,[h,I,b]=u;let w=s?i:b,L=a;he(r,(([e,n=t,l=0],r)=>{const a=xe(h,r,Mt),[i,c,d]=a;let u=s?l:d,g=n;he(e,((e,t)=>{const[n,l,a]=f(e,xe(i,t,Mt),be(be(o,r,de),t,de),s);u^=s?0:(l?vt(t,l):0)^vt(t,a),g=St(g,n)})),u^=s?0:pt(c,n),yt(a,n,u),w^=s?0:(d?vt(r,d):0)^vt(r,a[2]),L=St(L,g)})),w^=s?0:pt(I,a),yt(u,a,w);const[C]=f(d,g,l,s);return c(St(L,C)),[o,l,1]},f=(e,s,n,o)=>{const[l,r=t,a=0]=e,[i,c,d]=s;let u=r,g=o?a:d;return he(l,(([e,s,l=0],r)=>{const a=xe(i,r,(()=>[void 0,t,0])),[,c,d]=a;(!c||s>c)&&(yt(a,s,o?l:bt(Nt(e??null)+":"+s)),a[0]=e,n[r]=e,g^=o?0:vt(r,d)^vt(r,a[2]),u=St(u,s))})),g^=o?0:pt(c,r),yt(s,r,g),[u,d,s[2]]},I=()=>[mt(n[0],(e=>mt(e,(e=>mt(e))))),mt(n[1])],b=e=>g((()=>u.applyChanges(h(e)))),w={getMergeableContent:I,getMergeableContentHashes:()=>[n[0][2],n[1][2]],getMergeableTableHashes:()=>Qe(n[0][0],Tt),getMergeableTableDiff:e=>{const t=Vt(n[0][1]),s={};return He(n[0][0],((n,[o,l,r])=>ue(e,n)?r!=e[n]?s[n]=r:0:t[0][n]=Et([o,l],(e=>Et(e))))),[t,s]},getMergeableRowHashes:e=>{const t={};return he(e,((e,s)=>Q(De(n[0][0],s),(([n,,o])=>o!=e?He(n,((e,[,,n])=>be(t,s,de)[e]=n)):0)))),t},getMergeableRowDiff:e=>{const t=Vt(n[0][1]),s={};return he(e,((e,o)=>He(De(n[0][0],o)?.[0],((n,[l,r,a])=>ue(e,n)?a!==e[n]?be(s,o,de)[n]=a:0:be(t[0],o,Vt)[0][n]=Et([l,r]))))),[t,s]},getMergeableCellHashes:e=>{const t={};return he(e,((e,s)=>Q(De(n[0][0],s),(([n])=>he(e,((e,o)=>Q(De(n,o),(([n,,l])=>l!==e?He(n,((e,[,,n])=>be(be(t,s,de),o,de)[e]=n)):0)))))))),t},getMergeableCellDiff:e=>{const[[t,s]]=n,o={};return he(e,((e,s)=>he(e,((e,n)=>Q(De(t,s),(([t,l])=>Q(De(t,n),(([t,r])=>He(t,((t,[a,i,c])=>c!==e[t]?be(be(o,s,(()=>Vt(l)))[0],n,(()=>Vt(r)))[0][t]=[a,i]:0)))))))))),Ct(o,s)},getMergeableValueHashes:()=>Qe(n[1][0],Tt),getMergeableValueDiff:e=>{const[,[t,s]]=n,o=Qe(t,wt,(([,,t],s)=>t==e?.[s]));return Ct(o,s)},setMergeableContent:e=>g((()=>(e=>W(e)&&2==P(e)&&kt(e[0],(e=>we(e,(e=>kt(e,(e=>we(e,(e=>kt(e,(e=>we(e,(e=>kt(e,je)),void 0,1)))),void 0,1)))),void 0,1)))&&kt(e[1],(e=>we(e,(e=>kt(e,je)),void 0,1))))(e)?u.transaction((()=>{u.delTables().delValues(),n=qt(),u.applyChanges(h(e,1))})):0)),setDefaultContent:e=>(u.transaction((()=>{o=1,u.setContent(e),o=0})),w),getTransactionMergeableChanges:(e=!1)=>{const[[t,s,o],[a,i,c]]=n,d=e?Rt:Ct,u={};Me(l,((e,s)=>Q(De(t,s),(([t,n,o])=>{const l={};Me(e,((e,s)=>Q(De(t,s),(([t,n,o])=>{const r={};Me(e,(e=>{Q(De(t,e),(([t,s,n])=>r[e]=d(t,s,n)))})),l[s]=d(r,n,o)})))),u[s]=d(l,n,o)}))));const g={};return Me(r,(e=>Q(De(a,e),(([t,s,n])=>g[e]=d(t,s,n))))),[d(u,s,o),d(g,i,c),1]},applyMergeableChanges:b,merge:e=>{const t=I(),s=e.getMergeableContent();return e.applyMergeableChanges(t),b(s)}};return u.setInternalListeners((()=>{}),(()=>{}),(()=>{Ve(l),Ve(r)}),((e,n,r,i)=>{Ge(xe(xe(l,e,Ee),n,qe),r),s&&h([[{[e]:[{[n]:[{[r]:[i,o?t:a()]}]}]}],[{}],1])}),((e,n)=>{Ge(r,e),s&&h([[{}],[{[e]:[n,o?t:a()]}],1])})),fe(u,((e,t)=>w[t]=V(t,"set")||V(t,"del")||V(t,"apply")||M(t,"Transaction")||t=="call"+i?(...t)=>(e(...t),w):V(t,d)&&M(t,i)?(...s)=>{const n=Ut[A(t,3,-8)]??0,o=s[n];return s[n]=(e,...t)=>o(w,...t),e(...s)}:"isMergeable"==t?()=>!0:e)),ce(w)};export{tt as createCheckpoints,ct as createIndexes,Gt as createMergeableStore,gt as createMetrics,ht as createQueries,ft as createRelationships,Wt as createStore,at as defaultSorter,it as getUniqueId};
