const e=e=>typeof e,t="",s=e(t),a=e(!0),l=e(0),n=e(e),r="type",o="default",c="Listener",i="Has",d="Ids",u="Table",g=u+"s",h=u+d,b="Row",C=b+"Count",f=b+d,T="Cell",v=T+d,V="Value",w=V+"s",p=V+d,I=e=>t+e,y=(e,t)=>e.startsWith(t),R=(e,t)=>e.endsWith(t),M=(e,s=t,a)=>e.split(s,a),S=globalThis,m=Math,L=m.max,H=m.floor,E=isFinite,J=e=>null==e,D=(e,t,s)=>J(e)?s?.():t(e),F=e=>e==s||e==a,O=t=>e(t)==n,x=e=>Array.isArray(e),z=(e,t,s)=>e.slice(t,s),A=e=>e.length,P=(e,t)=>e.forEach(t),W=(e,t)=>e.map(t),k=(e,t,s)=>e.reduce(t,s),N=(e,...t)=>e.push(...t),j=Object,U=e=>j.getPrototypeOf(e),_=j.entries,q=j.isFrozen,B=e=>!J(e)&&D(U(e),(e=>e==j.prototype||J(U(e))),(()=>!0)),G=j.keys,K=j.freeze,Q=(e=[])=>j.fromEntries(e),X=(e,t)=>t in e,Y=(e,t)=>(delete e[t],e),Z=(e,t)=>P(_(e),(([e,s])=>t(s,e))),$=(e,t)=>W(_(e),(([e,s])=>t(s,e))),ee=e=>B(e)&&0==(e=>A(G(e)))(e),te=(e,t,s)=>(X(e,t)||(e[t]=s()),e[t]),se=(e,t,s,a=0)=>J(e)||!B(e)||!a&&ee(e)||q(e)?(s?.(),!1):($(e,((s,a)=>{t(s,a)||Y(e,a)})),!!a||!ee(e)),ae=e=>new Set(x(e)||J(e)?e:[e]),le=(e,t)=>e?.add(t),ne=e=>t=>k(ge(t),((t,s)=>t+e(s)),0),re=e=>e?.size??0,oe=ne(re),ce=ne(oe),ie=ne(ce),de=(e,t)=>e?.has(t)??!1,ue=e=>J(e)||0==re(e),ge=e=>[...e?.values()??[]],he=e=>e.clear(),be=(e,t)=>e?.forEach(t),Ce=(e,t)=>e?.delete(t),fe=e=>new Map(e),Te=e=>[...e?.keys()??[]],ve=(e,t)=>e?.get(t),Ve=(e,t)=>be(e,((e,s)=>t(s,e))),we=(e,t,s)=>J(s)?(Ce(e,t),e):e?.set(t,s),pe=(e,t,s,a)=>(de(e,t)?a?.(ve(e,t)):we(e,t,s()),ve(e,t)),Ie=(e,t,s,a=we)=>($(t,((t,a)=>s(e,a,t))),Ve(e,(s=>X(t,s)?0:a(e,s))),e),ye=(e,t,s,a)=>{const l={};return be(e,((e,n)=>{if(!s?.(e,n)){const s=t?t(e,n):e;a?.(s)||(l[n]=s)}})),l},Re=(e,t,s)=>ye(e,(e=>ye(e,t,s)),ue,ee),Me=(e,t,s)=>ye(e,(e=>Re(e,t,s)),ue,ee),Se=(e,t)=>{const s=fe();return be(e,((e,a)=>s.set(a,t?.(e)??e))),s},me=e=>Se(e,Se),Le=e=>Se(e,me),He=(e,t,s,a,l=0)=>D((s?pe:ve)(e,t[l],l>A(t)-2?s:fe),(n=>{if(l>A(t)-2)return a?.(n)&&we(e,t[l]),n;const r=He(n,t,s,a,l+1);return ue(n)&&we(e,t[l]),r})),Ee=new S.TextEncoder,Je=e=>{let t=2166136261;return P(Ee.encode(e),(e=>{t^=e,t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24)})),t>>>0},De=([e,t])=>Oe(e,t),Fe=([e,t,s])=>[e,t,s],Oe=(e,t)=>t?[e,t]:[e],xe=(e,t,s)=>[e,t,s],ze=e=>e[2],Ae=(e,t)=>Je(e+":"+t),Pe=(e,t)=>t>e?(e?Je(e):0)^Je(t):0,We=(e,t)=>((e??"")>(t??"")?e:t)??"",ke=(e,t,s)=>{t>e[1]&&(e[1]=t),e[2]=s>>>0},Ne=(e=t)=>Oe(Q(),e),je=(e=t)=>[fe(),e,0],Ue=([e,t,s],a=Fe)=>[ye(e,a),t,s],_e=([e,t],s=De)=>Oe(ye(e,s),t),qe=(t,a)=>{return x(t)&&3==A(t)&&(n=t[1],e(n)==s)&&e(t[2])==l&&E(t[2])&&a(t[0]);var n},Be=/^\d+$/,Ge=()=>{const e=[];let s=0;return[a=>(a?e.shift():null)??t+s++,t=>{Be.test(t)&&A(e)<1e3&&N(e,t)}]},Ke=e=>[e,e],Qe=(e,t=oe)=>t(e[0])+t(e[1]),Xe=()=>[fe(),fe()],Ye=e=>[...e],Ze=([e,t])=>e===t,$e=t=>{const s=e(t);return F(s)||s==l&&E(t)?s:void 0},et=e=>J(e)||!J($e(e)),tt=(e,t,s,a,l)=>J(l)?e.delCell(t,s,a,!0):e.setCell(t,s,a,l),st=(e,t,s)=>J(s)?e.delValue(t):e.setValue(t,s),at=JSON.stringify,lt=JSON.parse,nt=e=>at(e,((e,t)=>t instanceof Map?j.fromEntries([...t]):t)),rt=M("-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz"),ot=fe(W(rt,((e,t)=>[e,t]))),ct=e=>rt[63&e],it=(e,t)=>ve(ot,e[t])??0,dt=S.crypto?e=>S.crypto.getRandomValues(e):e=>W(e,(()=>H(256*m.random()))),ut=(e,t,s)=>we(e,t,ve(e,t)==-s?void 0:s),gt=()=>{let e,s,a=!1,n=!1,d=0,y=[];const R=fe(),M=fe(),S=fe(),m=fe(),L=fe(),H=fe(),E=fe(),k=fe(),j=fe(),U=fe(),_=fe(),q=fe(),B=fe(),G=fe(),Q=ae(),Z=fe(),te=fe(),ne=fe(),ge=fe(),Ee=Xe(),Je=Xe(),De=Xe(),Fe=Xe(),Oe=Xe(),xe=Xe(),ze=Xe(),Ae=Xe(),Pe=Xe(),We=Xe(),ke=Xe(),Ne=Xe(),je=Xe(),Ue=Xe(),_e=Xe(),qe=Xe(),Be=Xe(),et=Xe(),at=Xe(),rt=Xe(),ot=Xe(),ct=Xe(),it=fe(),dt=Xe(),[ht,bt,Ct,ft]=(()=>{let e;const[s,a]=Ge(),l=fe();return[(a,n,r,o=[],c=()=>[])=>{e??=zs;const i=s(1);return we(l,i,[a,n,r,o,c]),le(He(n,r??[t],ae),i),i},(s,a,...n)=>P(((e,s=[t])=>{const a=[],l=(e,t)=>t==A(s)?N(a,e):null===s[t]?be(e,(e=>l(e,t+1))):P([s[t],null],(s=>l(ve(e,s),t+1)));return l(e,0),a})(s,a),(t=>be(t,(t=>ve(l,t)[0](e,...a??[],...n))))),e=>D(ve(l,e),(([,s,n])=>(He(s,n??[t],void 0,(t=>(Ce(t,e),ue(t)?1:0))),we(l,e),a(e),n))),t=>D(ve(l,t),(([t,,s=[],a,l])=>{const n=(...r)=>{const o=A(r);o==A(s)?t(e,...r,...l(r)):J(s[o])?P(a[o]?.(...r)??[],(e=>n(...r,e))):n(...r,s[o])};n()}))]})(),Tt=e=>{if(!se(e,((e,t)=>[r,o].includes(t))))return!1;const t=e[r];return!(!F(t)&&t!=l||($e(e[o])!=t&&Y(e,o),0))},vt=x,Vt=(t,s)=>(!e||de(_,s)||Kt(s))&&se(t,((e,t)=>wt(s,t,e)),(()=>Kt(s))),wt=(e,t,s,a)=>se(a?s:Rt(s,e,t),((a,l)=>D(pt(e,t,l,a),(e=>(s[l]=e,!0)),(()=>!1))),(()=>Kt(e,t))),pt=(t,s,a,l)=>e?D(ve(ve(_,t),a),(e=>$e(l)!=e[r]?Kt(t,s,a,l,e[o]):l),(()=>Kt(t,s,a,l))):J($e(l))?Kt(t,s,a,l):l,It=(e,t)=>se(t?e:Mt(e),((t,s)=>D(yt(s,t),(t=>(e[s]=t,!0)),(()=>!1))),(()=>Qt())),yt=(e,t)=>s?D(ve(B,e),(s=>$e(t)!=s[r]?Qt(e,t,s[o]):t),(()=>Qt(e,t))):J($e(t))?Qt(e,t):t,Rt=(e,t,s)=>(D(ve(q,t),(([a,l])=>{be(a,((t,s)=>{X(e,s)||(e[s]=t)})),be(l,(a=>{X(e,a)||Kt(t,s,a)}))})),e),Mt=e=>(s&&(be(G,((t,s)=>{X(e,s)||(e[s]=t)})),be(Q,(t=>{X(e,t)||Qt(t)}))),e),St=e=>Ie(_,e,((e,t,s)=>{const a=fe(),l=ae();Ie(pe(_,t,fe),s,((e,t,s)=>{we(e,t,s),D(s[o],(e=>we(a,t,e)),(()=>le(l,t)))})),we(q,t,[a,l])}),((e,t)=>{we(_,t),we(q,t)})),mt=e=>Ie(B,e,((e,t,s)=>{we(B,t,s),D(s[o],(e=>we(G,t,e)),(()=>le(Q,t)))}),((e,t)=>{we(B,t),we(G,t),Ce(Q,t)})),Lt=e=>ee(e)?ms():Is(e),Ht=e=>Ie(ne,e,((e,t,s)=>Et(t,s)),((e,t)=>Pt(t))),Et=(e,t)=>Ie(pe(ne,e,(()=>(jt(e,1),we(Z,e,Ge()),we(te,e,fe()),fe()))),t,((t,s,a)=>Jt(e,t,s,a)),((t,s)=>Wt(e,t,s))),Jt=(e,t,s,a,l)=>Ie(pe(t,s,(()=>(Ut(e,s,1),fe()))),a,((t,a,l)=>Dt(e,s,t,a,l)),((a,n)=>kt(e,t,s,a,n,l))),Dt=(e,t,s,a,l)=>{de(s,a)||_t(e,t,a,1);const n=ve(s,a);l!==n&&(qt(e,t,a,n,l),we(s,a,l))},Ft=(e,t,s,a,l)=>D(ve(t,s),(t=>Dt(e,s,t,a,l)),(()=>Jt(e,t,s,Rt({[a]:l},e,s)))),Ot=e=>ee(e)?Es():ys(e),xt=e=>Ie(ge,e,((e,t,s)=>zt(t,s)),((e,t)=>Nt(t))),zt=(e,t)=>{de(ge,e)||Bt(e,1);const s=ve(ge,e);t!==s&&(Gt(e,s,t),we(ge,e,t))},At=e=>ve(ne,e)??Et(e,{}),Pt=e=>Et(e,{}),Wt=(e,t,s)=>{const[,a]=ve(Z,e);a(s),Jt(e,t,s,{},!0)},kt=(e,t,s,a,l,n)=>{const r=ve(ve(q,e)?.[0],l);if(!J(r)&&!n)return Dt(e,s,a,l,r);const o=t=>{qt(e,s,t,ve(a,t)),_t(e,s,t,-1),we(a,t)};J(r)?o(l):Ve(a,o),ue(a)&&(Ut(e,s,-1),ue(we(t,s))&&(jt(e,-1),we(ne,e),we(Z,e),we(te,e)))},Nt=e=>{const t=ve(G,e);if(!J(t))return zt(e,t);Gt(e,ve(ge,e)),Bt(e,-1),we(ge,e)},jt=(e,t)=>ut(R,e,t),Ut=(e,t,s)=>ut(pe(m,e,fe),t,s)&&we(S,e,pe(S,e,(()=>0))+s),_t=(e,t,s,a)=>{const l=ve(te,e),n=ve(l,s)??0;(0==n&&1==a||1==n&&-1==a)&&ut(pe(M,e,fe),s,a),we(l,s,n!=-a?n+a:null),ut(pe(pe(L,e,fe),t,fe),s,a)},qt=(e,t,s,a,l)=>{pe(pe(pe(H,e,fe),t,fe),s,(()=>[a,0]))[1]=l,y[3]?.(e,t,s,l)},Bt=(e,t)=>ut(E,e,t),Gt=(e,t,s)=>{pe(k,e,(()=>[t,0]))[1]=s,y[4]?.(e,s)},Kt=(e,t,s,a,l)=>(N(pe(pe(pe(j,e,fe),t,fe),s,(()=>[])),a),l),Qt=(e,t,s)=>(N(pe(U,e,(()=>[])),t),s),Xt=(e,t,s)=>D(ve(ve(ve(H,e),t),s),(([e,t])=>[!0,e,t]),(()=>[!1,...Ke(us(e,t,s))])),Yt=e=>D(ve(k,e),(([e,t])=>[!0,e,t]),(()=>[!1,...Ke(bs(e))])),Zt=e=>ue(j)||ue(qe[e])?0:be(e?Le(j):j,((t,s)=>be(t,((t,a)=>be(t,((t,l)=>bt(qe[e],[s,a,l],t))))))),$t=e=>ue(U)||ue(Be[e])?0:be(e?Se(U):U,((t,s)=>bt(Be[e],[s],t))),es=(e,t,s,a)=>{if(!ue(e))return bt(t,a,(()=>ye(e))),Ve(e,((e,t)=>bt(s,[...a??[],e],1==t))),1},ts=e=>{const t=Cs();t!=a&&bt(Ee[e],void 0,t);const s=ue(We[e]),l=ue(je[e])&&ue(Ue[e])&&ue(Pe[e])&&ue(ke[e])&&ue(xe[e])&&ue(ze[e])&&ue(Ae[e])&&s&&ue(De[e])&&ue(Fe[e]),n=ue(_e[e])&&ue(Ne[e])&&ue(Oe[e])&&ue(Je[e]);if(!l||!n){const t=e?[Se(R),me(M),Se(S),me(m),Le(L),Le(H)]:[R,M,S,m,L,H];if(!l){es(t[0],De[e],Fe[e]),be(t[1],((t,s)=>es(t,xe[e],ze[e],[s]))),be(t[2],((t,s)=>{0!=t&&bt(Ae[e],[s],os(s))}));const a=ae();be(t[3],((t,l)=>{es(t,Pe[e],ke[e],[l])&&!s&&(bt(We[e],[l,null]),le(a,l))})),s||be(t[5],((t,s)=>{if(!de(a,s)){const a=ae();be(t,(e=>be(e,(([t,s],l)=>s!==t?le(a,l):Ce(e,l))))),be(a,(t=>bt(We[e],[s,t])))}})),be(t[4],((t,s)=>be(t,((t,a)=>es(t,je[e],Ue[e],[s,a])))))}if(!n){let s;be(t[5],((t,a)=>{let l;be(t,((t,n)=>{let r;be(t,(([t,o],c)=>{o!==t&&(bt(_e[e],[a,n,c],o,t,Xt),s=l=r=1)})),r&&bt(Ne[e],[a,n],Xt)})),l&&bt(Oe[e],[a],Xt)})),s&&bt(Je[e],void 0,Xt)}}},ss=e=>{const t=ws();t!=n&&bt(et[e],void 0,t);const s=ue(rt[e])&&ue(ot[e]),a=ue(ct[e])&&ue(at[e]);if(!s||!a){const t=e?[Se(E),Se(k)]:[E,k];if(s||es(t[0],rt[e],ot[e]),!a){let s;be(t[1],(([t,a],l)=>{a!==t&&(bt(ct[e],[l],a,t,Yt),s=1)})),s&&bt(at[e],void 0,Yt)}}},as=(e,...t)=>(Fs((()=>e(...W(t,I)))),zs),ls=()=>Me(ne),ns=()=>Te(ne),rs=e=>Te(ve(te,I(e))),os=e=>re(ve(ne,I(e))),cs=e=>Te(ve(ne,I(e))),is=(e,t,s,a=0,l)=>{return W(z((r=ve(ne,I(e)),o=(e,s)=>[J(t)?s:ve(e,I(t)),s],n=([e],[t])=>((e??0)<(t??0)?-1:1)*(s?-1:1),W([...r?.entries()??[]],(([e,t])=>o(t,e))).sort(n)),a,J(l)?l:a+l),(([,e])=>e));var n,r,o},ds=(e,t)=>Te(ve(ve(ne,I(e)),I(t))),us=(e,t,s)=>ve(ve(ve(ne,I(e)),I(t)),I(s)),gs=()=>ye(ge),hs=()=>Te(ge),bs=e=>ve(ge,I(e)),Cs=()=>!ue(ne),fs=e=>de(ne,I(e)),Ts=(e,t)=>de(ve(te,I(e)),I(t)),vs=(e,t)=>de(ve(ne,I(e)),I(t)),Vs=(e,t,s)=>de(ve(ve(ne,I(e)),I(t)),I(s)),ws=()=>!ue(ge),ps=e=>de(ge,I(e)),Is=e=>as((()=>(e=>se(e,Vt,Kt))(e)?Ht(e):0)),ys=e=>as((()=>It(e)?xt(e):0)),Rs=e=>{try{Lt(lt(e))}catch{}return zs},Ms=t=>as((()=>{if((e=se(t,(e=>se(e,Tt))))&&(St(t),!ue(ne))){const e=ls();ms(),Is(e)}})),Ss=e=>as((()=>{if(s=(e=>se(e,Tt))(e)){const t=gs();Ds(),Es(),s=!0,mt(e),ys(t)}})),ms=()=>as((()=>Ht({}))),Ls=e=>as((e=>de(ne,e)?Pt(e):0),e),Hs=(e,t)=>as(((e,t)=>D(ve(ne,e),(s=>de(s,t)?Wt(e,s,t):0))),e,t),Es=()=>as((()=>xt({}))),Js=()=>as((()=>{St({}),e=!1})),Ds=()=>as((()=>{mt({}),s=!1})),Fs=(e,t)=>{if(-1!=d){Os();const s=e();return xs(t),s}},Os=()=>(-1!=d&&d++,1==d&&(y[0]?.(),bt(it)),zs),xs=e=>(d>0&&(d--,0==d&&(d=1,Zt(1),ue(H)||ts(1),$t(1),ue(k)||ss(1),e?.(zs)&&(be(H,((e,t)=>be(e,((e,s)=>be(e,(([e],a)=>tt(zs,t,s,a,e))))))),he(H),be(k,(([e],t)=>st(zs,t,e))),he(k)),bt(dt[0],void 0),d=-1,Zt(0),ue(H)||ts(0),$t(0),ue(k)||ss(0),y[1]?.(),bt(dt[1],void 0),y[2]?.(),d=0,a=Cs(),n=ws(),P([R,M,S,m,L,H,j,E,k,U],he))),zs),zs={getContent:()=>[ls(),gs()],getTables:ls,getTableIds:ns,getTable:e=>Re(ve(ne,I(e))),getTableCellIds:rs,getRowCount:os,getRowIds:cs,getSortedRowIds:is,getRow:(e,t)=>ye(ve(ve(ne,I(e)),I(t))),getCellIds:ds,getCell:us,getValues:gs,getValueIds:hs,getValue:bs,hasTables:Cs,hasTable:fs,hasTableCell:Ts,hasRow:vs,hasCell:Vs,hasValues:ws,hasValue:ps,getTablesJson:()=>nt(ne),getValuesJson:()=>nt(ge),getJson:()=>nt([ne,ge]),getTablesSchemaJson:()=>nt(_),getValuesSchemaJson:()=>nt(B),getSchemaJson:()=>nt([_,B]),hasTablesSchema:()=>e,hasValuesSchema:()=>s,setContent:e=>as((()=>{const t=O(e)?e():e;vt(t)&&(([e,t])=>{(ee(e)?ms:Is)(e),(ee(t)?Es:ys)(t)})(t)})),setTables:Is,setTable:(e,t)=>as((e=>Vt(t,e)?Et(e,t):0),e),setRow:(e,t,s)=>as(((e,t)=>wt(e,t,s)?Jt(e,At(e),t,s):0),e,t),addRow:(e,t,s=!0)=>Fs((()=>{let a;return wt(e,a,t)&&(e=I(e),Jt(e,At(e),a=((e,t)=>{const[s]=ve(Z,e);let a;do{a=s(t)}while(de(ve(ne,e),a));return a})(e,s?1:0),t)),a})),setPartialRow:(e,t,s)=>as(((e,t)=>{if(wt(e,t,s,1)){const a=At(e);$(s,((s,l)=>Ft(e,a,t,l,s)))}}),e,t),setCell:(e,t,s,a)=>as(((e,t,s)=>D(pt(e,t,s,O(a)?a(us(e,t,s)):a),(a=>Ft(e,At(e),t,s,a)))),e,t,s),setValues:ys,setPartialValues:e=>as((()=>It(e,1)?$(e,((e,t)=>zt(t,e))):0)),setValue:(e,t)=>as((e=>D(yt(e,O(t)?t(bs(e)):t),(t=>zt(e,t)))),e),applyChanges:e=>as((()=>{$(e[0],((e,t)=>J(e)?Ls(t):$(e,((e,s)=>J(e)?Hs(t,s):$(e,((e,a)=>tt(zs,t,s,a,e))))))),$(e[1],((e,t)=>st(zs,t,e)))})),setTablesJson:Rs,setValuesJson:e=>{try{Ot(lt(e))}catch{}return zs},setJson:e=>as((()=>{try{const[t,s]=lt(e);Lt(t),Ot(s)}catch{Rs(e)}})),setTablesSchema:Ms,setValuesSchema:Ss,setSchema:(e,t)=>as((()=>{Ms(e),Ss(t)})),delTables:ms,delTable:Ls,delRow:Hs,delCell:(e,t,s,a)=>as(((e,t,s)=>D(ve(ne,e),(l=>D(ve(l,t),(n=>de(n,s)?kt(e,l,t,n,s,a):0))))),e,t,s),delValues:Es,delValue:e=>as((e=>de(ge,e)?Nt(e):0),e),delTablesSchema:Js,delValuesSchema:Ds,delSchema:()=>as((()=>{Js(),Ds()})),transaction:Fs,startTransaction:Os,getTransactionChanges:()=>[ye(H,((e,t)=>-1===ve(R,t)?void 0:ye(e,((e,s)=>-1===ve(ve(m,t),s)?void 0:ye(e,(([,e])=>e),(e=>Ze(e)))),ue,ee)),ue,ee),ye(k,(([,e])=>e),(e=>Ze(e))),1],getTransactionLog:()=>[!ue(H),!ue(k),Me(H,Ye,Ze),Me(j),ye(k,Ye,Ze),ye(U),ye(R),Re(m),Me(L),ye(E)],finishTransaction:xs,forEachTable:e=>be(ne,((t,s)=>e(s,(e=>be(t,((t,s)=>e(s,(e=>Ve(t,e))))))))),forEachTableCell:(e,t)=>Ve(ve(te,I(e)),t),forEachRow:(e,t)=>be(ve(ne,I(e)),((e,s)=>t(s,(t=>Ve(e,t))))),forEachCell:(e,t,s)=>Ve(ve(ve(ne,I(e)),I(t)),s),forEachValue:e=>Ve(ge,e),addSortedRowIdsListener:(e,t,s,a,l,n,r)=>{let o=is(e,t,s,a,l);return ht((()=>{const r=is(e,t,s,a,l);var c,i,d;i=o,A(c=r)===A(i)&&(d=(e,t)=>i[t]===e,c.every(d))||(o=r,n(zs,e,t,s,a,l,o))}),We[r?1:0],[e,t],[ns])},addStartTransactionListener:e=>ht(e,it),addWillFinishTransactionListener:e=>ht(e,dt[0]),addDidFinishTransactionListener:e=>ht(e,dt[1]),callListener:e=>(ft(e),zs),delListener:e=>(Ct(e),zs),getListenerStats:()=>({hasTables:Qe(Ee),tables:Qe(Je),tableIds:Qe(De),hasTable:Qe(Fe),table:Qe(Oe),tableCellIds:Qe(xe),hasTableCell:Qe(ze,ce),rowCount:Qe(Ae),rowIds:Qe(Pe),sortedRowIds:Qe(We),hasRow:Qe(ke,ce),row:Qe(Ne,ce),cellIds:Qe(je,ce),hasCell:Qe(Ue,ie),cell:Qe(_e,ie),invalidCell:Qe(qe,ie),hasValues:Qe(et),values:Qe(at),valueIds:Qe(rt),hasValue:Qe(ot),value:Qe(ct),invalidValue:Qe(Be),transaction:oe(it)+Qe(dt)}),isMergeable:()=>!1,createStore:gt,addListener:ht,callListeners:bt,setInternalListeners:(e,t,s,a,l)=>y=[e,t,s,a,l]};return $({[i+g]:[0,Ee,[],()=>[Cs()]],[g]:[0,Je],[h]:[0,De],[i+u]:[1,Fe,[ns],e=>[fs(...e)]],[u]:[1,Oe,[ns]],[u+v]:[1,xe,[ns]],[i+u+T]:[2,ze,[ns,rs],e=>[Ts(...e)]],[C]:[1,Ae,[ns]],[f]:[1,Pe,[ns]],[i+b]:[2,ke,[ns,cs],e=>[vs(...e)]],[b]:[2,Ne,[ns,cs]],[v]:[2,je,[ns,cs]],[i+T]:[3,Ue,[ns,cs,ds],e=>[Vs(...e)]],[T]:[3,_e,[ns,cs,ds],e=>Ke(us(...e))],InvalidCell:[3,qe],[i+w]:[0,et,[],()=>[ws()]],[w]:[0,at],[p]:[0,rt],[i+V]:[1,ot,[hs],e=>[ps(...e)]],[V]:[1,ct,[hs],e=>Ke(bs(e[0]))],InvalidValue:[1,Be]},(([e,t,s,a],l)=>{zs["add"+l+c]=(...l)=>ht(l[e],t[l[e+1]?1:0],e>0?z(l,0,e):void 0,s,a)})),K(zs)},ht=2**36,bt=2**30,Ct=2**24,ft=2**18,Tt=4096,vt={HasTable:1,Table:1,TableCellIds:1,HasTableCell:2,RowCount:1,RowIds:1,SortedRowIds:5,HasRow:2,Row:2,CellIds:2,HasCell:3,Cell:3,HasValue:1,Value:1,InvalidCell:3,InvalidValue:1},Vt=(e=t)=>[je(e),je(e)],wt=e=>{let s=1,a=Vt(),l=0;const n=fe(),r=ae(),[o,i]=(e=>{let t=0,s=-1;const a=D(e,(e=>{const t=Je(e);return ct(t/Ct)+ct(t/ft)+ct(t/Tt)+ct(t/64)+ct(t)}),(()=>((e=16)=>k(dt(new Uint8Array(e)),((e,t)=>e+ct(t)),""))(5))),l=e=>{const a=t,[l,n]=J(e)||""==e?[0,0]:[it(r=e,0)*ht+it(r,1)*bt+it(r,2)*Ct+it(r,3)*ft+it(r,4)*Tt+64*it(r,5)+it(r,6),it(r,7)*ft+it(r,8)*Tt+64*it(r,9)+it(r,10)];var r;t=L(a,l,S.HLC_TIME??Date.now()),s=t==a?t==l?L(s,n):s:t==l?n:-1};return[()=>{return l(),n=++s,ct((e=t)/ht)+ct(e/bt)+ct(e/Ct)+ct(e/ft)+ct(e/Tt)+ct(e/64)+ct(e)+ct(n/ft)+ct(n/Tt)+ct(n/64)+ct(n)+a;var e,n},l]})(e),d=gt(),u=e=>{const t=s;return s=0,e(),s=t,f},g=(e,s=0)=>{const l={},n={},[[r,o=t,c=0],d]=e,[u,g]=a,[b,C,f]=u;let T=s?c:f,v=o;Z(r,(([e,a=t,n=0],r)=>{const o=pe(b,r,je),[c,i,d]=o;let u=s?n:d,g=a;Z(e,((e,t)=>{const[a,n,o]=h(e,pe(c,t,je),te(te(l,r,Q),t,Q),s);u^=s?0:(n?Ae(t,n):0)^Ae(t,o),g=We(g,a)})),u^=s?0:Pe(i,a),ke(o,a,u),T^=s?0:(d?Ae(r,d):0)^Ae(r,o[2]),v=We(v,g)})),T^=s?0:Pe(C,o),ke(u,o,T);const[V]=h(d,g,n,s);return i(We(v,V)),[l,n,1]},h=(e,s,a,l)=>{const[n,r=t,o=0]=e,[c,i,d]=s;let u=r,g=l?o:d;return Z(n,(([e,s,n=0],r)=>{const o=pe(c,r,(()=>[void 0,t,0])),[,i,d]=o;(!i||s>i)&&(ke(o,s,l?n:Je(nt(e??null)+":"+s)),o[0]=e,a[r]=e,g^=l?0:Ae(r,d)^Ae(r,o[2]),u=We(u,s))})),g^=l?0:Pe(i,r),ke(s,r,g),[u,d,s[2]]},b=()=>[Ue(a[0],(e=>Ue(e,(e=>Ue(e))))),Ue(a[1])],C=e=>u((()=>d.applyChanges(g(e)))),f={getMergeableContent:b,getMergeableContentHashes:()=>[a[0][2],a[1][2]],getMergeableTableHashes:()=>ye(a[0][0],ze),getMergeableTableDiff:e=>{const t=Ne(a[0][1]),s={};return Ve(a[0][0],((a,[l,n,r])=>X(e,a)?r!=e[a]?s[a]=r:0:t[0][a]=_e([l,n],(e=>_e(e))))),[t,s]},getMergeableRowHashes:e=>{const t={};return Z(e,((e,s)=>D(ve(a[0][0],s),(([a,,l])=>l!=e?Ve(a,((e,[,,a])=>te(t,s,Q)[e]=a)):0)))),t},getMergeableRowDiff:e=>{const t=Ne(a[0][1]),s={};return Z(e,((e,l)=>Ve(ve(a[0][0],l)?.[0],((a,[n,r,o])=>X(e,a)?o!==e[a]?te(s,l,Q)[a]=o:0:te(t[0],l,Ne)[0][a]=_e([n,r]))))),[t,s]},getMergeableCellHashes:e=>{const t={};return Z(e,((e,s)=>D(ve(a[0][0],s),(([a])=>Z(e,((e,l)=>D(ve(a,l),(([a,,n])=>n!==e?Ve(a,((e,[,,a])=>te(te(t,s,Q),l,Q)[e]=a)):0)))))))),t},getMergeableCellDiff:e=>{const[[t,s]]=a,l={};return Z(e,((e,s)=>Z(e,((e,a)=>D(ve(t,s),(([t,n])=>D(ve(t,a),(([t,r])=>Ve(t,((t,[o,c,i])=>i!==e[t]?te(te(l,s,(()=>Ne(n)))[0],a,(()=>Ne(r)))[0][t]=[o,c]:0)))))))))),Oe(l,s)},getMergeableValueHashes:()=>ye(a[1][0],ze),getMergeableValueDiff:e=>{const[,[t,s]]=a,l=ye(t,De,(([,,t],s)=>t==e?.[s]));return Oe(l,s)},setMergeableContent:e=>u((()=>(e=>x(e)&&2==A(e)&&qe(e[0],(e=>se(e,(e=>qe(e,(e=>se(e,(e=>qe(e,(e=>se(e,(e=>qe(e,et)),void 0,1)))),void 0,1)))),void 0,1)))&&qe(e[1],(e=>se(e,(e=>qe(e,et)),void 0,1))))(e)?d.transaction((()=>{d.delTables().delValues(),a=Vt(),d.applyChanges(g(e,1))})):0)),setDefaultContent:e=>(d.transaction((()=>{l=1,d.setContent(e),l=0})),f),getTransactionMergeableChanges:(e=!1)=>{const[[t,s,l],[o,c,i]]=a,d=e?xe:Oe,u={};be(n,((e,s)=>D(ve(t,s),(([t,a,l])=>{const n={};be(e,((e,s)=>D(ve(t,s),(([t,a,l])=>{const r={};be(e,(e=>{D(ve(t,e),(([t,s,a])=>r[e]=d(t,s,a)))})),n[s]=d(r,a,l)})))),u[s]=d(n,a,l)}))));const g={};return be(r,(e=>D(ve(o,e),(([t,s,a])=>g[e]=d(t,s,a))))),[d(u,s,l),d(g,c,i),1]},applyMergeableChanges:C,merge:e=>{const t=b(),s=e.getMergeableContent();return e.applyMergeableChanges(t),C(s)}};return d.setInternalListeners((()=>{}),(()=>{}),(()=>{he(n),he(r)}),((e,a,r,c)=>{le(pe(pe(n,e,fe),a,ae),r),s&&g([[{[e]:[{[a]:[{[r]:[c,l?t:o()]}]}]}],[{}],1])}),((e,a)=>{le(r,e),s&&g([[{}],[{[e]:[a,l?t:o()]}],1])})),$(d,((e,t)=>f[t]=y(t,"set")||y(t,"del")||y(t,"apply")||R(t,"Transaction")||t=="call"+c?(...t)=>(e(...t),f):y(t,"add")&&R(t,c)?(...s)=>{const a=vt[z(t,3,-8)]??0,l=s[a];return s[a]=(e,...t)=>l(f,...t),e(...s)}:"isMergeable"==t?()=>!0:e)),K(f)};export{wt as createMergeableStore};
