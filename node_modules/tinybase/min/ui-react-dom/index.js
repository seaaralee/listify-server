import{useRowIds as e,useTableCellIds as l,useRowCount as t,useSortedRowIds as n,useValueIds as a,ValueView as o,useIndexesOrIndexesById as s,useSliceRowIds as r,useRelationshipsOrRelationshipsById as u,useResultRowIds as c,useResultTableCellIds as d,useResultRowCount as i,useResultSortedRowIds as m,useCell as h,useSetCellCallback as p,useStoreOrStoreById as b,useValue as C,useSetValueCallback as g,CellView as I,ResultCellView as y,useRemoteRowId as k}from"../ui-react/index.js";import f from"react";const N=e=>typeof e,w=N(""),v=N(!0),T=N(0),S="Value",x="currentTarget",R="value",q=Math.min,E=isFinite,P=e=>null==e,O=(e,l,t,n)=>e==w?l:e==T?t:n,{PureComponent:V,Fragment:A,createContext:F,createElement:L,useCallback:M,useContext:j,useEffect:$,useLayoutEffect:z,useMemo:B,useRef:D,useState:G,useSyncExternalStore:H}=f,J=(e,...l)=>P(e)?{}:e(...l),K=(e,l)=>e.map(l),Q=Object,U=Q.entries,W=(e=[])=>Q.fromEntries(e),X=(e,l)=>K(U(e),(([e,t])=>l(t,e))),Y="editable",Z=(e,t)=>K(l(e,t),(l=>e+"."+l)),_=(e,l,t)=>{const n=M(e,l);return t?n:void 0},ee=(...e)=>B((()=>e),e),le=(e,l)=>B((()=>({store:e,tableId:l})),[e,l]),te=(e,l)=>B((()=>({queries:e,queryId:l})),[e,l]),ne=(e,l=!1,t,n=0,a,o,s,r)=>{const[[u,c,d],i]=G([e,l,n]),m=M((e=>{i(e),r?.(e)}),[r]),h=_((e=>m([e,e==u&&!c,d])),[m,u,c,d],t),p=M((e=>m([u,c,e])),[m,u,c]),b=!0===s?Ie:s;return[[u,c,d],h,B((()=>!1===s?null:L(b,{offset:d,limit:a,total:o,onChange:p})),[s,b,d,a,o,p])]},ae=(e,l,t)=>B((()=>{const n=l??e;return a=Array.isArray(n)?W(K(n,(e=>[e,e]))):n,o=(e,l)=>{return{label:l,component:t,...(n=e,N(n)==w?{label:e}:e)};var n},W(X(a,((e,l)=>[l,o(e,l)])));var a,o}),[l,t,e]),oe=({className:e,headerRow:l,idColumn:t,params:[n,a,o,s,r,u]})=>L("table",{className:e},u?L("caption",null,u):null,!1===l?null:L("thead",null,L("tr",null,!1===t?null:L(se,{sort:s??[],label:"Id",onClick:r}),X(n,(({label:e},l)=>L(se,{key:l,cellId:l,label:e,sort:s??[],onClick:r}))))),L("tbody",null,K(o,(e=>L("tr",{key:e},!1===t?null:L("th",null,e),X(n,(({component:l,getComponentProps:t},n)=>L("td",{key:n},L(l,{...J(t,e,n),...a,rowId:e,cellId:n}))))))))),se=({cellId:e,sort:[l,t],label:n=e??"",onClick:a})=>L("th",{onClick:_((()=>a?.(e)),[a,e],a),className:P(t)||l!=e?void 0:`sorted ${t?"de":"a"}scending`},P(t)||l!=e?null:(t?"↓":"↑")+" ",n),re=({localRowId:e,params:[l,t,n,a,o,s,r]})=>{const u=k(o,e,s);return L("tr",null,!1===l?null:L(A,null,L("th",null,e),L("th",null,u)),X(t,(({component:l,getComponentProps:t},o)=>{const[s,c]=((e,l="",t)=>e.split(l,t))(o,".",2),d=s===n?e:s===a?u:null;return P(d)?null:L("td",{key:o},L(l,{...J(t,d,c),store:r,tableId:s,rowId:d,cellId:c}))})))},ue=({thing:e,onThingChange:l,className:t,hasSchema:n,showType:a=!0})=>{const[o,s]=G(),[r,u]=G(),[c,d]=G(),[i,m]=G(),[h,p]=G();r!==e&&(s((e=>{const l=N(e);return(e=>e==w||e==v)(l)||l==T&&E(e)?l:void 0})(e)),u(e),d(e+""),m(Number(e)||0),p(!!e));const b=M(((e,t)=>{t(e),u(e),l(e)}),[l]),C=M((()=>{if(!n?.()){const e=O(o,T,v,w),t=O(e,c,i,h);s(e),u(t),l(t)}}),[n,l,c,i,h,o]);return L("div",{className:t},a?L("button",{className:o,onClick:C},o):null,O(o,L("input",{key:o,value:c,onChange:M((e=>b(e[x][R]+"",d)),[b])}),L("input",{key:o,type:"number",value:i,onChange:M((e=>b(Number(e[x][R]||0),m)),[b])}),L("input",{key:o,type:"checkbox",checked:h,onChange:M((e=>b(!!e[x].checked,p)),[b])})))},ce=({tableId:t,store:n,editable:a,customCells:o,...s})=>L(oe,{...s,params:ee(ae(l(t,n),o,a?Ce:I),le(n,t),e(t,n))}),de=({tableId:e,cellId:a,descending:o,offset:s,limit:r,store:u,editable:c,sortOnClick:d,paginator:i=!1,onChange:m,customCells:h,...p})=>{const[b,C,g]=ne(a,o,d,s,r,t(e,u),i,m);return L(oe,{...p,params:ee(ae(l(e,u),h,c?Ce:I),le(u,e),n(e,...b,r,u),b,C,g)})},ie=({store:e,editable:l=!1,valueComponent:t=(l?ge:o),getValueComponentProps:n,className:s,headerRow:r,idColumn:u})=>L("table",{className:s},!1===r?null:L("thead",null,L("tr",null,!1===u?null:L("th",null,"Id"),L("th",null,S))),L("tbody",null,K(a(e),(l=>L("tr",{key:l},!1===u?null:L("th",null,l),L("td",null,L(t,{...J(n,l),valueId:l,store:e}))))))),me=({indexId:e,sliceId:t,indexes:n,editable:a,customCells:o,...u})=>{const[c,d,i]=((e,l)=>[e,e?.getStore(),e?.getTableId(l)])(s(n),e);return L(oe,{...u,params:ee(ae(l(i,d),o,a?Ce:I),le(d,i),r(e,t,c))})},he=({relationshipId:l,relationships:t,editable:n,customCells:a,className:o,headerRow:s,idColumn:r=!0})=>{const[c,d,i,m]=((e,l)=>[e,e?.getStore(),e?.getLocalTableId(l),e?.getRemoteTableId(l)])(u(t),l),h=ae([...Z(i,d),...Z(m,d)],a,n?Ce:I),p=ee(r,h,i,m,l,c,d);return L("table",{className:o},!1===s?null:L("thead",null,L("tr",null,!1===r?null:L(A,null,L("th",null,i,".Id"),L("th",null,m,".Id")),X(h,(({label:e},l)=>L("th",{key:l},e))))),L("tbody",null,K(e(i,d),(e=>L(re,{key:e,localRowId:e,params:p})))))},pe=({queryId:e,queries:l,customCells:t,...n})=>L(oe,{...n,params:ee(ae(d(e,l),t,y),te(l,e),c(e,l))}),be=({queryId:e,cellId:l,descending:t,offset:n,limit:a,queries:o,sortOnClick:s,paginator:r=!1,customCells:u,onChange:c,...h})=>{const[p,b,C]=ne(l,t,s,n,a,i(e,o),r,c);return L(oe,{...h,params:ee(ae(d(e,o),u,y),te(o,e),m(e,...p,a,o),p,b,C)})},Ce=({tableId:e,rowId:l,cellId:t,store:n,className:a,showType:o})=>L(ue,{thing:h(e,l,t,n),onThingChange:p(e,l,t,(e=>e),[],n),className:a??Y+"Cell",showType:o,hasSchema:b(n)?.hasTablesSchema}),ge=({valueId:e,store:l,className:t,showType:n})=>L(ue,{thing:C(e,l),onThingChange:g(e,(e=>e),[],l),className:t??Y+S,showType:n,hasSchema:b(l)?.hasValuesSchema}),Ie=({onChange:e,total:l,offset:t=0,limit:n=l,singular:a="row",plural:o=a+"s"})=>{(t>l||t<0)&&(t=0,e(0));const s=_((()=>e(t-n)),[e,t,n],t>0),r=_((()=>e(t+n)),[e,t,n],t+n<l);return L(A,null,l>n&&L(A,null,L("button",{className:"previous",disabled:0==t,onClick:s},"←"),L("button",{className:"next",disabled:t+n>=l,onClick:r},"→"),t+1," to ",q(l,t+n)," of "),l," ",1!=l?o:a)};export{Ce as EditableCellView,ge as EditableValueView,he as RelationshipInHtmlTable,be as ResultSortedTableInHtmlTable,pe as ResultTableInHtmlTable,me as SliceInHtmlTable,de as SortedTableInHtmlTable,Ie as SortedTablePaginator,ce as TableInHtmlTable,ie as ValuesInHtmlTable};
