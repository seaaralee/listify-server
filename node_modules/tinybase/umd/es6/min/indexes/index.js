var e,n;e=this,n=function(e){"use strict";const n=e=>typeof e,l="",t=n(l),r=e=>l+e,s=e=>null==e,o=(e,n,l)=>s(e)?void 0:n(e),d=e=>Array.isArray(e),u=e=>e.length,i=(e,n)=>e.every(n),a=(e,n)=>i(e,((l,t)=>0==t||n(e[t-1],l)<=0)),c=(e,n)=>e.sort(n),v=(e,n)=>e.forEach(n),f=(e,...n)=>e.push(...n),I=Object.freeze,h=e=>n=>{return l=(n,l)=>n+e(l),L(n).reduce(l,0);var l},g=e=>{var n;return null!=(n=null==e?void 0:e.size)?n:0},p=h(g),x=h(p),y=(e,n)=>{var l;return null!=(l=null==e?void 0:e.has(n))&&l},w=e=>s(e)||0==g(e),L=e=>{var n;return[...null!=(n=null==e?void 0:e.values())?n:[]]},S=e=>e.clear(),b=(e,n)=>null==e?void 0:e.forEach(n),R=(e,n)=>null==e?void 0:e.delete(n),T=e=>new Map(e),E=e=>{var n;return[...null!=(n=null==e?void 0:e.keys())?n:[]]},m=(e,n)=>null==e?void 0:e.get(n),j=(e,n)=>b(e,((e,l)=>n(l,e))),k=(e,n,l)=>s(l)?(R(e,n),e):null==e?void 0:e.set(n,l),z=(e,n,l,t)=>(y(e,n)?null==t||t(m(e,n)):k(e,n,l()),m(e,n)),A=(e,n,l,t,r=0)=>o((l?z:m)(e,n[r],r>u(n)-2?l:T),(s=>{if(r>u(n)-2)return(null==t?void 0:t(s))&&k(e,n[r]),s;const o=A(s,n,l,t,r+1);return w(s)&&k(e,n[r]),o})),C=e=>new Set(d(e)||s(e)?e:[e]),D=(e,n)=>null==e?void 0:e.add(n),M=(e,r)=>n(e)==t?n=>n(e):null!=e?e:()=>null!=r?r:l,B=(e,n)=>(null!=e?e:0)<(null!=n?n:0)?-1:1,O=/^\d+$/,W=(()=>{const e=new WeakMap;return n=>(e.has(n)||e.set(n,(e=>{const n=T(),t=T(),[h,g,W]=(()=>{let e;const[n,t]=(()=>{const e=[];let n=0;return[t=>{var r;return null!=(r=t?e.shift():null)?r:l+n++},n=>{O.test(n)&&u(e)<1e3&&f(e,n)}]})(),r=T();return[(t,s,o,d=[],u=()=>[])=>{null!=e||(e=X);const i=n(1);return k(r,i,[t,s,o,d,u]),D(A(s,null!=o?o:[l],C),i),i},(n,t,...s)=>v(((e,n=[l])=>{const t=[],r=(e,l)=>l==u(n)?f(t,e):null===n[l]?b(e,(e=>r(e,l+1))):v([n[l],null],(n=>r(m(e,n),l+1)));return r(e,0),t})(n,t),(n=>b(n,(n=>m(r,n)[0](e,...null!=t?t:[],...s))))),e=>o(m(r,e),(([,n,s])=>(A(n,null!=s?s:[l],void 0,(n=>(R(n,e),w(n)?1:0))),k(r,e),t(e),s))),n=>o(m(r,n),(([n,,l=[],t,r])=>{const o=(...d)=>{var i,a;const c=u(d);c==u(l)?n(e,...d,...r(d)):s(l[c])?v(null!=(a=null==(i=t[c])?void 0:i.call(t,...d))?a:[],(e=>o(...d,e))):o(...d,l[c])};o()}))]})(),[$,q,F,G,H,J,K,,N,P,Q,U]=((e,n,l,t,r)=>{const a=e.hasRow,c=T(),f=T(),I=T(),h=T(),g=T(),p=T(),x=(n,l,...t)=>{const r=z(p,n,C);return v(t,(n=>D(r,n)&&l&&e.callListener(n))),t},A=(n,...l)=>o(m(p,n),(t=>{v(0==u(l)?L(t):l,(n=>{e.delListener(n),R(t,n)})),w(t)&&k(p,n)})),M=(e,l)=>{k(c,e,l),y(f,e)||(k(f,e,n()),k(h,e,T()),k(g,e,T()),r(I))},B=e=>{k(c,e),k(f,e),k(h,e),k(g,e),A(e),r(I)};return[()=>e,()=>E(c),e=>j(f,e),e=>y(f,e),e=>m(c,e),e=>m(f,e),(e,n)=>k(f,e,n),M,(n,t,r,o,c)=>{M(n,t);const f=T(),I=T(),p=m(h,n),w=m(g,n),L=n=>{const r=l=>e.getCell(t,n,l),v=m(p,n),h=a(t,n)?l(o(r,n)):void 0;var g,x;if(v===h||d(v)&&d(h)&&(x=h,u(g=v)===u(x)&&i(g,((e,n)=>x[n]===e)))||k(f,n,[v,h]),!s(c)){const e=m(w,n),l=a(t,n)?c(r,n):void 0;e!=l&&k(I,n,l)}},R=e=>{r((()=>{b(f,(([,e],n)=>k(p,n,e))),b(I,((e,n)=>k(w,n,e)))}),f,I,p,w,e),S(f),S(I)};j(p,L),e.hasTable(t)&&v(e.getRowIds(t),(e=>{y(p,e)||L(e)})),R(!0),A(n),x(n,0,e.addRowListener(t,null,((e,n,l)=>L(l))),e.addTableListener(t,(()=>R())))},B,e=>t(e,I),()=>j(p,B),x,A]})(e,T,(e=>{return s(e)?l:d(e)?(n=r,e.map(n)):r(e);var n}),h,g),V=(n,l,t)=>{const r=H(n);b(t,((n,t)=>l(t,(l=>b(n,(n=>l(n,(l=>e.forEachCell(r,n,l)))))))))},X={setIndexDefinition:(e,l,r,d,u,i=B)=>{const v=s(u)?void 0:([e],[n])=>u(e,n);return N(e,l,((l,r,u,f,I,h)=>{let p=0;const x=C(),L=C(),S=J(e);if(b(r,(([e,n],l)=>{const t=C(e),r=C(n);b(t,(e=>R(r,e)?R(t,e):0)),b(t,(e=>{D(x,e),o(m(S,e),(n=>{R(n,l),w(n)&&(k(S,e),p=1)}))})),b(r,(e=>{D(x,e),y(S,e)||(k(S,e,C()),p=1),D(m(S,e),l),s(d)||D(L,e)}))})),l(),w(I)||(h?j(S,(e=>D(L,e))):j(u,(e=>o(m(f,e),(e=>D(L,e))))),b(L,(e=>{const n=(n,l)=>i(m(I,n),m(I,l),e),l=[...m(S,e)];a(l,n)||(k(S,e,C(c(l,n))),D(x,e))}))),(p||h)&&!s(v)){const n=[...S];a(n,v)||(K(e,T(c(n,v))),p=1)}p&&g(n,[e]),b(x,(n=>g(t,[e,n])))}),M(r),o(d,M)),X},delIndexDefinition:e=>(P(e),X),getStore:$,getIndexIds:q,forEachIndex:e=>F(((n,l)=>e(n,(e=>V(n,e,l))))),forEachSlice:(e,n)=>V(e,n,J(e)),hasIndex:G,hasSlice:(e,n)=>y(J(e),n),getTableId:H,getSliceIds:e=>E(J(e)),getSliceRowIds:(e,n)=>L(m(J(e),n)),addIndexIdsListener:Q,addSliceIdsListener:(e,l)=>h(l,n,[e]),addSliceRowIdsListener:(e,n,l)=>h(l,t,[e,n]),delListener:e=>(W(e),X),destroy:U,getListenerStats:()=>({sliceIds:p(n),sliceRowIds:x(t)})};return I(X)})(n)),e.get(n))})();e.createIndexes=W},"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseIndexes={});
