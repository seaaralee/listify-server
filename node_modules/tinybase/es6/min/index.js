const e=e=>typeof e,t="",n=e(t),l=e(!0),s=e(0),r=e(e),o="type",a="default",i="Listener",d="Result",c="add",u="Has",g="Ids",v="Table",h=v+"s",f=v+g,b="Row",I=b+"Count",w=b+g,L="Sorted"+b+g,C="Cell",R=C+g,p="Value",T=p+"s",S=p+g,y=e=>t+e,V=(e,t)=>e.startsWith(t),M=(e,t)=>e.endsWith(t),m=(e,n=t,l)=>e.split(n,l),E=globalThis,k=Math,D=k.max,x=k.min,H=k.floor,J=isFinite,O=e=>null==e,F=(e,t,n)=>O(e)?null==n?void 0:n():t(e),Q=e=>e==n||e==l,j=t=>e(t)==n,P=t=>e(t)==r,z=e=>Array.isArray(e),N=(e,t,n)=>e.slice(t,n),W=e=>e.length,A=()=>{},_=(e,t)=>e.includes(t),B=(e,t)=>e.every(t),U=(e,t)=>W(e)===W(t)&&B(e,((e,n)=>t[n]===e)),q=(e,t)=>B(e,((n,l)=>0==l||t(e[l-1],n)<=0)),G=(e,t)=>e.sort(t),K=(e,t)=>e.forEach(t),X=(e,t)=>e.map(t),Y=e=>$(e,((e,t)=>e+t),0),Z=e=>0==W(e),$=(e,t,n)=>e.reduce(t,n),ee=(e,...t)=>e.push(...t),te=e=>e.pop(),ne=e=>e.shift(),le=Object,se=e=>le.getPrototypeOf(e),re=le.entries,oe=le.isFrozen,ae=e=>!O(e)&&F(se(e),(e=>e==le.prototype||O(se(e))),(()=>!0)),ie=le.keys,de=le.freeze,ce=(e=[])=>le.fromEntries(e),ue=(e,t)=>t in e,ge=(e,t)=>(delete e[t],e),ve=(e,t)=>K(re(e),(([e,n])=>t(n,e))),he=(e,t)=>X(re(e),(([e,n])=>t(n,e))),fe=e=>ae(e)&&0==(e=>W(ie(e)))(e),be=(e,t,n)=>(ue(e,t)||(e[t]=n()),e[t]),Ie=(e,t,n,l=0)=>O(e)||!ae(e)||!l&&fe(e)||oe(e)?(null==n||n(),!1):(he(e,((n,l)=>{t(n,l)||ge(e,l)})),!!l||!fe(e)),we=e=>t=>$(ye(t),((t,n)=>t+e(n)),0),Le=e=>{var t;return null!=(t=null==e?void 0:e.size)?t:0},Ce=we(Le),Re=we(Ce),pe=we(Re),Te=(e,t)=>{var n;return null!=(n=null==e?void 0:e.has(t))&&n},Se=e=>O(e)||0==Le(e),ye=e=>{var t;return[...null!=(t=null==e?void 0:e.values())?t:[]]},Ve=e=>e.clear(),Me=(e,t)=>null==e?void 0:e.forEach(t),me=(e,t)=>null==e?void 0:e.delete(t),Ee=e=>new Map(e),ke=e=>{var t;return[...null!=(t=null==e?void 0:e.keys())?t:[]]},De=(e,t)=>null==e?void 0:e.get(t),xe=(e,t)=>Me(e,((e,n)=>t(n,e))),He=(e,t,n)=>O(n)?(me(e,t),e):null==e?void 0:e.set(t,n),Je=(e,t,n,l)=>(Te(e,t)?null==l||l(De(e,t)):He(e,t,n()),De(e,t)),Oe=(e,t,n,l=He)=>(he(t,((t,l)=>n(e,l,t))),xe(e,(n=>ue(t,n)?0:l(e,n))),e),Fe=(e,t,n,l)=>{const s={};return Me(e,((e,r)=>{if(!(null==n?void 0:n(e,r))){const n=t?t(e,r):e;(null==l?void 0:l(n))||(s[r]=n)}})),s},Qe=(e,t,n)=>Fe(e,(e=>Fe(e,t,n)),Se,fe),je=(e,t,n)=>Fe(e,(e=>Qe(e,t,n)),Se,fe),Pe=(e,t)=>{const n=Ee();return Me(e,((e,l)=>{var s;return n.set(l,null!=(s=null==t?void 0:t(e))?s:e)})),n},ze=e=>Pe(e,Pe),Ne=e=>Pe(e,ze),We=(e,t,n,l,s=0)=>F((n?Je:De)(e,t[s],s>W(t)-2?n:Ee),(r=>{if(s>W(t)-2)return(null==l?void 0:l(r))&&He(e,t[s]),r;const o=We(r,t,n,l,s+1);return Se(r)&&He(e,t[s]),o})),Ae=t=>{const n=e(t);return Q(n)||n==s&&J(t)?n:void 0},_e=e=>O(e)||!O(Ae(e)),Be=(e,t,n,l,s)=>O(s)?e.delCell(t,n,l,!0):e.setCell(t,n,l,s),Ue=(e,t,n)=>O(n)?e.delValue(t):e.setValue(t,n),qe=e=>new Set(z(e)||O(e)?e:[e]),Ge=(e,t)=>null==e?void 0:e.add(t),Ke=(e,t,n,l,s)=>{const r=e.hasRow,o=Ee(),a=Ee(),i=Ee(),d=Ee(),c=Ee(),u=Ee(),g=(t,n,...l)=>{const s=Je(u,t,qe);return K(l,(t=>Ge(s,t)&&n&&e.callListener(t))),l},v=(t,...n)=>F(De(u,t),(l=>{K(Z(n)?ye(l):n,(t=>{e.delListener(t),me(l,t)})),Se(l)&&He(u,t)})),h=(e,n)=>{He(o,e,n),Te(a,e)||(He(a,e,t()),He(d,e,Ee()),He(c,e,Ee()),s(i))},f=e=>{He(o,e),He(a,e),He(d,e),He(c,e),v(e),s(i)};return[()=>e,()=>ke(o),e=>xe(a,e),e=>Te(a,e),e=>De(o,e),e=>De(a,e),(e,t)=>He(a,e,t),h,(t,l,s,o,a)=>{h(t,l);const i=Ee(),u=Ee(),f=De(d,t),b=De(c,t),I=t=>{const s=n=>e.getCell(l,t,n),d=De(f,t),c=r(l,t)?n(o(s,t)):void 0;if(d===c||z(d)&&z(c)&&U(d,c)||He(i,t,[d,c]),!O(a)){const e=De(b,t),n=r(l,t)?a(s,t):void 0;e!=n&&He(u,t,n)}},w=e=>{s((()=>{Me(i,(([,e],t)=>He(f,t,e))),Me(u,((e,t)=>He(b,t,e)))}),i,u,f,b,e),Ve(i),Ve(u)};xe(f,I),e.hasTable(l)&&K(e.getRowIds(l),(e=>{Te(f,e)||I(e)})),w(!0),v(t),g(t,0,e.addRowListener(l,null,((e,t,n)=>I(n))),e.addTableListener(l,(()=>w())))},f,e=>l(e,i),()=>xe(u,f),g,v]},Xe=(e,n)=>j(e)?t=>t(e):null!=e?e:()=>null!=n?n:t,Ye=(e,t)=>{const n=new WeakMap;return l=>{n.has(l)||n.set(l,e(l));const s=n.get(l);return null==t||t(s),s}},Ze=/^\d+$/,$e=()=>{const e=[];let n=0;return[l=>{var s;return null!=(s=l?ne(e):null)?s:t+n++},t=>{Ze.test(t)&&W(e)<1e3&&ee(e,t)}]},et=e=>{let n;const[l,s]=$e(),r=Ee();return[(s,o,a,i=[],d=()=>[])=>{null!=n||(n=e());const c=l(1);return He(r,c,[s,o,a,i,d]),Ge(We(o,null!=a?a:[t],qe),c),c},(e,l,...s)=>K(((e,n=[t])=>{const l=[],s=(e,t)=>t==W(n)?ee(l,e):null===n[t]?Me(e,(e=>s(e,t+1))):K([n[t],null],(n=>s(De(e,n),t+1)));return s(e,0),l})(e,l),(e=>Me(e,(e=>De(r,e)[0](n,...null!=l?l:[],...s))))),e=>F(De(r,e),(([,n,l])=>(We(n,null!=l?l:[t],void 0,(t=>(me(t,e),Se(t)?1:0))),He(r,e),s(e),l))),e=>F(De(r,e),(([e,,t=[],l,s])=>{const r=(...o)=>{var a,i;const d=W(o);d==W(t)?e(n,...o,...s(o)):O(t[d])?K(null!=(i=null==(a=l[d])?void 0:a.call(l,...o))?i:[],(e=>r(...o,e))):r(...o,t[d])};r()}))]},tt=Ye((e=>{let n,l,s,r=100,o=Ee(),a=Ee(),i=1;const d=Ee(),c=Ee(),[u,g,v]=et((()=>H)),h=Ee(),f=Ee(),b=[],I=[],w=(t,n)=>{i=0,e.transaction((()=>{const[l,s]=De(h,n);Me(l,((n,l)=>Me(n,((n,s)=>Me(n,((n,r)=>Be(e,l,s,r,n[t]))))))),Me(s,((n,l)=>Ue(e,l,n[t])))})),i=1},L=e=>{He(h,e),He(f,e),g(c,[e])},C=(e,t)=>K(((e,t)=>e.splice(0,t))(e,null!=t?t:W(e)),L),R=()=>C(b,W(b)-r),p=()=>F(n,(()=>{ee(b,n),R(),C(I),n=void 0,s=1})),T=()=>{n=te(b),s=1};let S,y;const V=(e=t)=>(O(n)&&(n=t+l++,He(h,n,[o,a]),D(n,e),o=Ee(),a=Ee(),s=1),n),M=()=>{Z(b)||(((e,...t)=>{e.unshift(...t)})(I,V()),w(0,n),n=te(b),s=1)},m=()=>{Z(I)||(ee(b,n),n=ne(I),w(1,n),s=1)},E=()=>{s&&(g(d),s=0)},k=e=>{const t=V(e);return E(),t},D=(e,t)=>(x(e)&&De(f,e)!==t&&(He(f,e,t),g(c,[e])),H),x=e=>Te(h,e),H={setSize:e=>(r=e,R(),H),addCheckpoint:k,setCheckpoint:D,getStore:()=>e,getCheckpointIds:()=>[[...b],n,[...I]],forEachCheckpoint:e=>xe(f,e),hasCheckpoint:x,getCheckpoint:e=>De(f,e),goBackward:()=>(M(),E(),H),goForward:()=>(m(),E(),H),goTo:e=>{const t=_(b,e)?M:_(I,e)?m:null;for(;!O(t)&&e!=n;)t();return E(),H},addCheckpointIdsListener:e=>u(e,d),addCheckpointListener:(e,t)=>u(t,c,[e]),delListener:e=>(v(e),H),clear:()=>(C(b),C(I),O(n)||L(n),n=void 0,l=0,k(),H),clearForward:()=>(Z(I)||(C(I),g(d)),H),destroy:()=>{e.delListener(S),e.delListener(y)},getListenerStats:()=>({checkpointIds:Ce(d),checkpoint:Ce(c)}),_registerListeners:()=>{S=e.addCellListener(null,null,null,((e,t,n,l,s,r)=>{if(i){p();const e=Je(o,t,Ee),a=Je(e,n,Ee),i=Je(a,l,(()=>[r,void 0]));i[1]=s,i[0]===s&&Se(He(a,l))&&Se(He(e,n))&&Se(He(o,t))&&T(),E()}})),y=e.addValueListener(null,((e,t,n,l)=>{if(i){p();const e=Je(a,t,(()=>[l,void 0]));e[1]=n,e[0]===n&&Se(He(a,t))&&T(),E()}}))}};return de(H.clear())}),(e=>e._registerListeners())),nt=m("-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz"),lt=Ee(X(nt,((e,t)=>[e,t]))),st=e=>nt[63&e],rt=(e,t)=>{var n;return null!=(n=De(lt,e[t]))?n:0},ot=E.crypto?e=>E.crypto.getRandomValues(e):e=>X(e,(()=>H(256*k.random()))),at=(e,t)=>(null!=e?e:0)<(null!=t?t:0)?-1:1,it=(e=16)=>$(ot(new Uint8Array(e)),((e,t)=>e+st(t)),""),dt=Ye((e=>{const n=Ee(),l=Ee(),[s,r,o]=et((()=>L)),[a,i,d,c,u,g,v,,h,f,b,I]=Ke(e,Ee,(e=>O(e)?t:z(e)?X(e,y):y(e)),s,r),w=(t,n,l)=>{const s=u(t);Me(l,((t,l)=>n(l,(n=>Me(t,(t=>n(t,(n=>e.forEachCell(s,t,n)))))))))},L={setIndexDefinition:(e,t,s,o,a,i=at)=>{const d=O(a)?void 0:([e],[t])=>a(e,t);return h(e,t,((t,s,a,c,u,h)=>{let f=0;const b=qe(),I=qe(),w=g(e);if(Me(s,(([e,t],n)=>{const l=qe(e),s=qe(t);Me(l,(e=>me(s,e)?me(l,e):0)),Me(l,(e=>{Ge(b,e),F(De(w,e),(t=>{me(t,n),Se(t)&&(He(w,e),f=1)}))})),Me(s,(e=>{Ge(b,e),Te(w,e)||(He(w,e,qe()),f=1),Ge(De(w,e),n),O(o)||Ge(I,e)}))})),t(),Se(u)||(h?xe(w,(e=>Ge(I,e))):xe(a,(e=>F(De(c,e),(e=>Ge(I,e))))),Me(I,(e=>{const t=(t,n)=>i(De(u,t),De(u,n),e),n=[...De(w,e)];q(n,t)||(He(w,e,qe(G(n,t))),Ge(b,e))}))),(f||h)&&!O(d)){const t=[...w];q(t,d)||(v(e,Ee(G(t,d))),f=1)}f&&r(n,[e]),Me(b,(t=>r(l,[e,t])))}),Xe(s),F(o,Xe)),L},delIndexDefinition:e=>(f(e),L),getStore:a,getIndexIds:i,forEachIndex:e=>d(((t,n)=>e(t,(e=>w(t,e,n))))),forEachSlice:(e,t)=>w(e,t,g(e)),hasIndex:c,hasSlice:(e,t)=>Te(g(e),t),getTableId:u,getSliceIds:e=>ke(g(e)),getSliceRowIds:(e,t)=>ye(De(g(e),t)),addIndexIdsListener:b,addSliceIdsListener:(e,t)=>s(t,n,[e]),addSliceRowIdsListener:(e,t,n)=>s(n,l,[e,t]),delListener:e=>(o(e),L),destroy:I,getListenerStats:()=>({sliceIds:Ce(n),sliceRowIds:Re(l)})};return de(L)})),ct=Ee([["avg",[(e,t)=>Y(e)/t,(e,t,n)=>e+(t-e)/(n+1),(e,t,n)=>e+(e-t)/(n-1),(e,t,n,l)=>e+(t-n)/l]],["max",[e=>D(...e),(e,t)=>D(t,e),(e,t)=>t==e?void 0:e,(e,t,n)=>n==e?void 0:D(t,e)]],["min",[e=>x(...e),(e,t)=>x(t,e),(e,t)=>t==e?void 0:e,(e,t,n)=>n==e?void 0:x(t,e)]],["sum",[e=>Y(e),(e,t)=>e+t,(e,t)=>e-t,(e,t,n)=>e-n+t]]]),ut=(e,t,n,l,s,r=!1)=>{if(Se(n))return;const[o,a,i,d]=s;return r||(r=O(e)),Me(l,(([n,l])=>{r||(e=O(n)?null==a?void 0:a(e,l,t++):O(l)?null==i?void 0:i(e,n,t--):null==d?void 0:d(e,l,n,t),r||(r=O(e)))})),r?o(ye(n),Le(n)):e},gt=Ye((e=>{const n=Ee(),[l,s,r]=et((()=>I)),[o,a,i,d,c,u,g,,v,h,f,b]=Ke(e,A,(e=>isNaN(e)||O(e)||!0===e||!1===e||e===t?void 0:1*e),l,s),I={setMetricDefinition:(e,t,l,r,o,a,i)=>{var d;const c=P(l)?[l,o,a,i]:null!=(d=De(ct,l))?d:De(ct,"sum");return v(e,t,((t,l,r,o,a,i)=>{const d=u(e),v=Le(o);i||(i=O(d)),t();let h=ut(d,v,o,l,c,i);J(h)||(h=void 0),h!=d&&(g(e,h),s(n,[e],h,d))}),Xe(r,1)),I},delMetricDefinition:e=>(h(e),I),getStore:o,getMetricIds:a,forEachMetric:i,hasMetric:d,getTableId:c,getMetric:u,addMetricIdsListener:f,addMetricListener:(e,t)=>l(t,n,[e]),delListener:e=>(r(e),I),destroy:b,getListenerStats:()=>({metric:Ce(n)})};return de(I)}));var vt=Object.getOwnPropertySymbols,ht=Object.prototype.hasOwnProperty,ft=Object.prototype.propertyIsEnumerable;const bt=Ye((e=>{const n=e.createStore,l=n(),s=n(),r=Ee(),{addListener:o,callListeners:a,delListener:u}=s,[g,h,f,p,T,,,S,,y,V,M,m,E]=Ke(e,(()=>!0),A,o,a),k=(e,t,...n)=>K(n,(n=>Ge(Je(Je(r,t,Ee),e,qe),n))),D=e=>{F(De(r,e),(e=>{xe(e,((e,t)=>Me(t,(t=>e.delListener(t))))),Ve(e)})),K([s,l],(t=>t.delTable(e)))},x=(e,t,n)=>k(t,e,t.addStartTransactionListener(n.startTransaction),t.addDidFinishTransactionListener((()=>n.finishTransaction()))),H={setQueryDefinition:(n,r,o)=>{S(n,r),D(n);const a=[],i=[[null,[r,null,null,[],Ee()]]],d=[],c=[],u=[];o({select:(e,n)=>{const l=P(e)?[W(a)+t,e]:[O(n)?e:n,t=>t(e,n)];return ee(a,l),{as:e=>l[0]=e}},join:(e,t,n)=>{const l=O(n)||P(t)?null:t,s=O(l)?t:n,r=[e,[e,l,P(s)?s:e=>e(s),[],Ee()]];return ee(i,r),{as:e=>r[0]=e}},where:(e,t,n)=>ee(d,P(e)?e:O(n)?n=>n(e)===t:l=>l(e,t)===n),group:(e,t,n,l,s)=>{var r;const o=[e,[e,P(t)?[t,n,l,s]:null!=(r=De(ct,t))?r:[(e,t)=>t]]];return ee(c,o),{as:e=>o[0]=e}},having:(e,t)=>ee(u,P(e)?e:n=>n(e)===t)});const g=Ee(a);if(Se(g))return H;const v=Ee(i);xe(v,((e,[,t])=>F(De(v,t),(({3:t})=>O(e)?0:ee(t,e)))));const h=Ee(c);let f=l;if(Se(h)&&Z(u))f=s;else{x(n,f,s);const e=Ee();xe(h,((t,[n,l])=>Ge(Je(e,n,qe),[t,l])));const t=qe();xe(g,(n=>Te(e,n)?0:Ge(t,n)));const l=Ee(),r=(t,l,r,o)=>F(t,(([a,i,d,c])=>{xe(l,((t,[n])=>{const l=Je(a,t,Ee),s=De(l,r),i=o?void 0:n;if(s!==i){const n=qe([[s,i]]),o=Le(l);He(l,r,i),Me(De(e,t),(([e,t])=>{const s=ut(c[e],o,l,n,t);c[e]=O(Ae(s))?null:s}))}})),Se(i)||!B(u,(e=>e((e=>c[e]))))?s.delRow(n,d):O(d)?t[2]=s.addRow(n,c):s.setRow(n,d,c)}));k(f,n,f.addRowListener(n,null,((s,o,a,i)=>{const d=[],c=[],u=Ee(),g=f.hasRow(n,a);let v=!g;Me(t,(e=>{const[t,l,s]=i(n,a,e);ee(d,l),ee(c,s),v||(v=t)})),xe(e,(e=>{const[t,,l]=i(n,a,e);(v||t)&&He(u,e,[l])})),v&&r(We(l,d,void 0,(([,e])=>(me(e,a),Se(e)))),u,a,1),g&&r(We(l,c,(()=>{const e={};return Me(t,(t=>e[t]=f.getCell(n,a,t))),[Ee(),qe(),void 0,e]}),(([,e])=>{Ge(e,a)})),u,a)})))}x(n,e,f);const b=(t,l,s,o)=>{const a=t=>e.getCell(l,s,t);K(o,(l=>{var s;const[r,,o,i,d]=De(v,l),c=null==o?void 0:o(a,t),[u,g]=null!=(s=De(d,t))?s:[];c!=u&&(O(g)||E(n,g),He(d,t,O(c)?null:[c,...m(n,1,e.addRowListener(r,c,(()=>b(t,r,c,i))))]))})),(t=>{const l=(n,l)=>{var s,o,a;return e.getCell(...O(l)?[r,t,n]:n===r?[r,t,l]:[null==(s=De(v,n))?void 0:s[0],null==(a=De(null==(o=De(v,n))?void 0:o[4],t))?void 0:a[0],l])};f.transaction((()=>B(d,(e=>e(l)))?xe(g,((e,s)=>Be(f,n,t,e,s(l,t)))):f.delRow(n,t)))})(t)},{3:I}=De(v,null);return f.transaction((()=>m(n,1,e.addRowListener(r,null,((t,l,s)=>{e.hasRow(r,s)?b(s,r,s,I):(f.delRow(n,s),Me(v,(({4:e})=>F(De(e,s),(([,t])=>{E(n,t),He(e,s)})))))}))))),H},delQueryDefinition:e=>(D(e),y(e),H),getStore:g,getQueryIds:h,forEachQuery:f,hasQuery:p,getTableId:T,addQueryIdsListener:e=>V((()=>e(H))),delListener:e=>(u(e),H),destroy:M,getListenerStats:()=>((e,t)=>{var n={};for(var l in e)ht.call(e,l)&&t.indexOf(l)<0&&(n[l]=e[l]);if(null!=e&&vt)for(var l of vt(e))t.indexOf(l)<0&&ft.call(e,l)&&(n[l]=e[l]);return n})(s.getListenerStats(),["tables","tableIds","transaction"])};return he({[v]:[1,1],[v+R]:[0,1],[I]:[0,1],[w]:[0,1],[L]:[0,5],[b]:[1,2],[R]:[0,2],[C]:[1,3]},(([e,t],n)=>{K(e?["get","has","forEach"]:["get"],(e=>H[e+d+n]=(...t)=>s[e+n](...t))),H[c+d+n+i]=(...e)=>s[c+n+i](...N(e,0,t),((n,...l)=>e[t](H,...l)),!0)})),de(H)})),It=Ye((e=>{const n=Ee(),l=Ee(),s=Ee(),r=Ee(),[o,a,i]=et((()=>p)),[d,c,u,g,v,h,,,f,b,I,w]=Ke(e,(()=>[Ee(),Ee(),Ee(),Ee()]),(e=>O(e)?void 0:e+t),o,a),L=(e,t,n)=>F(h(e),(([l,,s])=>{if(!Te(s,t)){const r=qe();if(v(e)!=R(e))Ge(r,t);else{let e=t;for(;!O(e)&&!Te(r,e);)Ge(r,e),e=De(l,e)}if(n)return r;He(s,t,r)}return De(s,t)})),C=(e,t)=>F(h(e),(([,,e])=>He(e,t))),R=e=>De(n,e),p={setRelationshipDefinition:(e,t,o,i)=>(He(n,e,o),f(e,t,((t,n)=>{const o=qe(),i=qe(),d=qe(),[c,u]=h(e);Me(n,(([t,n],l)=>{O(t)||(Ge(i,t),F(De(u,t),(e=>{me(e,l),Se(e)&&He(u,t)}))),O(n)||(Ge(i,n),Te(u,n)||He(u,n,qe()),Ge(De(u,n),l)),Ge(o,l),He(c,l,n),xe(De(r,e),(t=>{Te(L(e,t),l)&&Ge(d,t)}))})),t(),Me(o,(t=>a(l,[e,t]))),Me(i,(t=>a(s,[e,t]))),Me(d,(t=>{C(e,t),a(r,[e,t])}))}),Xe(i)),p),delRelationshipDefinition:e=>(He(n,e),b(e),p),getStore:d,getRelationshipIds:c,forEachRelationship:t=>u((n=>t(n,(t=>e.forEachRow(v(n),t))))),hasRelationship:g,getLocalTableId:v,getRemoteTableId:R,getRemoteRowId:(e,t)=>{var n;return De(null==(n=h(e))?void 0:n[0],t)},getLocalRowIds:(e,t)=>{var n;return ye(De(null==(n=h(e))?void 0:n[1],t))},getLinkedRowIds:(e,t)=>O(h(e))?[t]:ye(L(e,t,!0)),addRelationshipIdsListener:I,addRemoteRowIdListener:(e,t,n)=>o(n,l,[e,t]),addLocalRowIdsListener:(e,t,n)=>o(n,s,[e,t]),addLinkedRowIdsListener:(e,t,n)=>(L(e,t),o(n,r,[e,t])),delListener:e=>{var t;return C(...null!=(t=i(e))?t:[]),p},destroy:w,getListenerStats:()=>({remoteRowId:Re(l),localRowIds:Re(s),linkedRowIds:Re(r)})};return de(p)})),wt=new E.TextEncoder,Lt=e=>{let t=2166136261;return K(wt.encode(e),(e=>{t^=e,t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24)})),t>>>0},Ct=([e,t])=>pt(e,t),Rt=([e,t,n])=>[e,t,n],pt=(e,t)=>t?[e,t]:[e],Tt=(e,t,n)=>[e,t,n],St=e=>e[2],yt=(e,t)=>Lt(e+":"+t),Vt=(e,t)=>t>e?(e?Lt(e):0)^Lt(t):0,Mt=(e,t)=>{var n;return null!=(n=(null!=e?e:"")>(null!=t?t:"")?e:t)?n:""},mt=(e,t,n)=>{t>e[1]&&(e[1]=t),e[2]=n>>>0},Et=(e=t)=>pt(ce(),e),kt=(e=t)=>[Ee(),e,0],Dt=([e,t,n],l=Rt)=>[Fe(e,l),t,n],xt=([e,t],n=Ct)=>pt(Fe(e,n),t),Ht=(t,n)=>z(t)&&3==W(t)&&j(t[1])&&e(t[2])==s&&J(t[2])&&n(t[0]),Jt=e=>[e,e],Ot=(e,t=Ce)=>t(e[0])+t(e[1]),Ft=()=>[Ee(),Ee()],Qt=e=>[...e],jt=([e,t])=>e===t,Pt=JSON.stringify,zt=JSON.parse,Nt=e=>Pt(e,((e,t)=>t instanceof Map?le.fromEntries([...t]):t)),Wt=(e,t,n)=>He(e,t,De(e,t)==-n?void 0:n),At=()=>{let e,t,n=!1,l=!1,r=0,d=[];const g=Ee(),L=Ee(),V=Ee(),M=Ee(),m=Ee(),E=Ee(),k=Ee(),D=Ee(),x=Ee(),H=Ee(),J=Ee(),j=Ee(),W=Ee(),A=Ee(),B=qe(),q=Ee(),Y=Ee(),Z=Ee(),$=Ee(),te=Ft(),ne=Ft(),le=Ft(),se=Ft(),re=Ft(),oe=Ft(),ae=Ft(),ie=Ft(),ce=Ft(),ve=Ft(),be=Ft(),we=Ft(),ye=Ft(),We=Ft(),_e=Ft(),Ke=Ft(),Xe=Ft(),Ye=Ft(),Ze=Ft(),tt=Ft(),nt=Ft(),lt=Ft(),st=Ee(),rt=Ft(),[ot,it,dt,ct]=et((()=>zn)),ut=e=>{if(!Ie(e,((e,t)=>_([o,a],t))))return!1;const t=e[o];return!(!Q(t)&&t!=s||(Ae(e[a])!=t&&ge(e,a),0))},gt=z,vt=(t,n)=>(!e||Te(J,n)||Yt(n))&&Ie(t,((e,t)=>ht(n,t,e)),(()=>Yt(n))),ht=(e,t,n,l)=>Ie(l?n:wt(n,e,t),((l,s)=>F(ft(e,t,s,l),(e=>(n[s]=e,!0)),(()=>!1))),(()=>Yt(e,t))),ft=(t,n,l,s)=>e?F(De(De(J,t),l),(e=>Ae(s)!=e[o]?Yt(t,n,l,s,e[a]):s),(()=>Yt(t,n,l,s))):O(Ae(s))?Yt(t,n,l,s):s,bt=(e,t)=>Ie(t?e:Lt(e),((t,n)=>F(It(n,t),(t=>(e[n]=t,!0)),(()=>!1))),(()=>Zt())),It=(e,n)=>t?F(De(W,e),(t=>Ae(n)!=t[o]?Zt(e,n,t[a]):n),(()=>Zt(e,n))):O(Ae(n))?Zt(e,n):n,wt=(e,t,n)=>(F(De(j,t),(([l,s])=>{Me(l,((t,n)=>{ue(e,n)||(e[n]=t)})),Me(s,(l=>{ue(e,l)||Yt(t,n,l)}))})),e),Lt=e=>(t&&(Me(A,((t,n)=>{ue(e,n)||(e[n]=t)})),Me(B,(t=>{ue(e,t)||Zt(t)}))),e),Ct=e=>Oe(J,e,((e,t,n)=>{const l=Ee(),s=qe();Oe(Je(J,t,Ee),n,((e,t,n)=>{He(e,t,n),F(n[a],(e=>He(l,t,e)),(()=>Ge(s,t)))})),He(j,t,[l,s])}),((e,t)=>{He(J,t),He(j,t)})),Rt=e=>Oe(W,e,((e,t,n)=>{He(W,t,n),F(n[a],(e=>He(A,t,e)),(()=>Ge(B,t)))}),((e,t)=>{He(W,t),He(A,t),me(B,t)})),pt=e=>fe(e)?Dn():Vn(e),Tt=e=>Oe(Z,e,((e,t,n)=>St(t,n)),((e,t)=>xt(t))),St=(e,t)=>Oe(Je(Z,e,(()=>(Bt(e,1),He(q,e,$e()),He(Y,e,Ee()),Ee()))),t,((t,n,l)=>yt(e,t,n,l)),((t,n)=>Ht(e,t,n))),yt=(e,t,n,l,s)=>Oe(Je(t,n,(()=>(Ut(e,n,1),Ee()))),l,((t,l,s)=>Vt(e,n,t,l,s)),((l,r)=>Pt(e,t,n,l,r,s))),Vt=(e,t,n,l,s)=>{Te(n,l)||qt(e,t,l,1);const r=De(n,l);s!==r&&(Gt(e,t,l,r,s),He(n,l,s))},Mt=(e,t,n,l,s)=>F(De(t,n),(t=>Vt(e,n,t,l,s)),(()=>yt(e,t,n,wt({[l]:s},e,n)))),mt=e=>fe(e)?Jn():Mn(e),Et=e=>Oe($,e,((e,t,n)=>kt(t,n)),((e,t)=>_t(t))),kt=(e,t)=>{Te($,e)||Kt(e,1);const n=De($,e);t!==n&&(Xt(e,n,t),He($,e,t))},Dt=e=>{var t;return null!=(t=De(Z,e))?t:St(e,{})},xt=e=>St(e,{}),Ht=(e,t,n)=>{const[,l]=De(q,e);l(n),yt(e,t,n,{},!0)},Pt=(e,t,n,l,s,r)=>{var o;const a=De(null==(o=De(j,e))?void 0:o[0],s);if(!O(a)&&!r)return Vt(e,n,l,s,a);const i=t=>{Gt(e,n,t,De(l,t)),qt(e,n,t,-1),He(l,t)};O(a)?i(s):xe(l,i),Se(l)&&(Ut(e,n,-1),Se(He(t,n))&&(Bt(e,-1),He(Z,e),He(q,e),He(Y,e)))},_t=e=>{const t=De(A,e);if(!O(t))return kt(e,t);Xt(e,De($,e)),Kt(e,-1),He($,e)},Bt=(e,t)=>Wt(g,e,t),Ut=(e,t,n)=>Wt(Je(M,e,Ee),t,n)&&He(V,e,Je(V,e,(()=>0))+n),qt=(e,t,n,l)=>{var s;const r=De(Y,e),o=null!=(s=De(r,n))?s:0;(0==o&&1==l||1==o&&-1==l)&&Wt(Je(L,e,Ee),n,l),He(r,n,o!=-l?o+l:null),Wt(Je(Je(m,e,Ee),t,Ee),n,l)},Gt=(e,t,n,l,s)=>{var r;Je(Je(Je(E,e,Ee),t,Ee),n,(()=>[l,0]))[1]=s,null==(r=d[3])||r.call(d,e,t,n,s)},Kt=(e,t)=>Wt(k,e,t),Xt=(e,t,n)=>{var l;Je(D,e,(()=>[t,0]))[1]=n,null==(l=d[4])||l.call(d,e,n)},Yt=(e,t,n,l,s)=>(ee(Je(Je(Je(x,e,Ee),t,Ee),n,(()=>[])),l),s),Zt=(e,t,n)=>(ee(Je(H,e,(()=>[])),t),n),$t=(e,t,n)=>F(De(De(De(E,e),t),n),(([e,t])=>[!0,e,t]),(()=>[!1,...Jt(fn(e,t,n))])),en=e=>F(De(D,e),(([e,t])=>[!0,e,t]),(()=>[!1,...Jt(wn(e))])),tn=e=>Se(x)||Se(Ke[e])?0:Me(e?Ne(x):x,((t,n)=>Me(t,((t,l)=>Me(t,((t,s)=>it(Ke[e],[n,l,s],t))))))),nn=e=>Se(H)||Se(Xe[e])?0:Me(e?Pe(H):H,((t,n)=>it(Xe[e],[n],t))),ln=(e,t,n,l)=>{if(!Se(e))return it(t,l,(()=>Fe(e))),xe(e,((e,t)=>it(n,[...null!=l?l:[],e],1==t))),1},sn=e=>{const t=Ln();t!=n&&it(te[e],void 0,t);const l=Se(ve[e]),s=Se(ye[e])&&Se(We[e])&&Se(ce[e])&&Se(be[e])&&Se(oe[e])&&Se(ae[e])&&Se(ie[e])&&l&&Se(le[e])&&Se(se[e]),r=Se(_e[e])&&Se(we[e])&&Se(re[e])&&Se(ne[e]);if(!s||!r){const t=e?[Pe(g),ze(L),Pe(V),ze(M),Ne(m),Ne(E)]:[g,L,V,M,m,E];if(!s){ln(t[0],le[e],se[e]),Me(t[1],((t,n)=>ln(t,oe[e],ae[e],[n]))),Me(t[2],((t,n)=>{0!=t&&it(ie[e],[n],un(n))}));const n=qe();Me(t[3],((t,s)=>{ln(t,ce[e],be[e],[s])&&!l&&(it(ve[e],[s,null]),Ge(n,s))})),l||Me(t[5],((t,l)=>{if(!Te(n,l)){const n=qe();Me(t,(e=>Me(e,(([t,l],s)=>l!==t?Ge(n,s):me(e,s))))),Me(n,(t=>it(ve[e],[l,t])))}})),Me(t[4],((t,n)=>Me(t,((t,l)=>ln(t,ye[e],We[e],[n,l])))))}if(!r){let n;Me(t[5],((t,l)=>{let s;Me(t,((t,r)=>{let o;Me(t,(([t,a],i)=>{a!==t&&(it(_e[e],[l,r,i],a,t,$t),n=s=o=1)})),o&&it(we[e],[l,r],$t)})),s&&it(re[e],[l],$t)})),n&&it(ne[e],void 0,$t)}}},rn=e=>{const t=Sn();t!=l&&it(Ye[e],void 0,t);const n=Se(tt[e])&&Se(nt[e]),s=Se(lt[e])&&Se(Ze[e]);if(!n||!s){const t=e?[Pe(k),Pe(D)]:[k,D];if(n||ln(t[0],tt[e],nt[e]),!s){let n;Me(t[1],(([t,l],s)=>{l!==t&&(it(lt[e],[s],l,t,en),n=1)})),n&&it(Ze[e],void 0,en)}}},on=(e,...t)=>(Qn((()=>e(...X(t,y)))),zn),an=()=>je(Z),dn=()=>ke(Z),cn=e=>ke(De(Y,y(e))),un=e=>Le(De(Z,y(e))),gn=e=>ke(De(Z,y(e))),vn=(e,t,n,l=0,s)=>{return X(N(G((r=De(Z,y(e)),o=(e,n)=>[O(t)?n:De(e,y(t)),n],X([...null!=(a=null==r?void 0:r.entries())?a:[]],(([e,t])=>o(t,e)))),(([e],[t])=>at(e,t)*(n?-1:1))),l,O(s)?s:l+s),(([,e])=>e));var r,o,a},hn=(e,t)=>ke(De(De(Z,y(e)),y(t))),fn=(e,t,n)=>De(De(De(Z,y(e)),y(t)),y(n)),bn=()=>Fe($),In=()=>ke($),wn=e=>De($,y(e)),Ln=()=>!Se(Z),Cn=e=>Te(Z,y(e)),Rn=(e,t)=>Te(De(Y,y(e)),y(t)),pn=(e,t)=>Te(De(Z,y(e)),y(t)),Tn=(e,t,n)=>Te(De(De(Z,y(e)),y(t)),y(n)),Sn=()=>!Se($),yn=e=>Te($,y(e)),Vn=e=>on((()=>(e=>Ie(e,vt,Yt))(e)?Tt(e):0)),Mn=e=>on((()=>bt(e)?Et(e):0)),mn=e=>{try{pt(zt(e))}catch(e){}return zn},En=t=>on((()=>{if((e=Ie(t,(e=>Ie(e,ut))))&&(Ct(t),!Se(Z))){const e=an();Dn(),Vn(e)}})),kn=e=>on((()=>{if(t=(e=>Ie(e,ut))(e)){const n=bn();Fn(),Jn(),t=!0,Rt(e),Mn(n)}})),Dn=()=>on((()=>Tt({}))),xn=e=>on((e=>Te(Z,e)?xt(e):0),e),Hn=(e,t)=>on(((e,t)=>F(De(Z,e),(n=>Te(n,t)?Ht(e,n,t):0))),e,t),Jn=()=>on((()=>Et({}))),On=()=>on((()=>{Ct({}),e=!1})),Fn=()=>on((()=>{Rt({}),t=!1})),Qn=(e,t)=>{if(-1!=r){jn();const n=e();return Pn(t),n}},jn=()=>{var e;return-1!=r&&r++,1==r&&(null==(e=d[0])||e.call(d),it(st)),zn},Pn=e=>{var t,s;return r>0&&(r--,0==r&&(r=1,tn(1),Se(E)||sn(1),nn(1),Se(D)||rn(1),(null==e?void 0:e(zn))&&(Me(E,((e,t)=>Me(e,((e,n)=>Me(e,(([e],l)=>Be(zn,t,n,l,e))))))),Ve(E),Me(D,(([e],t)=>Ue(zn,t,e))),Ve(D)),it(rt[0],void 0),r=-1,tn(0),Se(E)||sn(0),nn(0),Se(D)||rn(0),null==(t=d[1])||t.call(d),it(rt[1],void 0),null==(s=d[2])||s.call(d),r=0,n=Ln(),l=Sn(),K([g,L,V,M,m,E,x,k,D,H],Ve))),zn},zn={getContent:()=>[an(),bn()],getTables:an,getTableIds:dn,getTable:e=>Qe(De(Z,y(e))),getTableCellIds:cn,getRowCount:un,getRowIds:gn,getSortedRowIds:vn,getRow:(e,t)=>Fe(De(De(Z,y(e)),y(t))),getCellIds:hn,getCell:fn,getValues:bn,getValueIds:In,getValue:wn,hasTables:Ln,hasTable:Cn,hasTableCell:Rn,hasRow:pn,hasCell:Tn,hasValues:Sn,hasValue:yn,getTablesJson:()=>Nt(Z),getValuesJson:()=>Nt($),getJson:()=>Nt([Z,$]),getTablesSchemaJson:()=>Nt(J),getValuesSchemaJson:()=>Nt(W),getSchemaJson:()=>Nt([J,W]),hasTablesSchema:()=>e,hasValuesSchema:()=>t,setContent:e=>on((()=>{const t=P(e)?e():e;gt(t)&&(([e,t])=>{(fe(e)?Dn:Vn)(e),(fe(t)?Jn:Mn)(t)})(t)})),setTables:Vn,setTable:(e,t)=>on((e=>vt(t,e)?St(e,t):0),e),setRow:(e,t,n)=>on(((e,t)=>ht(e,t,n)?yt(e,Dt(e),t,n):0),e,t),addRow:(e,t,n=!0)=>Qn((()=>{let l;return ht(e,l,t)&&(e=y(e),yt(e,Dt(e),l=((e,t)=>{const[n]=De(q,e);let l;do{l=n(t)}while(Te(De(Z,e),l));return l})(e,n?1:0),t)),l})),setPartialRow:(e,t,n)=>on(((e,t)=>{if(ht(e,t,n,1)){const l=Dt(e);he(n,((n,s)=>Mt(e,l,t,s,n)))}}),e,t),setCell:(e,t,n,l)=>on(((e,t,n)=>F(ft(e,t,n,P(l)?l(fn(e,t,n)):l),(l=>Mt(e,Dt(e),t,n,l)))),e,t,n),setValues:Mn,setPartialValues:e=>on((()=>bt(e,1)?he(e,((e,t)=>kt(t,e))):0)),setValue:(e,t)=>on((e=>F(It(e,P(t)?t(wn(e)):t),(t=>kt(e,t)))),e),applyChanges:e=>on((()=>{he(e[0],((e,t)=>O(e)?xn(t):he(e,((e,n)=>O(e)?Hn(t,n):he(e,((e,l)=>Be(zn,t,n,l,e))))))),he(e[1],((e,t)=>Ue(zn,t,e)))})),setTablesJson:mn,setValuesJson:e=>{try{mt(zt(e))}catch(e){}return zn},setJson:e=>on((()=>{try{const[t,n]=zt(e);pt(t),mt(n)}catch(t){mn(e)}})),setTablesSchema:En,setValuesSchema:kn,setSchema:(e,t)=>on((()=>{En(e),kn(t)})),delTables:Dn,delTable:xn,delRow:Hn,delCell:(e,t,n,l)=>on(((e,t,n)=>F(De(Z,e),(s=>F(De(s,t),(r=>Te(r,n)?Pt(e,s,t,r,n,l):0))))),e,t,n),delValues:Jn,delValue:e=>on((e=>Te($,e)?_t(e):0),e),delTablesSchema:On,delValuesSchema:Fn,delSchema:()=>on((()=>{On(),Fn()})),transaction:Qn,startTransaction:jn,getTransactionChanges:()=>[Fe(E,((e,t)=>-1===De(g,t)?void 0:Fe(e,((e,n)=>-1===De(De(M,t),n)?void 0:Fe(e,(([,e])=>e),(e=>jt(e)))),Se,fe)),Se,fe),Fe(D,(([,e])=>e),(e=>jt(e))),1],getTransactionLog:()=>[!Se(E),!Se(D),je(E,Qt,jt),je(x),Fe(D,Qt,jt),Fe(H),Fe(g),Qe(M),je(m),Fe(k)],finishTransaction:Pn,forEachTable:e=>Me(Z,((t,n)=>e(n,(e=>Me(t,((t,n)=>e(n,(e=>xe(t,e))))))))),forEachTableCell:(e,t)=>xe(De(Y,y(e)),t),forEachRow:(e,t)=>Me(De(Z,y(e)),((e,n)=>t(n,(t=>xe(e,t))))),forEachCell:(e,t,n)=>xe(De(De(Z,y(e)),y(t)),n),forEachValue:e=>xe($,e),addSortedRowIdsListener:(e,t,n,l,s,r,o)=>{let a=vn(e,t,n,l,s);return ot((()=>{const o=vn(e,t,n,l,s);U(o,a)||(a=o,r(zn,e,t,n,l,s,a))}),ve[o?1:0],[e,t],[dn])},addStartTransactionListener:e=>ot(e,st),addWillFinishTransactionListener:e=>ot(e,rt[0]),addDidFinishTransactionListener:e=>ot(e,rt[1]),callListener:e=>(ct(e),zn),delListener:e=>(dt(e),zn),getListenerStats:()=>({hasTables:Ot(te),tables:Ot(ne),tableIds:Ot(le),hasTable:Ot(se),table:Ot(re),tableCellIds:Ot(oe),hasTableCell:Ot(ae,Re),rowCount:Ot(ie),rowIds:Ot(ce),sortedRowIds:Ot(ve),hasRow:Ot(be,Re),row:Ot(we,Re),cellIds:Ot(ye,Re),hasCell:Ot(We,pe),cell:Ot(_e,pe),invalidCell:Ot(Ke,pe),hasValues:Ot(Ye),values:Ot(Ze),valueIds:Ot(tt),hasValue:Ot(nt),value:Ot(lt),invalidValue:Ot(Xe),transaction:Ce(st)+Ot(rt)}),isMergeable:()=>!1,createStore:At,addListener:ot,callListeners:it,setInternalListeners:(e,t,n,l,s)=>d=[e,t,n,l,s]};return he({[u+h]:[0,te,[],()=>[Ln()]],[h]:[0,ne],[f]:[0,le],[u+v]:[1,se,[dn],e=>[Cn(...e)]],[v]:[1,re,[dn]],[v+R]:[1,oe,[dn]],[u+v+C]:[2,ae,[dn,cn],e=>[Rn(...e)]],[I]:[1,ie,[dn]],[w]:[1,ce,[dn]],[u+b]:[2,be,[dn,gn],e=>[pn(...e)]],[b]:[2,we,[dn,gn]],[R]:[2,ye,[dn,gn]],[u+C]:[3,We,[dn,gn,hn],e=>[Tn(...e)]],[C]:[3,_e,[dn,gn,hn],e=>Jt(fn(...e))],InvalidCell:[3,Ke],[u+T]:[0,Ye,[],()=>[Sn()]],[T]:[0,Ze],[S]:[0,tt],[u+p]:[1,nt,[In],e=>[yn(...e)]],[p]:[1,lt,[In],e=>Jt(wn(e[0]))],InvalidValue:[1,Xe]},(([e,t,n,l],s)=>{zn[c+s+i]=(...s)=>ot(s[e],t[s[e+1]?1:0],e>0?N(s,0,e):void 0,n,l)})),de(zn)};var _t=Math.pow;const Bt=_t(2,36),Ut=_t(2,30),qt=_t(2,24),Gt=_t(2,18),Kt=_t(2,12),Xt=_t(2,6),Yt={HasTable:1,Table:1,TableCellIds:1,HasTableCell:2,RowCount:1,RowIds:1,SortedRowIds:5,HasRow:2,Row:2,CellIds:2,HasCell:3,Cell:3,HasValue:1,Value:1,InvalidCell:3,InvalidValue:1},Zt=(e=t)=>[kt(e),kt(e)],$t=e=>{let n=1,l=Zt(),s=0;const r=Ee(),o=qe(),[a,d]=(e=>{let t=0,n=-1;const l=F(e,(e=>{const t=Lt(e);return st(t/qt)+st(t/Gt)+st(t/Kt)+st(t/Xt)+st(t)}),(()=>it(5))),s=e=>{var l;const s=t,[r,o]=O(e)||""==e?[0,0]:[rt(a=e,0)*Bt+rt(a,1)*Ut+rt(a,2)*qt+rt(a,3)*Gt+rt(a,4)*Kt+rt(a,5)*Xt+rt(a,6),rt(a,7)*Gt+rt(a,8)*Kt+rt(a,9)*Xt+rt(a,10)];var a;t=D(s,r,null!=(l=E.HLC_TIME)?l:Date.now()),n=t==s?t==r?D(n,o):n:t==r?o:-1};return[()=>{return s(),r=++n,st((e=t)/Bt)+st(e/Ut)+st(e/qt)+st(e/Gt)+st(e/Kt)+st(e/Xt)+st(e)+st(r/Gt)+st(r/Kt)+st(r/Xt)+st(r)+l;var e,r},s]})(e),u=At(),g=e=>{const t=n;return n=0,e(),n=t,I},v=(e,n=0)=>{const s={},r={},[[o,a=t,i=0],c]=e,[u,g]=l,[v,f,b]=u;let I=n?i:b,w=a;ve(o,(([e,l=t,r=0],o)=>{const a=Je(v,o,kt),[i,d,c]=a;let u=n?r:c,g=l;ve(e,((e,t)=>{const[l,r,a]=h(e,Je(i,t,kt),be(be(s,o,ce),t,ce),n);u^=n?0:(r?yt(t,r):0)^yt(t,a),g=Mt(g,l)})),u^=n?0:Vt(d,l),mt(a,l,u),I^=n?0:(c?yt(o,c):0)^yt(o,a[2]),w=Mt(w,g)})),I^=n?0:Vt(f,a),mt(u,a,I);const[L]=h(c,g,r,n);return d(Mt(w,L)),[s,r,1]},h=(e,n,l,s)=>{const[r,o=t,a=0]=e,[i,d,c]=n;let u=o,g=s?a:c;return ve(r,(([e,n,r=0],o)=>{const a=Je(i,o,(()=>[void 0,t,0])),[,d,c]=a;(!d||n>d)&&(mt(a,n,s?r:Lt(Nt(null!=e?e:null)+":"+n)),a[0]=e,l[o]=e,g^=s?0:yt(o,c)^yt(o,a[2]),u=Mt(u,n))})),g^=s?0:Vt(d,o),mt(n,o,g),[u,c,n[2]]},f=()=>[Dt(l[0],(e=>Dt(e,(e=>Dt(e))))),Dt(l[1])],b=e=>g((()=>u.applyChanges(v(e)))),I={getMergeableContent:f,getMergeableContentHashes:()=>[l[0][2],l[1][2]],getMergeableTableHashes:()=>Fe(l[0][0],St),getMergeableTableDiff:e=>{const t=Et(l[0][1]),n={};return xe(l[0][0],((l,[s,r,o])=>ue(e,l)?o!=e[l]?n[l]=o:0:t[0][l]=xt([s,r],(e=>xt(e))))),[t,n]},getMergeableRowHashes:e=>{const t={};return ve(e,((e,n)=>F(De(l[0][0],n),(([l,,s])=>s!=e?xe(l,((e,[,,l])=>be(t,n,ce)[e]=l)):0)))),t},getMergeableRowDiff:e=>{const t=Et(l[0][1]),n={};return ve(e,((e,s)=>{var r;return xe(null==(r=De(l[0][0],s))?void 0:r[0],((l,[r,o,a])=>ue(e,l)?a!==e[l]?be(n,s,ce)[l]=a:0:be(t[0],s,Et)[0][l]=xt([r,o])))})),[t,n]},getMergeableCellHashes:e=>{const t={};return ve(e,((e,n)=>F(De(l[0][0],n),(([l])=>ve(e,((e,s)=>F(De(l,s),(([l,,r])=>r!==e?xe(l,((e,[,,l])=>be(be(t,n,ce),s,ce)[e]=l)):0)))))))),t},getMergeableCellDiff:e=>{const[[t,n]]=l,s={};return ve(e,((e,n)=>ve(e,((e,l)=>F(De(t,n),(([t,r])=>F(De(t,l),(([t,o])=>xe(t,((t,[a,i,d])=>d!==e[t]?be(be(s,n,(()=>Et(r)))[0],l,(()=>Et(o)))[0][t]=[a,i]:0)))))))))),pt(s,n)},getMergeableValueHashes:()=>Fe(l[1][0],St),getMergeableValueDiff:e=>{const[,[t,n]]=l,s=Fe(t,Ct,(([,,t],n)=>t==(null==e?void 0:e[n])));return pt(s,n)},setMergeableContent:e=>g((()=>(e=>z(e)&&2==W(e)&&Ht(e[0],(e=>Ie(e,(e=>Ht(e,(e=>Ie(e,(e=>Ht(e,(e=>Ie(e,(e=>Ht(e,_e)),void 0,1)))),void 0,1)))),void 0,1)))&&Ht(e[1],(e=>Ie(e,(e=>Ht(e,_e)),void 0,1))))(e)?u.transaction((()=>{u.delTables().delValues(),l=Zt(),u.applyChanges(v(e,1))})):0)),setDefaultContent:e=>(u.transaction((()=>{s=1,u.setContent(e),s=0})),I),getTransactionMergeableChanges:(e=!1)=>{const[[t,n,s],[a,i,d]]=l,c=e?Tt:pt,u={};Me(r,((e,n)=>F(De(t,n),(([t,l,s])=>{const r={};Me(e,((e,n)=>F(De(t,n),(([t,l,s])=>{const o={};Me(e,(e=>{F(De(t,e),(([t,n,l])=>o[e]=c(t,n,l)))})),r[n]=c(o,l,s)})))),u[n]=c(r,l,s)}))));const g={};return Me(o,(e=>F(De(a,e),(([t,n,l])=>g[e]=c(t,n,l))))),[c(u,n,s),c(g,i,d),1]},applyMergeableChanges:b,merge:e=>{const t=f(),n=e.getMergeableContent();return e.applyMergeableChanges(t),b(n)}};return u.setInternalListeners((()=>{}),(()=>{}),(()=>{Ve(r),Ve(o)}),((e,l,o,i)=>{Ge(Je(Je(r,e,Ee),l,qe),o),n&&v([[{[e]:[{[l]:[{[o]:[i,s?t:a()]}]}]}],[{}],1])}),((e,l)=>{Ge(o,e),n&&v([[{}],[{[e]:[l,s?t:a()]}],1])})),he(u,((e,t)=>I[t]=V(t,"set")||V(t,"del")||V(t,"apply")||M(t,"Transaction")||t=="call"+i?(...t)=>(e(...t),I):V(t,c)&&M(t,i)?(...n)=>{var l;const s=null!=(l=Yt[N(t,3,-8)])?l:0,r=n[s];return n[s]=(e,...t)=>r(I,...t),e(...n)}:"isMergeable"==t?()=>!0:e)),de(I)};export{tt as createCheckpoints,dt as createIndexes,$t as createMergeableStore,gt as createMetrics,bt as createQueries,It as createRelationships,At as createStore,at as defaultSorter,it as getUniqueId};
