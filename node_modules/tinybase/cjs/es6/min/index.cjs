"use strict";const e=e=>typeof e,t="",n=e(t),l=e(!0),s=e(0),r=e(e),o="type",a="default",i="Listener",d="Result",c="add",u="Has",g="Ids",v="Table",h=v+"s",f=v+g,b="Row",I=b+"Count",p=b+g,w="Sorted"+b+g,L="Cell",C=L+g,R="Value",T=R+"s",S=R+g,y=e=>t+e,M=(e,t)=>e.startsWith(t),V=(e,t)=>e.endsWith(t),m=(e,n=t,l)=>e.split(n,l),x=globalThis,E=Math,k=E.max,D=E.min,H=E.floor,J=isFinite,O=e=>null==e,F=(e,t,n)=>O(e)?null==n?void 0:n():t(e),Q=e=>e==n||e==l,j=t=>e(t)==n,P=t=>e(t)==r,z=e=>Array.isArray(e),N=(e,t,n)=>e.slice(t,n),W=e=>e.length,A=()=>{},_=(e,t)=>e.includes(t),U=(e,t)=>e.every(t),q=(e,t)=>W(e)===W(t)&&U(e,((e,n)=>t[n]===e)),B=(e,t)=>U(e,((n,l)=>0==l||t(e[l-1],n)<=0)),G=(e,t)=>e.sort(t),K=(e,t)=>e.forEach(t),X=(e,t)=>e.map(t),Y=e=>$(e,((e,t)=>e+t),0),Z=e=>0==W(e),$=(e,t,n)=>e.reduce(t,n),ee=(e,...t)=>e.push(...t),te=e=>e.pop(),ne=e=>e.shift(),le=Object,se=e=>le.getPrototypeOf(e),re=le.entries,oe=le.isFrozen,ae=e=>!O(e)&&F(se(e),(e=>e==le.prototype||O(se(e))),(()=>!0)),ie=le.keys,de=le.freeze,ce=(e=[])=>le.fromEntries(e),ue=(e,t)=>t in e,ge=(e,t)=>(delete e[t],e),ve=(e,t)=>K(re(e),(([e,n])=>t(n,e))),he=(e,t)=>X(re(e),(([e,n])=>t(n,e))),fe=e=>ae(e)&&0==(e=>W(ie(e)))(e),be=(e,t,n)=>(ue(e,t)||(e[t]=n()),e[t]),Ie=(e,t,n,l=0)=>O(e)||!ae(e)||!l&&fe(e)||oe(e)?(null==n||n(),!1):(he(e,((n,l)=>{t(n,l)||ge(e,l)})),!!l||!fe(e)),pe=e=>t=>$(ye(t),((t,n)=>t+e(n)),0),we=e=>{var t;return null!=(t=null==e?void 0:e.size)?t:0},Le=pe(we),Ce=pe(Le),Re=pe(Ce),Te=(e,t)=>{var n;return null!=(n=null==e?void 0:e.has(t))&&n},Se=e=>O(e)||0==we(e),ye=e=>{var t;return[...null!=(t=null==e?void 0:e.values())?t:[]]},Me=e=>e.clear(),Ve=(e,t)=>null==e?void 0:e.forEach(t),me=(e,t)=>null==e?void 0:e.delete(t),xe=e=>new Map(e),Ee=e=>{var t;return[...null!=(t=null==e?void 0:e.keys())?t:[]]},ke=(e,t)=>null==e?void 0:e.get(t),De=(e,t)=>Ve(e,((e,n)=>t(n,e))),He=(e,t,n)=>O(n)?(me(e,t),e):null==e?void 0:e.set(t,n),Je=(e,t,n,l)=>(Te(e,t)?null==l||l(ke(e,t)):He(e,t,n()),ke(e,t)),Oe=(e,t,n,l=He)=>(he(t,((t,l)=>n(e,l,t))),De(e,(n=>ue(t,n)?0:l(e,n))),e),Fe=(e,t,n,l)=>{const s={};return Ve(e,((e,r)=>{if(!(null==n?void 0:n(e,r))){const n=t?t(e,r):e;(null==l?void 0:l(n))||(s[r]=n)}})),s},Qe=(e,t,n)=>Fe(e,(e=>Fe(e,t,n)),Se,fe),je=(e,t,n)=>Fe(e,(e=>Qe(e,t,n)),Se,fe),Pe=(e,t)=>{const n=xe();return Ve(e,((e,l)=>{var s;return n.set(l,null!=(s=null==t?void 0:t(e))?s:e)})),n},ze=e=>Pe(e,Pe),Ne=e=>Pe(e,ze),We=(e,t,n,l,s=0)=>F((n?Je:ke)(e,t[s],s>W(t)-2?n:xe),(r=>{if(s>W(t)-2)return(null==l?void 0:l(r))&&He(e,t[s]),r;const o=We(r,t,n,l,s+1);return Se(r)&&He(e,t[s]),o})),Ae=t=>{const n=e(t);return Q(n)||n==s&&J(t)?n:void 0},_e=e=>O(e)||!O(Ae(e)),Ue=(e,t,n,l,s)=>O(s)?e.delCell(t,n,l,!0):e.setCell(t,n,l,s),qe=(e,t,n)=>O(n)?e.delValue(t):e.setValue(t,n),Be=e=>new Set(z(e)||O(e)?e:[e]),Ge=(e,t)=>null==e?void 0:e.add(t),Ke=(e,t,n,l,s)=>{const r=e.hasRow,o=xe(),a=xe(),i=xe(),d=xe(),c=xe(),u=xe(),g=(t,n,...l)=>{const s=Je(u,t,Be);return K(l,(t=>Ge(s,t)&&n&&e.callListener(t))),l},v=(t,...n)=>F(ke(u,t),(l=>{K(Z(n)?ye(l):n,(t=>{e.delListener(t),me(l,t)})),Se(l)&&He(u,t)})),h=(e,n)=>{He(o,e,n),Te(a,e)||(He(a,e,t()),He(d,e,xe()),He(c,e,xe()),s(i))},f=e=>{He(o,e),He(a,e),He(d,e),He(c,e),v(e),s(i)};return[()=>e,()=>Ee(o),e=>De(a,e),e=>Te(a,e),e=>ke(o,e),e=>ke(a,e),(e,t)=>He(a,e,t),h,(t,l,s,o,a)=>{h(t,l);const i=xe(),u=xe(),f=ke(d,t),b=ke(c,t),I=t=>{const s=n=>e.getCell(l,t,n),d=ke(f,t),c=r(l,t)?n(o(s,t)):void 0;if(d===c||z(d)&&z(c)&&q(d,c)||He(i,t,[d,c]),!O(a)){const e=ke(b,t),n=r(l,t)?a(s,t):void 0;e!=n&&He(u,t,n)}},p=e=>{s((()=>{Ve(i,(([,e],t)=>He(f,t,e))),Ve(u,((e,t)=>He(b,t,e)))}),i,u,f,b,e),Me(i),Me(u)};De(f,I),e.hasTable(l)&&K(e.getRowIds(l),(e=>{Te(f,e)||I(e)})),p(!0),v(t),g(t,0,e.addRowListener(l,null,((e,t,n)=>I(n))),e.addTableListener(l,(()=>p())))},f,e=>l(e,i),()=>De(u,f),g,v]},Xe=(e,n)=>j(e)?t=>t(e):null!=e?e:()=>null!=n?n:t,Ye=(e,t)=>{const n=new WeakMap;return l=>{n.has(l)||n.set(l,e(l));const s=n.get(l);return null==t||t(s),s}},Ze=/^\d+$/,$e=()=>{const e=[];let n=0;return[l=>{var s;return null!=(s=l?ne(e):null)?s:t+n++},t=>{Ze.test(t)&&W(e)<1e3&&ee(e,t)}]},et=e=>{let n;const[l,s]=$e(),r=xe();return[(s,o,a,i=[],d=()=>[])=>{null!=n||(n=e());const c=l(1);return He(r,c,[s,o,a,i,d]),Ge(We(o,null!=a?a:[t],Be),c),c},(e,l,...s)=>K(((e,n=[t])=>{const l=[],s=(e,t)=>t==W(n)?ee(l,e):null===n[t]?Ve(e,(e=>s(e,t+1))):K([n[t],null],(n=>s(ke(e,n),t+1)));return s(e,0),l})(e,l),(e=>Ve(e,(e=>ke(r,e)[0](n,...null!=l?l:[],...s))))),e=>F(ke(r,e),(([,n,l])=>(We(n,null!=l?l:[t],void 0,(t=>(me(t,e),Se(t)?1:0))),He(r,e),s(e),l))),e=>F(ke(r,e),(([e,,t=[],l,s])=>{const r=(...o)=>{var a,i;const d=W(o);d==W(t)?e(n,...o,...s(o)):O(t[d])?K(null!=(i=null==(a=l[d])?void 0:a.call(l,...o))?i:[],(e=>r(...o,e))):r(...o,t[d])};r()}))]},tt=Ye((e=>{let n,l,s,r=100,o=xe(),a=xe(),i=1;const d=xe(),c=xe(),[u,g,v]=et((()=>H)),h=xe(),f=xe(),b=[],I=[],p=(t,n)=>{i=0,e.transaction((()=>{const[l,s]=ke(h,n);Ve(l,((n,l)=>Ve(n,((n,s)=>Ve(n,((n,r)=>Ue(e,l,s,r,n[t]))))))),Ve(s,((n,l)=>qe(e,l,n[t])))})),i=1},w=e=>{He(h,e),He(f,e),g(c,[e])},L=(e,t)=>K(((e,t)=>e.splice(0,t))(e,null!=t?t:W(e)),w),C=()=>L(b,W(b)-r),R=()=>F(n,(()=>{ee(b,n),C(),L(I),n=void 0,s=1})),T=()=>{n=te(b),s=1};let S,y;const M=(e=t)=>(O(n)&&(n=t+l++,He(h,n,[o,a]),k(n,e),o=xe(),a=xe(),s=1),n),V=()=>{Z(b)||(((e,...t)=>{e.unshift(...t)})(I,M()),p(0,n),n=te(b),s=1)},m=()=>{Z(I)||(ee(b,n),n=ne(I),p(1,n),s=1)},x=()=>{s&&(g(d),s=0)},E=e=>{const t=M(e);return x(),t},k=(e,t)=>(D(e)&&ke(f,e)!==t&&(He(f,e,t),g(c,[e])),H),D=e=>Te(h,e),H={setSize:e=>(r=e,C(),H),addCheckpoint:E,setCheckpoint:k,getStore:()=>e,getCheckpointIds:()=>[[...b],n,[...I]],forEachCheckpoint:e=>De(f,e),hasCheckpoint:D,getCheckpoint:e=>ke(f,e),goBackward:()=>(V(),x(),H),goForward:()=>(m(),x(),H),goTo:e=>{const t=_(b,e)?V:_(I,e)?m:null;for(;!O(t)&&e!=n;)t();return x(),H},addCheckpointIdsListener:e=>u(e,d),addCheckpointListener:(e,t)=>u(t,c,[e]),delListener:e=>(v(e),H),clear:()=>(L(b),L(I),O(n)||w(n),n=void 0,l=0,E(),H),clearForward:()=>(Z(I)||(L(I),g(d)),H),destroy:()=>{e.delListener(S),e.delListener(y)},getListenerStats:()=>({checkpointIds:Le(d),checkpoint:Le(c)}),_registerListeners:()=>{S=e.addCellListener(null,null,null,((e,t,n,l,s,r)=>{if(i){R();const e=Je(o,t,xe),a=Je(e,n,xe),i=Je(a,l,(()=>[r,void 0]));i[1]=s,i[0]===s&&Se(He(a,l))&&Se(He(e,n))&&Se(He(o,t))&&T(),x()}})),y=e.addValueListener(null,((e,t,n,l)=>{if(i){R();const e=Je(a,t,(()=>[l,void 0]));e[1]=n,e[0]===n&&Se(He(a,t))&&T(),x()}}))}};return de(H.clear())}),(e=>e._registerListeners())),nt=m("-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz"),lt=xe(X(nt,((e,t)=>[e,t]))),st=e=>nt[63&e],rt=(e,t)=>{var n;return null!=(n=ke(lt,e[t]))?n:0},ot=x.crypto?e=>x.crypto.getRandomValues(e):e=>X(e,(()=>H(256*E.random()))),at=(e,t)=>(null!=e?e:0)<(null!=t?t:0)?-1:1,it=(e=16)=>$(ot(new Uint8Array(e)),((e,t)=>e+st(t)),""),dt=Ye((e=>{const n=xe(),l=xe(),[s,r,o]=et((()=>w)),[a,i,d,c,u,g,v,,h,f,b,I]=Ke(e,xe,(e=>O(e)?t:z(e)?X(e,y):y(e)),s,r),p=(t,n,l)=>{const s=u(t);Ve(l,((t,l)=>n(l,(n=>Ve(t,(t=>n(t,(n=>e.forEachCell(s,t,n)))))))))},w={setIndexDefinition:(e,t,s,o,a,i=at)=>{const d=O(a)?void 0:([e],[t])=>a(e,t);return h(e,t,((t,s,a,c,u,h)=>{let f=0;const b=Be(),I=Be(),p=g(e);if(Ve(s,(([e,t],n)=>{const l=Be(e),s=Be(t);Ve(l,(e=>me(s,e)?me(l,e):0)),Ve(l,(e=>{Ge(b,e),F(ke(p,e),(t=>{me(t,n),Se(t)&&(He(p,e),f=1)}))})),Ve(s,(e=>{Ge(b,e),Te(p,e)||(He(p,e,Be()),f=1),Ge(ke(p,e),n),O(o)||Ge(I,e)}))})),t(),Se(u)||(h?De(p,(e=>Ge(I,e))):De(a,(e=>F(ke(c,e),(e=>Ge(I,e))))),Ve(I,(e=>{const t=(t,n)=>i(ke(u,t),ke(u,n),e),n=[...ke(p,e)];B(n,t)||(He(p,e,Be(G(n,t))),Ge(b,e))}))),(f||h)&&!O(d)){const t=[...p];B(t,d)||(v(e,xe(G(t,d))),f=1)}f&&r(n,[e]),Ve(b,(t=>r(l,[e,t])))}),Xe(s),F(o,Xe)),w},delIndexDefinition:e=>(f(e),w),getStore:a,getIndexIds:i,forEachIndex:e=>d(((t,n)=>e(t,(e=>p(t,e,n))))),forEachSlice:(e,t)=>p(e,t,g(e)),hasIndex:c,hasSlice:(e,t)=>Te(g(e),t),getTableId:u,getSliceIds:e=>Ee(g(e)),getSliceRowIds:(e,t)=>ye(ke(g(e),t)),addIndexIdsListener:b,addSliceIdsListener:(e,t)=>s(t,n,[e]),addSliceRowIdsListener:(e,t,n)=>s(n,l,[e,t]),delListener:e=>(o(e),w),destroy:I,getListenerStats:()=>({sliceIds:Le(n),sliceRowIds:Ce(l)})};return de(w)})),ct=xe([["avg",[(e,t)=>Y(e)/t,(e,t,n)=>e+(t-e)/(n+1),(e,t,n)=>e+(e-t)/(n-1),(e,t,n,l)=>e+(t-n)/l]],["max",[e=>k(...e),(e,t)=>k(t,e),(e,t)=>t==e?void 0:e,(e,t,n)=>n==e?void 0:k(t,e)]],["min",[e=>D(...e),(e,t)=>D(t,e),(e,t)=>t==e?void 0:e,(e,t,n)=>n==e?void 0:D(t,e)]],["sum",[e=>Y(e),(e,t)=>e+t,(e,t)=>e-t,(e,t,n)=>e-n+t]]]),ut=(e,t,n,l,s,r=!1)=>{if(Se(n))return;const[o,a,i,d]=s;return r||(r=O(e)),Ve(l,(([n,l])=>{r||(e=O(n)?null==a?void 0:a(e,l,t++):O(l)?null==i?void 0:i(e,n,t--):null==d?void 0:d(e,l,n,t),r||(r=O(e)))})),r?o(ye(n),we(n)):e},gt=Ye((e=>{const n=xe(),[l,s,r]=et((()=>I)),[o,a,i,d,c,u,g,,v,h,f,b]=Ke(e,A,(e=>isNaN(e)||O(e)||!0===e||!1===e||e===t?void 0:1*e),l,s),I={setMetricDefinition:(e,t,l,r,o,a,i)=>{var d;const c=P(l)?[l,o,a,i]:null!=(d=ke(ct,l))?d:ke(ct,"sum");return v(e,t,((t,l,r,o,a,i)=>{const d=u(e),v=we(o);i||(i=O(d)),t();let h=ut(d,v,o,l,c,i);J(h)||(h=void 0),h!=d&&(g(e,h),s(n,[e],h,d))}),Xe(r,1)),I},delMetricDefinition:e=>(h(e),I),getStore:o,getMetricIds:a,forEachMetric:i,hasMetric:d,getTableId:c,getMetric:u,addMetricIdsListener:f,addMetricListener:(e,t)=>l(t,n,[e]),delListener:e=>(r(e),I),destroy:b,getListenerStats:()=>({metric:Le(n)})};return de(I)}));var vt=Object.getOwnPropertySymbols,ht=Object.prototype.hasOwnProperty,ft=Object.prototype.propertyIsEnumerable;const bt=Ye((e=>{const n=e.createStore,l=n(),s=n(),r=xe(),{addListener:o,callListeners:a,delListener:u}=s,[g,h,f,R,T,,,S,,y,M,V,m,x]=Ke(e,(()=>!0),A,o,a),E=(e,t,...n)=>K(n,(n=>Ge(Je(Je(r,t,xe),e,Be),n))),k=e=>{F(ke(r,e),(e=>{De(e,((e,t)=>Ve(t,(t=>e.delListener(t))))),Me(e)})),K([s,l],(t=>t.delTable(e)))},D=(e,t,n)=>E(t,e,t.addStartTransactionListener(n.startTransaction),t.addDidFinishTransactionListener((()=>n.finishTransaction()))),H={setQueryDefinition:(n,r,o)=>{S(n,r),k(n);const a=[],i=[[null,[r,null,null,[],xe()]]],d=[],c=[],u=[];o({select:(e,n)=>{const l=P(e)?[W(a)+t,e]:[O(n)?e:n,t=>t(e,n)];return ee(a,l),{as:e=>l[0]=e}},join:(e,t,n)=>{const l=O(n)||P(t)?null:t,s=O(l)?t:n,r=[e,[e,l,P(s)?s:e=>e(s),[],xe()]];return ee(i,r),{as:e=>r[0]=e}},where:(e,t,n)=>ee(d,P(e)?e:O(n)?n=>n(e)===t:l=>l(e,t)===n),group:(e,t,n,l,s)=>{var r;const o=[e,[e,P(t)?[t,n,l,s]:null!=(r=ke(ct,t))?r:[(e,t)=>t]]];return ee(c,o),{as:e=>o[0]=e}},having:(e,t)=>ee(u,P(e)?e:n=>n(e)===t)});const g=xe(a);if(Se(g))return H;const v=xe(i);De(v,((e,[,t])=>F(ke(v,t),(({3:t})=>O(e)?0:ee(t,e)))));const h=xe(c);let f=l;if(Se(h)&&Z(u))f=s;else{D(n,f,s);const e=xe();De(h,((t,[n,l])=>Ge(Je(e,n,Be),[t,l])));const t=Be();De(g,(n=>Te(e,n)?0:Ge(t,n)));const l=xe(),r=(t,l,r,o)=>F(t,(([a,i,d,c])=>{De(l,((t,[n])=>{const l=Je(a,t,xe),s=ke(l,r),i=o?void 0:n;if(s!==i){const n=Be([[s,i]]),o=we(l);He(l,r,i),Ve(ke(e,t),(([e,t])=>{const s=ut(c[e],o,l,n,t);c[e]=O(Ae(s))?null:s}))}})),Se(i)||!U(u,(e=>e((e=>c[e]))))?s.delRow(n,d):O(d)?t[2]=s.addRow(n,c):s.setRow(n,d,c)}));E(f,n,f.addRowListener(n,null,((s,o,a,i)=>{const d=[],c=[],u=xe(),g=f.hasRow(n,a);let v=!g;Ve(t,(e=>{const[t,l,s]=i(n,a,e);ee(d,l),ee(c,s),v||(v=t)})),De(e,(e=>{const[t,,l]=i(n,a,e);(v||t)&&He(u,e,[l])})),v&&r(We(l,d,void 0,(([,e])=>(me(e,a),Se(e)))),u,a,1),g&&r(We(l,c,(()=>{const e={};return Ve(t,(t=>e[t]=f.getCell(n,a,t))),[xe(),Be(),void 0,e]}),(([,e])=>{Ge(e,a)})),u,a)})))}D(n,e,f);const b=(t,l,s,o)=>{const a=t=>e.getCell(l,s,t);K(o,(l=>{var s;const[r,,o,i,d]=ke(v,l),c=null==o?void 0:o(a,t),[u,g]=null!=(s=ke(d,t))?s:[];c!=u&&(O(g)||x(n,g),He(d,t,O(c)?null:[c,...m(n,1,e.addRowListener(r,c,(()=>b(t,r,c,i))))]))})),(t=>{const l=(n,l)=>{var s,o,a;return e.getCell(...O(l)?[r,t,n]:n===r?[r,t,l]:[null==(s=ke(v,n))?void 0:s[0],null==(a=ke(null==(o=ke(v,n))?void 0:o[4],t))?void 0:a[0],l])};f.transaction((()=>U(d,(e=>e(l)))?De(g,((e,s)=>Ue(f,n,t,e,s(l,t)))):f.delRow(n,t)))})(t)},{3:I}=ke(v,null);return f.transaction((()=>m(n,1,e.addRowListener(r,null,((t,l,s)=>{e.hasRow(r,s)?b(s,r,s,I):(f.delRow(n,s),Ve(v,(({4:e})=>F(ke(e,s),(([,t])=>{x(n,t),He(e,s)})))))}))))),H},delQueryDefinition:e=>(k(e),y(e),H),getStore:g,getQueryIds:h,forEachQuery:f,hasQuery:R,getTableId:T,addQueryIdsListener:e=>M((()=>e(H))),delListener:e=>(u(e),H),destroy:V,getListenerStats:()=>((e,t)=>{var n={};for(var l in e)ht.call(e,l)&&t.indexOf(l)<0&&(n[l]=e[l]);if(null!=e&&vt)for(var l of vt(e))t.indexOf(l)<0&&ft.call(e,l)&&(n[l]=e[l]);return n})(s.getListenerStats(),["tables","tableIds","transaction"])};return he({[v]:[1,1],[v+C]:[0,1],[I]:[0,1],[p]:[0,1],[w]:[0,5],[b]:[1,2],[C]:[0,2],[L]:[1,3]},(([e,t],n)=>{K(e?["get","has","forEach"]:["get"],(e=>H[e+d+n]=(...t)=>s[e+n](...t))),H[c+d+n+i]=(...e)=>s[c+n+i](...N(e,0,t),((n,...l)=>e[t](H,...l)),!0)})),de(H)})),It=Ye((e=>{const n=xe(),l=xe(),s=xe(),r=xe(),[o,a,i]=et((()=>R)),[d,c,u,g,v,h,,,f,b,I,p]=Ke(e,(()=>[xe(),xe(),xe(),xe()]),(e=>O(e)?void 0:e+t),o,a),w=(e,t,n)=>F(h(e),(([l,,s])=>{if(!Te(s,t)){const r=Be();if(v(e)!=C(e))Ge(r,t);else{let e=t;for(;!O(e)&&!Te(r,e);)Ge(r,e),e=ke(l,e)}if(n)return r;He(s,t,r)}return ke(s,t)})),L=(e,t)=>F(h(e),(([,,e])=>He(e,t))),C=e=>ke(n,e),R={setRelationshipDefinition:(e,t,o,i)=>(He(n,e,o),f(e,t,((t,n)=>{const o=Be(),i=Be(),d=Be(),[c,u]=h(e);Ve(n,(([t,n],l)=>{O(t)||(Ge(i,t),F(ke(u,t),(e=>{me(e,l),Se(e)&&He(u,t)}))),O(n)||(Ge(i,n),Te(u,n)||He(u,n,Be()),Ge(ke(u,n),l)),Ge(o,l),He(c,l,n),De(ke(r,e),(t=>{Te(w(e,t),l)&&Ge(d,t)}))})),t(),Ve(o,(t=>a(l,[e,t]))),Ve(i,(t=>a(s,[e,t]))),Ve(d,(t=>{L(e,t),a(r,[e,t])}))}),Xe(i)),R),delRelationshipDefinition:e=>(He(n,e),b(e),R),getStore:d,getRelationshipIds:c,forEachRelationship:t=>u((n=>t(n,(t=>e.forEachRow(v(n),t))))),hasRelationship:g,getLocalTableId:v,getRemoteTableId:C,getRemoteRowId:(e,t)=>{var n;return ke(null==(n=h(e))?void 0:n[0],t)},getLocalRowIds:(e,t)=>{var n;return ye(ke(null==(n=h(e))?void 0:n[1],t))},getLinkedRowIds:(e,t)=>O(h(e))?[t]:ye(w(e,t,!0)),addRelationshipIdsListener:I,addRemoteRowIdListener:(e,t,n)=>o(n,l,[e,t]),addLocalRowIdsListener:(e,t,n)=>o(n,s,[e,t]),addLinkedRowIdsListener:(e,t,n)=>(w(e,t),o(n,r,[e,t])),delListener:e=>{var t;return L(...null!=(t=i(e))?t:[]),R},destroy:p,getListenerStats:()=>({remoteRowId:Ce(l),localRowIds:Ce(s),linkedRowIds:Ce(r)})};return de(R)})),pt=new x.TextEncoder,wt=e=>{let t=2166136261;return K(pt.encode(e),(e=>{t^=e,t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24)})),t>>>0},Lt=([e,t])=>Rt(e,t),Ct=([e,t,n])=>[e,t,n],Rt=(e,t)=>t?[e,t]:[e],Tt=(e,t,n)=>[e,t,n],St=e=>e[2],yt=(e,t)=>wt(e+":"+t),Mt=(e,t)=>t>e?(e?wt(e):0)^wt(t):0,Vt=(e,t)=>{var n;return null!=(n=(null!=e?e:"")>(null!=t?t:"")?e:t)?n:""},mt=(e,t,n)=>{t>e[1]&&(e[1]=t),e[2]=n>>>0},xt=(e=t)=>Rt(ce(),e),Et=(e=t)=>[xe(),e,0],kt=([e,t,n],l=Ct)=>[Fe(e,l),t,n],Dt=([e,t],n=Lt)=>Rt(Fe(e,n),t),Ht=(t,n)=>z(t)&&3==W(t)&&j(t[1])&&e(t[2])==s&&J(t[2])&&n(t[0]),Jt=e=>[e,e],Ot=(e,t=Le)=>t(e[0])+t(e[1]),Ft=()=>[xe(),xe()],Qt=e=>[...e],jt=([e,t])=>e===t,Pt=JSON.stringify,zt=JSON.parse,Nt=e=>Pt(e,((e,t)=>t instanceof Map?le.fromEntries([...t]):t)),Wt=(e,t,n)=>He(e,t,ke(e,t)==-n?void 0:n),At=()=>{let e,t,n=!1,l=!1,r=0,d=[];const g=xe(),w=xe(),M=xe(),V=xe(),m=xe(),x=xe(),E=xe(),k=xe(),D=xe(),H=xe(),J=xe(),j=xe(),W=xe(),A=xe(),U=Be(),B=xe(),Y=xe(),Z=xe(),$=xe(),te=Ft(),ne=Ft(),le=Ft(),se=Ft(),re=Ft(),oe=Ft(),ae=Ft(),ie=Ft(),ce=Ft(),ve=Ft(),be=Ft(),pe=Ft(),ye=Ft(),We=Ft(),_e=Ft(),Ke=Ft(),Xe=Ft(),Ye=Ft(),Ze=Ft(),tt=Ft(),nt=Ft(),lt=Ft(),st=xe(),rt=Ft(),[ot,it,dt,ct]=et((()=>zn)),ut=e=>{if(!Ie(e,((e,t)=>_([o,a],t))))return!1;const t=e[o];return!(!Q(t)&&t!=s||(Ae(e[a])!=t&&ge(e,a),0))},gt=z,vt=(t,n)=>(!e||Te(J,n)||Yt(n))&&Ie(t,((e,t)=>ht(n,t,e)),(()=>Yt(n))),ht=(e,t,n,l)=>Ie(l?n:pt(n,e,t),((l,s)=>F(ft(e,t,s,l),(e=>(n[s]=e,!0)),(()=>!1))),(()=>Yt(e,t))),ft=(t,n,l,s)=>e?F(ke(ke(J,t),l),(e=>Ae(s)!=e[o]?Yt(t,n,l,s,e[a]):s),(()=>Yt(t,n,l,s))):O(Ae(s))?Yt(t,n,l,s):s,bt=(e,t)=>Ie(t?e:wt(e),((t,n)=>F(It(n,t),(t=>(e[n]=t,!0)),(()=>!1))),(()=>Zt())),It=(e,n)=>t?F(ke(W,e),(t=>Ae(n)!=t[o]?Zt(e,n,t[a]):n),(()=>Zt(e,n))):O(Ae(n))?Zt(e,n):n,pt=(e,t,n)=>(F(ke(j,t),(([l,s])=>{Ve(l,((t,n)=>{ue(e,n)||(e[n]=t)})),Ve(s,(l=>{ue(e,l)||Yt(t,n,l)}))})),e),wt=e=>(t&&(Ve(A,((t,n)=>{ue(e,n)||(e[n]=t)})),Ve(U,(t=>{ue(e,t)||Zt(t)}))),e),Lt=e=>Oe(J,e,((e,t,n)=>{const l=xe(),s=Be();Oe(Je(J,t,xe),n,((e,t,n)=>{He(e,t,n),F(n[a],(e=>He(l,t,e)),(()=>Ge(s,t)))})),He(j,t,[l,s])}),((e,t)=>{He(J,t),He(j,t)})),Ct=e=>Oe(W,e,((e,t,n)=>{He(W,t,n),F(n[a],(e=>He(A,t,e)),(()=>Ge(U,t)))}),((e,t)=>{He(W,t),He(A,t),me(U,t)})),Rt=e=>fe(e)?kn():Mn(e),Tt=e=>Oe(Z,e,((e,t,n)=>St(t,n)),((e,t)=>Dt(t))),St=(e,t)=>Oe(Je(Z,e,(()=>(Ut(e,1),He(B,e,$e()),He(Y,e,xe()),xe()))),t,((t,n,l)=>yt(e,t,n,l)),((t,n)=>Ht(e,t,n))),yt=(e,t,n,l,s)=>Oe(Je(t,n,(()=>(qt(e,n,1),xe()))),l,((t,l,s)=>Mt(e,n,t,l,s)),((l,r)=>Pt(e,t,n,l,r,s))),Mt=(e,t,n,l,s)=>{Te(n,l)||Bt(e,t,l,1);const r=ke(n,l);s!==r&&(Gt(e,t,l,r,s),He(n,l,s))},Vt=(e,t,n,l,s)=>F(ke(t,n),(t=>Mt(e,n,t,l,s)),(()=>yt(e,t,n,pt({[l]:s},e,n)))),mt=e=>fe(e)?Jn():Vn(e),xt=e=>Oe($,e,((e,t,n)=>Et(t,n)),((e,t)=>_t(t))),Et=(e,t)=>{Te($,e)||Kt(e,1);const n=ke($,e);t!==n&&(Xt(e,n,t),He($,e,t))},kt=e=>{var t;return null!=(t=ke(Z,e))?t:St(e,{})},Dt=e=>St(e,{}),Ht=(e,t,n)=>{const[,l]=ke(B,e);l(n),yt(e,t,n,{},!0)},Pt=(e,t,n,l,s,r)=>{var o;const a=ke(null==(o=ke(j,e))?void 0:o[0],s);if(!O(a)&&!r)return Mt(e,n,l,s,a);const i=t=>{Gt(e,n,t,ke(l,t)),Bt(e,n,t,-1),He(l,t)};O(a)?i(s):De(l,i),Se(l)&&(qt(e,n,-1),Se(He(t,n))&&(Ut(e,-1),He(Z,e),He(B,e),He(Y,e)))},_t=e=>{const t=ke(A,e);if(!O(t))return Et(e,t);Xt(e,ke($,e)),Kt(e,-1),He($,e)},Ut=(e,t)=>Wt(g,e,t),qt=(e,t,n)=>Wt(Je(V,e,xe),t,n)&&He(M,e,Je(M,e,(()=>0))+n),Bt=(e,t,n,l)=>{var s;const r=ke(Y,e),o=null!=(s=ke(r,n))?s:0;(0==o&&1==l||1==o&&-1==l)&&Wt(Je(w,e,xe),n,l),He(r,n,o!=-l?o+l:null),Wt(Je(Je(m,e,xe),t,xe),n,l)},Gt=(e,t,n,l,s)=>{var r;Je(Je(Je(x,e,xe),t,xe),n,(()=>[l,0]))[1]=s,null==(r=d[3])||r.call(d,e,t,n,s)},Kt=(e,t)=>Wt(E,e,t),Xt=(e,t,n)=>{var l;Je(k,e,(()=>[t,0]))[1]=n,null==(l=d[4])||l.call(d,e,n)},Yt=(e,t,n,l,s)=>(ee(Je(Je(Je(D,e,xe),t,xe),n,(()=>[])),l),s),Zt=(e,t,n)=>(ee(Je(H,e,(()=>[])),t),n),$t=(e,t,n)=>F(ke(ke(ke(x,e),t),n),(([e,t])=>[!0,e,t]),(()=>[!1,...Jt(fn(e,t,n))])),en=e=>F(ke(k,e),(([e,t])=>[!0,e,t]),(()=>[!1,...Jt(pn(e))])),tn=e=>Se(D)||Se(Ke[e])?0:Ve(e?Ne(D):D,((t,n)=>Ve(t,((t,l)=>Ve(t,((t,s)=>it(Ke[e],[n,l,s],t))))))),nn=e=>Se(H)||Se(Xe[e])?0:Ve(e?Pe(H):H,((t,n)=>it(Xe[e],[n],t))),ln=(e,t,n,l)=>{if(!Se(e))return it(t,l,(()=>Fe(e))),De(e,((e,t)=>it(n,[...null!=l?l:[],e],1==t))),1},sn=e=>{const t=wn();t!=n&&it(te[e],void 0,t);const l=Se(ve[e]),s=Se(ye[e])&&Se(We[e])&&Se(ce[e])&&Se(be[e])&&Se(oe[e])&&Se(ae[e])&&Se(ie[e])&&l&&Se(le[e])&&Se(se[e]),r=Se(_e[e])&&Se(pe[e])&&Se(re[e])&&Se(ne[e]);if(!s||!r){const t=e?[Pe(g),ze(w),Pe(M),ze(V),Ne(m),Ne(x)]:[g,w,M,V,m,x];if(!s){ln(t[0],le[e],se[e]),Ve(t[1],((t,n)=>ln(t,oe[e],ae[e],[n]))),Ve(t[2],((t,n)=>{0!=t&&it(ie[e],[n],un(n))}));const n=Be();Ve(t[3],((t,s)=>{ln(t,ce[e],be[e],[s])&&!l&&(it(ve[e],[s,null]),Ge(n,s))})),l||Ve(t[5],((t,l)=>{if(!Te(n,l)){const n=Be();Ve(t,(e=>Ve(e,(([t,l],s)=>l!==t?Ge(n,s):me(e,s))))),Ve(n,(t=>it(ve[e],[l,t])))}})),Ve(t[4],((t,n)=>Ve(t,((t,l)=>ln(t,ye[e],We[e],[n,l])))))}if(!r){let n;Ve(t[5],((t,l)=>{let s;Ve(t,((t,r)=>{let o;Ve(t,(([t,a],i)=>{a!==t&&(it(_e[e],[l,r,i],a,t,$t),n=s=o=1)})),o&&it(pe[e],[l,r],$t)})),s&&it(re[e],[l],$t)})),n&&it(ne[e],void 0,$t)}}},rn=e=>{const t=Sn();t!=l&&it(Ye[e],void 0,t);const n=Se(tt[e])&&Se(nt[e]),s=Se(lt[e])&&Se(Ze[e]);if(!n||!s){const t=e?[Pe(E),Pe(k)]:[E,k];if(n||ln(t[0],tt[e],nt[e]),!s){let n;Ve(t[1],(([t,l],s)=>{l!==t&&(it(lt[e],[s],l,t,en),n=1)})),n&&it(Ze[e],void 0,en)}}},on=(e,...t)=>(Qn((()=>e(...X(t,y)))),zn),an=()=>je(Z),dn=()=>Ee(Z),cn=e=>Ee(ke(Y,y(e))),un=e=>we(ke(Z,y(e))),gn=e=>Ee(ke(Z,y(e))),vn=(e,t,n,l=0,s)=>{return X(N(G((r=ke(Z,y(e)),o=(e,n)=>[O(t)?n:ke(e,y(t)),n],X([...null!=(a=null==r?void 0:r.entries())?a:[]],(([e,t])=>o(t,e)))),(([e],[t])=>at(e,t)*(n?-1:1))),l,O(s)?s:l+s),(([,e])=>e));var r,o,a},hn=(e,t)=>Ee(ke(ke(Z,y(e)),y(t))),fn=(e,t,n)=>ke(ke(ke(Z,y(e)),y(t)),y(n)),bn=()=>Fe($),In=()=>Ee($),pn=e=>ke($,y(e)),wn=()=>!Se(Z),Ln=e=>Te(Z,y(e)),Cn=(e,t)=>Te(ke(Y,y(e)),y(t)),Rn=(e,t)=>Te(ke(Z,y(e)),y(t)),Tn=(e,t,n)=>Te(ke(ke(Z,y(e)),y(t)),y(n)),Sn=()=>!Se($),yn=e=>Te($,y(e)),Mn=e=>on((()=>(e=>Ie(e,vt,Yt))(e)?Tt(e):0)),Vn=e=>on((()=>bt(e)?xt(e):0)),mn=e=>{try{Rt(zt(e))}catch(e){}return zn},xn=t=>on((()=>{if((e=Ie(t,(e=>Ie(e,ut))))&&(Lt(t),!Se(Z))){const e=an();kn(),Mn(e)}})),En=e=>on((()=>{if(t=(e=>Ie(e,ut))(e)){const n=bn();Fn(),Jn(),t=!0,Ct(e),Vn(n)}})),kn=()=>on((()=>Tt({}))),Dn=e=>on((e=>Te(Z,e)?Dt(e):0),e),Hn=(e,t)=>on(((e,t)=>F(ke(Z,e),(n=>Te(n,t)?Ht(e,n,t):0))),e,t),Jn=()=>on((()=>xt({}))),On=()=>on((()=>{Lt({}),e=!1})),Fn=()=>on((()=>{Ct({}),t=!1})),Qn=(e,t)=>{if(-1!=r){jn();const n=e();return Pn(t),n}},jn=()=>{var e;return-1!=r&&r++,1==r&&(null==(e=d[0])||e.call(d),it(st)),zn},Pn=e=>{var t,s;return r>0&&(r--,0==r&&(r=1,tn(1),Se(x)||sn(1),nn(1),Se(k)||rn(1),(null==e?void 0:e(zn))&&(Ve(x,((e,t)=>Ve(e,((e,n)=>Ve(e,(([e],l)=>Ue(zn,t,n,l,e))))))),Me(x),Ve(k,(([e],t)=>qe(zn,t,e))),Me(k)),it(rt[0],void 0),r=-1,tn(0),Se(x)||sn(0),nn(0),Se(k)||rn(0),null==(t=d[1])||t.call(d),it(rt[1],void 0),null==(s=d[2])||s.call(d),r=0,n=wn(),l=Sn(),K([g,w,M,V,m,x,D,E,k,H],Me))),zn},zn={getContent:()=>[an(),bn()],getTables:an,getTableIds:dn,getTable:e=>Qe(ke(Z,y(e))),getTableCellIds:cn,getRowCount:un,getRowIds:gn,getSortedRowIds:vn,getRow:(e,t)=>Fe(ke(ke(Z,y(e)),y(t))),getCellIds:hn,getCell:fn,getValues:bn,getValueIds:In,getValue:pn,hasTables:wn,hasTable:Ln,hasTableCell:Cn,hasRow:Rn,hasCell:Tn,hasValues:Sn,hasValue:yn,getTablesJson:()=>Nt(Z),getValuesJson:()=>Nt($),getJson:()=>Nt([Z,$]),getTablesSchemaJson:()=>Nt(J),getValuesSchemaJson:()=>Nt(W),getSchemaJson:()=>Nt([J,W]),hasTablesSchema:()=>e,hasValuesSchema:()=>t,setContent:e=>on((()=>{const t=P(e)?e():e;gt(t)&&(([e,t])=>{(fe(e)?kn:Mn)(e),(fe(t)?Jn:Vn)(t)})(t)})),setTables:Mn,setTable:(e,t)=>on((e=>vt(t,e)?St(e,t):0),e),setRow:(e,t,n)=>on(((e,t)=>ht(e,t,n)?yt(e,kt(e),t,n):0),e,t),addRow:(e,t,n=!0)=>Qn((()=>{let l;return ht(e,l,t)&&(e=y(e),yt(e,kt(e),l=((e,t)=>{const[n]=ke(B,e);let l;do{l=n(t)}while(Te(ke(Z,e),l));return l})(e,n?1:0),t)),l})),setPartialRow:(e,t,n)=>on(((e,t)=>{if(ht(e,t,n,1)){const l=kt(e);he(n,((n,s)=>Vt(e,l,t,s,n)))}}),e,t),setCell:(e,t,n,l)=>on(((e,t,n)=>F(ft(e,t,n,P(l)?l(fn(e,t,n)):l),(l=>Vt(e,kt(e),t,n,l)))),e,t,n),setValues:Vn,setPartialValues:e=>on((()=>bt(e,1)?he(e,((e,t)=>Et(t,e))):0)),setValue:(e,t)=>on((e=>F(It(e,P(t)?t(pn(e)):t),(t=>Et(e,t)))),e),applyChanges:e=>on((()=>{he(e[0],((e,t)=>O(e)?Dn(t):he(e,((e,n)=>O(e)?Hn(t,n):he(e,((e,l)=>Ue(zn,t,n,l,e))))))),he(e[1],((e,t)=>qe(zn,t,e)))})),setTablesJson:mn,setValuesJson:e=>{try{mt(zt(e))}catch(e){}return zn},setJson:e=>on((()=>{try{const[t,n]=zt(e);Rt(t),mt(n)}catch(t){mn(e)}})),setTablesSchema:xn,setValuesSchema:En,setSchema:(e,t)=>on((()=>{xn(e),En(t)})),delTables:kn,delTable:Dn,delRow:Hn,delCell:(e,t,n,l)=>on(((e,t,n)=>F(ke(Z,e),(s=>F(ke(s,t),(r=>Te(r,n)?Pt(e,s,t,r,n,l):0))))),e,t,n),delValues:Jn,delValue:e=>on((e=>Te($,e)?_t(e):0),e),delTablesSchema:On,delValuesSchema:Fn,delSchema:()=>on((()=>{On(),Fn()})),transaction:Qn,startTransaction:jn,getTransactionChanges:()=>[Fe(x,((e,t)=>-1===ke(g,t)?void 0:Fe(e,((e,n)=>-1===ke(ke(V,t),n)?void 0:Fe(e,(([,e])=>e),(e=>jt(e)))),Se,fe)),Se,fe),Fe(k,(([,e])=>e),(e=>jt(e))),1],getTransactionLog:()=>[!Se(x),!Se(k),je(x,Qt,jt),je(D),Fe(k,Qt,jt),Fe(H),Fe(g),Qe(V),je(m),Fe(E)],finishTransaction:Pn,forEachTable:e=>Ve(Z,((t,n)=>e(n,(e=>Ve(t,((t,n)=>e(n,(e=>De(t,e))))))))),forEachTableCell:(e,t)=>De(ke(Y,y(e)),t),forEachRow:(e,t)=>Ve(ke(Z,y(e)),((e,n)=>t(n,(t=>De(e,t))))),forEachCell:(e,t,n)=>De(ke(ke(Z,y(e)),y(t)),n),forEachValue:e=>De($,e),addSortedRowIdsListener:(e,t,n,l,s,r,o)=>{let a=vn(e,t,n,l,s);return ot((()=>{const o=vn(e,t,n,l,s);q(o,a)||(a=o,r(zn,e,t,n,l,s,a))}),ve[o?1:0],[e,t],[dn])},addStartTransactionListener:e=>ot(e,st),addWillFinishTransactionListener:e=>ot(e,rt[0]),addDidFinishTransactionListener:e=>ot(e,rt[1]),callListener:e=>(ct(e),zn),delListener:e=>(dt(e),zn),getListenerStats:()=>({hasTables:Ot(te),tables:Ot(ne),tableIds:Ot(le),hasTable:Ot(se),table:Ot(re),tableCellIds:Ot(oe),hasTableCell:Ot(ae,Ce),rowCount:Ot(ie),rowIds:Ot(ce),sortedRowIds:Ot(ve),hasRow:Ot(be,Ce),row:Ot(pe,Ce),cellIds:Ot(ye,Ce),hasCell:Ot(We,Re),cell:Ot(_e,Re),invalidCell:Ot(Ke,Re),hasValues:Ot(Ye),values:Ot(Ze),valueIds:Ot(tt),hasValue:Ot(nt),value:Ot(lt),invalidValue:Ot(Xe),transaction:Le(st)+Ot(rt)}),isMergeable:()=>!1,createStore:At,addListener:ot,callListeners:it,setInternalListeners:(e,t,n,l,s)=>d=[e,t,n,l,s]};return he({[u+h]:[0,te,[],()=>[wn()]],[h]:[0,ne],[f]:[0,le],[u+v]:[1,se,[dn],e=>[Ln(...e)]],[v]:[1,re,[dn]],[v+C]:[1,oe,[dn]],[u+v+L]:[2,ae,[dn,cn],e=>[Cn(...e)]],[I]:[1,ie,[dn]],[p]:[1,ce,[dn]],[u+b]:[2,be,[dn,gn],e=>[Rn(...e)]],[b]:[2,pe,[dn,gn]],[C]:[2,ye,[dn,gn]],[u+L]:[3,We,[dn,gn,hn],e=>[Tn(...e)]],[L]:[3,_e,[dn,gn,hn],e=>Jt(fn(...e))],InvalidCell:[3,Ke],[u+T]:[0,Ye,[],()=>[Sn()]],[T]:[0,Ze],[S]:[0,tt],[u+R]:[1,nt,[In],e=>[yn(...e)]],[R]:[1,lt,[In],e=>Jt(pn(e[0]))],InvalidValue:[1,Xe]},(([e,t,n,l],s)=>{zn[c+s+i]=(...s)=>ot(s[e],t[s[e+1]?1:0],e>0?N(s,0,e):void 0,n,l)})),de(zn)};var _t=Math.pow;const Ut=_t(2,36),qt=_t(2,30),Bt=_t(2,24),Gt=_t(2,18),Kt=_t(2,12),Xt=_t(2,6),Yt={HasTable:1,Table:1,TableCellIds:1,HasTableCell:2,RowCount:1,RowIds:1,SortedRowIds:5,HasRow:2,Row:2,CellIds:2,HasCell:3,Cell:3,HasValue:1,Value:1,InvalidCell:3,InvalidValue:1},Zt=(e=t)=>[Et(e),Et(e)];exports.createCheckpoints=tt,exports.createIndexes=dt,exports.createMergeableStore=e=>{let n=1,l=Zt(),s=0;const r=xe(),o=Be(),[a,d]=(e=>{let t=0,n=-1;const l=F(e,(e=>{const t=wt(e);return st(t/Bt)+st(t/Gt)+st(t/Kt)+st(t/Xt)+st(t)}),(()=>it(5))),s=e=>{var l;const s=t,[r,o]=O(e)||""==e?[0,0]:[rt(a=e,0)*Ut+rt(a,1)*qt+rt(a,2)*Bt+rt(a,3)*Gt+rt(a,4)*Kt+rt(a,5)*Xt+rt(a,6),rt(a,7)*Gt+rt(a,8)*Kt+rt(a,9)*Xt+rt(a,10)];var a;t=k(s,r,null!=(l=x.HLC_TIME)?l:Date.now()),n=t==s?t==r?k(n,o):n:t==r?o:-1};return[()=>{return s(),r=++n,st((e=t)/Ut)+st(e/qt)+st(e/Bt)+st(e/Gt)+st(e/Kt)+st(e/Xt)+st(e)+st(r/Gt)+st(r/Kt)+st(r/Xt)+st(r)+l;var e,r},s]})(e),u=At(),g=e=>{const t=n;return n=0,e(),n=t,I},v=(e,n=0)=>{const s={},r={},[[o,a=t,i=0],c]=e,[u,g]=l,[v,f,b]=u;let I=n?i:b,p=a;ve(o,(([e,l=t,r=0],o)=>{const a=Je(v,o,Et),[i,d,c]=a;let u=n?r:c,g=l;ve(e,((e,t)=>{const[l,r,a]=h(e,Je(i,t,Et),be(be(s,o,ce),t,ce),n);u^=n?0:(r?yt(t,r):0)^yt(t,a),g=Vt(g,l)})),u^=n?0:Mt(d,l),mt(a,l,u),I^=n?0:(c?yt(o,c):0)^yt(o,a[2]),p=Vt(p,g)})),I^=n?0:Mt(f,a),mt(u,a,I);const[w]=h(c,g,r,n);return d(Vt(p,w)),[s,r,1]},h=(e,n,l,s)=>{const[r,o=t,a=0]=e,[i,d,c]=n;let u=o,g=s?a:c;return ve(r,(([e,n,r=0],o)=>{const a=Je(i,o,(()=>[void 0,t,0])),[,d,c]=a;(!d||n>d)&&(mt(a,n,s?r:wt(Nt(null!=e?e:null)+":"+n)),a[0]=e,l[o]=e,g^=s?0:yt(o,c)^yt(o,a[2]),u=Vt(u,n))})),g^=s?0:Mt(d,o),mt(n,o,g),[u,c,n[2]]},f=()=>[kt(l[0],(e=>kt(e,(e=>kt(e))))),kt(l[1])],b=e=>g((()=>u.applyChanges(v(e)))),I={getMergeableContent:f,getMergeableContentHashes:()=>[l[0][2],l[1][2]],getMergeableTableHashes:()=>Fe(l[0][0],St),getMergeableTableDiff:e=>{const t=xt(l[0][1]),n={};return De(l[0][0],((l,[s,r,o])=>ue(e,l)?o!=e[l]?n[l]=o:0:t[0][l]=Dt([s,r],(e=>Dt(e))))),[t,n]},getMergeableRowHashes:e=>{const t={};return ve(e,((e,n)=>F(ke(l[0][0],n),(([l,,s])=>s!=e?De(l,((e,[,,l])=>be(t,n,ce)[e]=l)):0)))),t},getMergeableRowDiff:e=>{const t=xt(l[0][1]),n={};return ve(e,((e,s)=>{var r;return De(null==(r=ke(l[0][0],s))?void 0:r[0],((l,[r,o,a])=>ue(e,l)?a!==e[l]?be(n,s,ce)[l]=a:0:be(t[0],s,xt)[0][l]=Dt([r,o])))})),[t,n]},getMergeableCellHashes:e=>{const t={};return ve(e,((e,n)=>F(ke(l[0][0],n),(([l])=>ve(e,((e,s)=>F(ke(l,s),(([l,,r])=>r!==e?De(l,((e,[,,l])=>be(be(t,n,ce),s,ce)[e]=l)):0)))))))),t},getMergeableCellDiff:e=>{const[[t,n]]=l,s={};return ve(e,((e,n)=>ve(e,((e,l)=>F(ke(t,n),(([t,r])=>F(ke(t,l),(([t,o])=>De(t,((t,[a,i,d])=>d!==e[t]?be(be(s,n,(()=>xt(r)))[0],l,(()=>xt(o)))[0][t]=[a,i]:0)))))))))),Rt(s,n)},getMergeableValueHashes:()=>Fe(l[1][0],St),getMergeableValueDiff:e=>{const[,[t,n]]=l,s=Fe(t,Lt,(([,,t],n)=>t==(null==e?void 0:e[n])));return Rt(s,n)},setMergeableContent:e=>g((()=>(e=>z(e)&&2==W(e)&&Ht(e[0],(e=>Ie(e,(e=>Ht(e,(e=>Ie(e,(e=>Ht(e,(e=>Ie(e,(e=>Ht(e,_e)),void 0,1)))),void 0,1)))),void 0,1)))&&Ht(e[1],(e=>Ie(e,(e=>Ht(e,_e)),void 0,1))))(e)?u.transaction((()=>{u.delTables().delValues(),l=Zt(),u.applyChanges(v(e,1))})):0)),setDefaultContent:e=>(u.transaction((()=>{s=1,u.setContent(e),s=0})),I),getTransactionMergeableChanges:(e=!1)=>{const[[t,n,s],[a,i,d]]=l,c=e?Tt:Rt,u={};Ve(r,((e,n)=>F(ke(t,n),(([t,l,s])=>{const r={};Ve(e,((e,n)=>F(ke(t,n),(([t,l,s])=>{const o={};Ve(e,(e=>{F(ke(t,e),(([t,n,l])=>o[e]=c(t,n,l)))})),r[n]=c(o,l,s)})))),u[n]=c(r,l,s)}))));const g={};return Ve(o,(e=>F(ke(a,e),(([t,n,l])=>g[e]=c(t,n,l))))),[c(u,n,s),c(g,i,d),1]},applyMergeableChanges:b,merge:e=>{const t=f(),n=e.getMergeableContent();return e.applyMergeableChanges(t),b(n)}};return u.setInternalListeners((()=>{}),(()=>{}),(()=>{Me(r),Me(o)}),((e,l,o,i)=>{Ge(Je(Je(r,e,xe),l,Be),o),n&&v([[{[e]:[{[l]:[{[o]:[i,s?t:a()]}]}]}],[{}],1])}),((e,l)=>{Ge(o,e),n&&v([[{}],[{[e]:[l,s?t:a()]}],1])})),he(u,((e,t)=>I[t]=M(t,"set")||M(t,"del")||M(t,"apply")||V(t,"Transaction")||t=="call"+i?(...t)=>(e(...t),I):M(t,c)&&V(t,i)?(...n)=>{var l;const s=null!=(l=Yt[N(t,3,-8)])?l:0,r=n[s];return n[s]=(e,...t)=>r(I,...t),e(...n)}:"isMergeable"==t?()=>!0:e)),de(I)},exports.createMetrics=gt,exports.createQueries=bt,exports.createRelationships=It,exports.createStore=At,exports.defaultSorter=at,exports.getUniqueId=it;
