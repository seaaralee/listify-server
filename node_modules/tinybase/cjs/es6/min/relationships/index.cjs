"use strict";const e=e=>typeof e,n="",l=e(n),t=e=>null==e,r=(e,n,l)=>t(e)?void 0:n(e),o=e=>Array.isArray(e),s=e=>e.length,i=(e,n)=>e.forEach(n),u=(e,...n)=>e.push(...n),d=Object.freeze,a=e=>n=>{return l=(n,l)=>n+e(l),f(n).reduce(l,0);var l},c=e=>{var n;return null!=(n=null==e?void 0:e.size)?n:0},v=a(c),R=a(v),h=(e,n)=>{var l;return null!=(l=null==e?void 0:e.has(n))&&l},w=e=>t(e)||0==c(e),f=e=>{var n;return[...null!=(n=null==e?void 0:e.values())?n:[]]},L=e=>e.clear(),I=(e,n)=>null==e?void 0:e.forEach(n),g=(e,n)=>null==e?void 0:e.delete(n),p=e=>new Map(e),y=(e,n)=>null==e?void 0:e.get(n),b=(e,n)=>I(e,((e,l)=>n(l,e))),k=(e,n,l)=>t(l)?(g(e,n),e):null==e?void 0:e.set(n,l),m=(e,n,l,t)=>(h(e,n)?null==t||t(y(e,n)):k(e,n,l()),y(e,n)),E=(e,n,l,t,o=0)=>r((l?m:y)(e,n[o],o>s(n)-2?l:p),(r=>{if(o>s(n)-2)return(null==t?void 0:t(r))&&k(e,n[o]),r;const i=E(r,n,l,t,o+1);return w(r)&&k(e,n[o]),i})),T=e=>new Set(o(e)||t(e)?e:[e]),S=(e,n)=>null==e?void 0:e.add(n),z=/^\d+$/,A=(()=>{const a=new WeakMap;return c=>(a.has(c)||a.set(c,(a=>{const c=p(),v=p(),A=p(),D=p(),[M,j,x]=(()=>{let e;const[l,o]=(()=>{const e=[];let l=0;return[t=>{var r;return null!=(r=t?e.shift():null)?r:n+l++},n=>{z.test(n)&&s(e)<1e3&&u(e,n)}]})(),d=p();return[(t,r,o,s=[],i=()=>[])=>{null!=e||(e=Q);const u=l(1);return k(d,u,[t,r,o,s,i]),S(E(r,null!=o?o:[n],T),u),u},(l,t,...r)=>i(((e,l=[n])=>{const t=[],r=(e,n)=>n==s(l)?u(t,e):null===l[n]?I(e,(e=>r(e,n+1))):i([l[n],null],(l=>r(y(e,l),n+1)));return r(e,0),t})(l,t),(n=>I(n,(n=>y(d,n)[0](e,...null!=t?t:[],...r))))),e=>r(y(d,e),(([,l,t])=>(E(l,null!=t?t:[n],void 0,(n=>(g(n,e),w(n)?1:0))),k(d,e),o(e),t))),n=>r(y(d,n),(([n,,l=[],r,o])=>{const u=(...d)=>{var a,c;const v=s(d);v==s(l)?n(e,...d,...o(d)):t(l[v])?i(null!=(c=null==(a=r[v])?void 0:a.call(r,...d))?c:[],(e=>u(...d,e))):u(...d,l[v])};u()}))]})(),[C,O,W,$,q,B,,,F,G,H,J]=((e,l,u,d,a)=>{const c=e.hasRow,v=p(),R=p(),E=p(),z=p(),A=p(),D=p(),M=(n,l,...t)=>{const r=m(D,n,T);return i(t,(n=>S(r,n)&&l&&e.callListener(n))),t},j=(n,...l)=>r(y(D,n),(t=>{i(0==s(l)?f(t):l,(n=>{e.delListener(n),g(t,n)})),w(t)&&k(D,n)})),x=(e,n)=>{k(v,e,n),h(R,e)||(k(R,e,[p(),p(),p(),p()]),k(z,e,p()),k(A,e,p()),a(E))},C=e=>{k(v,e),k(R,e),k(z,e),k(A,e),j(e),a(E)};return[()=>e,()=>{return[...null!=(n=null==(e=v)?void 0:e.keys())?n:[]];var e,n},e=>b(R,e),e=>h(R,e),e=>y(v,e),e=>y(R,e),(e,n)=>k(R,e,n),x,(l,r,u,d,a)=>{x(l,r);const v=p(),R=p(),w=y(z,l),f=y(A,l),g=l=>{const i=n=>e.getCell(r,l,n),u=y(w,l),h=c(r,l)?(L=d(i,l),t(L)?void 0:L+n):void 0;var L,I,g,p;if(u===h||o(u)&&o(h)&&(g=h,s(I=u)===s(g)&&(p=(e,n)=>g[n]===e,I.every(p)))||k(v,l,[u,h]),!t(a)){const e=y(f,l),n=c(r,l)?a(i,l):void 0;e!=n&&k(R,l,n)}},m=e=>{u((()=>{I(v,(([,e],n)=>k(w,n,e))),I(R,((e,n)=>k(f,n,e)))}),v,R,w,f,e),L(v),L(R)};b(w,g),e.hasTable(r)&&i(e.getRowIds(r),(e=>{h(w,e)||g(e)})),m(!0),j(l),M(l,0,e.addRowListener(r,null,((e,n,l)=>g(l))),e.addTableListener(r,(()=>m())))},C,e=>d(e,E),()=>b(D,C),M,j]})(a,0,0,M,j),K=(e,n,l)=>r(B(e),(([r,,o])=>{if(!h(o,n)){const s=T();if(q(e)!=P(e))S(s,n);else{let e=n;for(;!t(e)&&!h(s,e);)S(s,e),e=y(r,e)}if(l)return s;k(o,n,s)}return y(o,n)})),N=(e,n)=>r(B(e),(([,,e])=>k(e,n))),P=e=>y(c,e),Q={setRelationshipDefinition:(o,s,i,u)=>{return k(c,o,i),F(o,s,((e,n)=>{const l=T(),s=T(),i=T(),[u,d]=B(o);I(n,(([e,n],a)=>{t(e)||(S(s,e),r(y(d,e),(n=>{g(n,a),w(n)&&k(d,e)}))),t(n)||(S(s,n),h(d,n)||k(d,n,T()),S(y(d,n),a)),S(l,a),k(u,a,n),b(y(D,o),(e=>{h(K(o,e),a)&&S(i,e)}))})),e(),I(l,(e=>j(v,[o,e]))),I(s,(e=>j(A,[o,e]))),I(i,(e=>{N(o,e),j(D,[o,e])}))}),e(d=u)==l?e=>e(d):null!=d?d:()=>n),Q;var d},delRelationshipDefinition:e=>(k(c,e),G(e),Q),getStore:C,getRelationshipIds:O,forEachRelationship:e=>W((n=>e(n,(e=>a.forEachRow(q(n),e))))),hasRelationship:$,getLocalTableId:q,getRemoteTableId:P,getRemoteRowId:(e,n)=>{var l;return y(null==(l=B(e))?void 0:l[0],n)},getLocalRowIds:(e,n)=>{var l;return f(y(null==(l=B(e))?void 0:l[1],n))},getLinkedRowIds:(e,n)=>t(B(e))?[n]:f(K(e,n,!0)),addRelationshipIdsListener:H,addRemoteRowIdListener:(e,n,l)=>M(l,v,[e,n]),addLocalRowIdsListener:(e,n,l)=>M(l,A,[e,n]),addLinkedRowIdsListener:(e,n,l)=>(K(e,n),M(l,D,[e,n])),delListener:e=>{var n;return N(...null!=(n=x(e))?n:[]),Q},destroy:J,getListenerStats:()=>({remoteRowId:R(v),localRowIds:R(A),linkedRowIds:R(D)})};return d(Q)})(c)),a.get(c))})();exports.createRelationships=A;
