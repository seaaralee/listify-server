"use strict";const e=e=>typeof e,t="",s=e(t),a=e(!0),l=e(0),n=e(e),r="type",o="default",c="Has",i="Ids",d="Table",u=d+"s",h=d+i,f="Row",g=f+"Count",T=f+i,b="Cell",v=b+i,C="Value",V=C+"s",w=C+i,S=e=>t+e,I=isFinite,y=e=>null==e,R=(e,t,s)=>y(e)?s?.():t(e),m=e=>e==s||e==a,p=t=>e(t)==n,L=e=>Array.isArray(e),J=(e,t,s)=>e.slice(t,s),E=e=>e.length,F=(e,t)=>e.forEach(t),O=(e,t)=>e.map(t),z=(e,...t)=>e.push(...t),M=Object,P=e=>M.getPrototypeOf(e),k=M.entries,A=M.isFrozen,N=e=>!y(e)&&R(P(e),(e=>e==M.prototype||y(P(e))),(()=>!0)),j=M.keys,x=M.freeze,D=(e,t)=>t in e,H=(e,t)=>(delete e[t],e),W=(e,t)=>O(k(e),(([e,s])=>t(s,e))),$=e=>N(e)&&0==(e=>E(j(e)))(e),q=(e,t,s,a=0)=>y(e)||!N(e)||!a&&$(e)||A(e)?(s?.(),!1):(W(e,((s,a)=>{t(s,a)||H(e,a)})),!!a||!$(e)),B=e=>t=>{return s=(t,s)=>t+e(s),Z(t).reduce(s,0);var s},G=e=>e?.size??0,K=B(G),Q=B(K),U=B(Q),X=(e,t)=>e?.has(t)??!1,Y=e=>y(e)||0==G(e),Z=e=>[...e?.values()??[]],_=e=>e.clear(),ee=(e,t)=>e?.forEach(t),te=(e,t)=>e?.delete(t),se=e=>new Map(e),ae=e=>[...e?.keys()??[]],le=(e,t)=>e?.get(t),ne=(e,t)=>ee(e,((e,s)=>t(s,e))),re=(e,t,s)=>y(s)?(te(e,t),e):e?.set(t,s),oe=(e,t,s,a)=>(X(e,t)?a?.(le(e,t)):re(e,t,s()),le(e,t)),ce=(e,t,s,a=re)=>(W(t,((t,a)=>s(e,a,t))),ne(e,(s=>D(t,s)?0:a(e,s))),e),ie=(e,t,s,a)=>{const l={};return ee(e,((e,n)=>{if(!s?.(e,n)){const s=t?t(e,n):e;a?.(s)||(l[n]=s)}})),l},de=(e,t,s)=>ie(e,(e=>ie(e,t,s)),Y,$),ue=(e,t,s)=>ie(e,(e=>de(e,t,s)),Y,$),he=(e,t)=>{const s=se();return ee(e,((e,a)=>s.set(a,t?.(e)??e))),s},fe=e=>he(e,he),ge=e=>he(e,fe),Te=(e,t,s,a,l=0)=>R((s?oe:le)(e,t[l],l>E(t)-2?s:se),(n=>{if(l>E(t)-2)return a?.(n)&&re(e,t[l]),n;const r=Te(n,t,s,a,l+1);return Y(n)&&re(e,t[l]),r})),be=e=>new Set(L(e)||y(e)?e:[e]),ve=(e,t)=>e?.add(t),Ce=/^\d+$/,Ve=()=>{const e=[];let s=0;return[a=>(a?e.shift():null)??t+s++,t=>{Ce.test(t)&&E(e)<1e3&&z(e,t)}]},we=e=>[e,e],Se=(e,t=K)=>t(e[0])+t(e[1]),Ie=()=>[se(),se()],ye=e=>[...e],Re=([e,t])=>e===t,me=t=>{const s=e(t);return m(s)||s==l&&I(t)?s:void 0},pe=(e,t,s,a,l)=>y(l)?e.delCell(t,s,a,!0):e.setCell(t,s,a,l),Le=(e,t,s)=>y(s)?e.delValue(t):e.setValue(t,s),Je=JSON.stringify,Ee=JSON.parse,Fe=e=>Je(e,((e,t)=>t instanceof Map?M.fromEntries([...t]):t)),Oe=(e,t,s)=>re(e,t,le(e,t)==-s?void 0:s),ze=()=>{let e,s,a=!1,n=!1,i=0,I=[];const M=se(),P=se(),k=se(),A=se(),N=se(),j=se(),B=se(),Z=se(),Ce=se(),Je=se(),Me=se(),Pe=se(),ke=se(),Ae=se(),Ne=be(),je=se(),xe=se(),De=se(),He=se(),We=Ie(),$e=Ie(),qe=Ie(),Be=Ie(),Ge=Ie(),Ke=Ie(),Qe=Ie(),Ue=Ie(),Xe=Ie(),Ye=Ie(),Ze=Ie(),_e=Ie(),et=Ie(),tt=Ie(),st=Ie(),at=Ie(),lt=Ie(),nt=Ie(),rt=Ie(),ot=Ie(),ct=Ie(),it=Ie(),dt=se(),ut=Ie(),[ht,ft,gt,Tt]=(()=>{let e;const[s,a]=Ve(),l=se();return[(a,n,r,o=[],c=()=>[])=>{e??=ks;const i=s(1);return re(l,i,[a,n,r,o,c]),ve(Te(n,r??[t],be),i),i},(s,a,...n)=>F(((e,s=[t])=>{const a=[],l=(e,t)=>t==E(s)?z(a,e):null===s[t]?ee(e,(e=>l(e,t+1))):F([s[t],null],(s=>l(le(e,s),t+1)));return l(e,0),a})(s,a),(t=>ee(t,(t=>le(l,t)[0](e,...a??[],...n))))),e=>R(le(l,e),(([,s,n])=>(Te(s,n??[t],void 0,(t=>(te(t,e),Y(t)?1:0))),re(l,e),a(e),n))),t=>R(le(l,t),(([t,,s=[],a,l])=>{const n=(...r)=>{const o=E(r);o==E(s)?t(e,...r,...l(r)):y(s[o])?F(a[o]?.(...r)??[],(e=>n(...r,e))):n(...r,s[o])};n()}))]})(),bt=e=>{if(!q(e,((e,t)=>[r,o].includes(t))))return!1;const t=e[r];return!(!m(t)&&t!=l||(me(e[o])!=t&&H(e,o),0))},vt=L,Ct=(t,s)=>(!e||X(Me,s)||Kt(s))&&q(t,((e,t)=>Vt(s,t,e)),(()=>Kt(s))),Vt=(e,t,s,a)=>q(a?s:yt(s,e,t),((a,l)=>R(wt(e,t,l,a),(e=>(s[l]=e,!0)),(()=>!1))),(()=>Kt(e,t))),wt=(t,s,a,l)=>e?R(le(le(Me,t),a),(e=>me(l)!=e[r]?Kt(t,s,a,l,e[o]):l),(()=>Kt(t,s,a,l))):y(me(l))?Kt(t,s,a,l):l,St=(e,t)=>q(t?e:Rt(e),((t,s)=>R(It(s,t),(t=>(e[s]=t,!0)),(()=>!1))),(()=>Qt())),It=(e,t)=>s?R(le(ke,e),(s=>me(t)!=s[r]?Qt(e,t,s[o]):t),(()=>Qt(e,t))):y(me(t))?Qt(e,t):t,yt=(e,t,s)=>(R(le(Pe,t),(([a,l])=>{ee(a,((t,s)=>{D(e,s)||(e[s]=t)})),ee(l,(a=>{D(e,a)||Kt(t,s,a)}))})),e),Rt=e=>(s&&(ee(Ae,((t,s)=>{D(e,s)||(e[s]=t)})),ee(Ne,(t=>{D(e,t)||Qt(t)}))),e),mt=e=>ce(Me,e,((e,t,s)=>{const a=se(),l=be();ce(oe(Me,t,se),s,((e,t,s)=>{re(e,t,s),R(s[o],(e=>re(a,t,e)),(()=>ve(l,t)))})),re(Pe,t,[a,l])}),((e,t)=>{re(Me,t),re(Pe,t)})),pt=e=>ce(ke,e,((e,t,s)=>{re(ke,t,s),R(s[o],(e=>re(Ae,t,e)),(()=>ve(Ne,t)))}),((e,t)=>{re(ke,t),re(Ae,t),te(Ne,t)})),Lt=e=>$(e)?ps():Ss(e),Jt=e=>ce(De,e,((e,t,s)=>Et(t,s)),((e,t)=>Nt(t))),Et=(e,t)=>ce(oe(De,e,(()=>(Ht(e,1),re(je,e,Ve()),re(xe,e,se()),se()))),t,((t,s,a)=>Ft(e,t,s,a)),((t,s)=>jt(e,t,s))),Ft=(e,t,s,a,l)=>ce(oe(t,s,(()=>(Wt(e,s,1),se()))),a,((t,a,l)=>Ot(e,s,t,a,l)),((a,n)=>xt(e,t,s,a,n,l))),Ot=(e,t,s,a,l)=>{X(s,a)||$t(e,t,a,1);const n=le(s,a);l!==n&&(qt(e,t,a,n,l),re(s,a,l))},zt=(e,t,s,a,l)=>R(le(t,s),(t=>Ot(e,s,t,a,l)),(()=>Ft(e,t,s,yt({[a]:l},e,s)))),Mt=e=>$(e)?Es():Is(e),Pt=e=>ce(He,e,((e,t,s)=>kt(t,s)),((e,t)=>Dt(t))),kt=(e,t)=>{X(He,e)||Bt(e,1);const s=le(He,e);t!==s&&(Gt(e,s,t),re(He,e,t))},At=e=>le(De,e)??Et(e,{}),Nt=e=>Et(e,{}),jt=(e,t,s)=>{const[,a]=le(je,e);a(s),Ft(e,t,s,{},!0)},xt=(e,t,s,a,l,n)=>{const r=le(le(Pe,e)?.[0],l);if(!y(r)&&!n)return Ot(e,s,a,l,r);const o=t=>{qt(e,s,t,le(a,t)),$t(e,s,t,-1),re(a,t)};y(r)?o(l):ne(a,o),Y(a)&&(Wt(e,s,-1),Y(re(t,s))&&(Ht(e,-1),re(De,e),re(je,e),re(xe,e)))},Dt=e=>{const t=le(Ae,e);if(!y(t))return kt(e,t);Gt(e,le(He,e)),Bt(e,-1),re(He,e)},Ht=(e,t)=>Oe(M,e,t),Wt=(e,t,s)=>Oe(oe(A,e,se),t,s)&&re(k,e,oe(k,e,(()=>0))+s),$t=(e,t,s,a)=>{const l=le(xe,e),n=le(l,s)??0;(0==n&&1==a||1==n&&-1==a)&&Oe(oe(P,e,se),s,a),re(l,s,n!=-a?n+a:null),Oe(oe(oe(N,e,se),t,se),s,a)},qt=(e,t,s,a,l)=>{oe(oe(oe(j,e,se),t,se),s,(()=>[a,0]))[1]=l,I[3]?.(e,t,s,l)},Bt=(e,t)=>Oe(B,e,t),Gt=(e,t,s)=>{oe(Z,e,(()=>[t,0]))[1]=s,I[4]?.(e,s)},Kt=(e,t,s,a,l)=>(z(oe(oe(oe(Ce,e,se),t,se),s,(()=>[])),a),l),Qt=(e,t,s)=>(z(oe(Je,e,(()=>[])),t),s),Ut=(e,t,s)=>R(le(le(le(j,e),t),s),(([e,t])=>[!0,e,t]),(()=>[!1,...we(ds(e,t,s))])),Xt=e=>R(le(Z,e),(([e,t])=>[!0,e,t]),(()=>[!1,...we(fs(e))])),Yt=e=>Y(Ce)||Y(at[e])?0:ee(e?ge(Ce):Ce,((t,s)=>ee(t,((t,a)=>ee(t,((t,l)=>ft(at[e],[s,a,l],t))))))),Zt=e=>Y(Je)||Y(lt[e])?0:ee(e?he(Je):Je,((t,s)=>ft(lt[e],[s],t))),_t=(e,t,s,a)=>{if(!Y(e))return ft(t,a,(()=>ie(e))),ne(e,((e,t)=>ft(s,[...a??[],e],1==t))),1},es=e=>{const t=gs();t!=a&&ft(We[e],void 0,t);const s=Y(Ye[e]),l=Y(et[e])&&Y(tt[e])&&Y(Xe[e])&&Y(Ze[e])&&Y(Ke[e])&&Y(Qe[e])&&Y(Ue[e])&&s&&Y(qe[e])&&Y(Be[e]),n=Y(st[e])&&Y(_e[e])&&Y(Ge[e])&&Y($e[e]);if(!l||!n){const t=e?[he(M),fe(P),he(k),fe(A),ge(N),ge(j)]:[M,P,k,A,N,j];if(!l){_t(t[0],qe[e],Be[e]),ee(t[1],((t,s)=>_t(t,Ke[e],Qe[e],[s]))),ee(t[2],((t,s)=>{0!=t&&ft(Ue[e],[s],rs(s))}));const a=be();ee(t[3],((t,l)=>{_t(t,Xe[e],Ze[e],[l])&&!s&&(ft(Ye[e],[l,null]),ve(a,l))})),s||ee(t[5],((t,s)=>{if(!X(a,s)){const a=be();ee(t,(e=>ee(e,(([t,s],l)=>s!==t?ve(a,l):te(e,l))))),ee(a,(t=>ft(Ye[e],[s,t])))}})),ee(t[4],((t,s)=>ee(t,((t,a)=>_t(t,et[e],tt[e],[s,a])))))}if(!n){let s;ee(t[5],((t,a)=>{let l;ee(t,((t,n)=>{let r;ee(t,(([t,o],c)=>{o!==t&&(ft(st[e],[a,n,c],o,t,Ut),s=l=r=1)})),r&&ft(_e[e],[a,n],Ut)})),l&&ft(Ge[e],[a],Ut)})),s&&ft($e[e],void 0,Ut)}}},ts=e=>{const t=Vs();t!=n&&ft(nt[e],void 0,t);const s=Y(ot[e])&&Y(ct[e]),a=Y(it[e])&&Y(rt[e]);if(!s||!a){const t=e?[he(B),he(Z)]:[B,Z];if(s||_t(t[0],ot[e],ct[e]),!a){let s;ee(t[1],(([t,a],l)=>{a!==t&&(ft(it[e],[l],a,t,Xt),s=1)})),s&&ft(rt[e],void 0,Xt)}}},ss=(e,...t)=>(zs((()=>e(...O(t,S)))),ks),as=()=>ue(De),ls=()=>ae(De),ns=e=>ae(le(xe,S(e))),rs=e=>G(le(De,S(e))),os=e=>ae(le(De,S(e))),cs=(e,t,s,a=0,l)=>{return O(J((r=le(De,S(e)),o=(e,s)=>[y(t)?s:le(e,S(t)),s],n=([e],[t])=>((e??0)<(t??0)?-1:1)*(s?-1:1),O([...r?.entries()??[]],(([e,t])=>o(t,e))).sort(n)),a,y(l)?l:a+l),(([,e])=>e));var n,r,o},is=(e,t)=>ae(le(le(De,S(e)),S(t))),ds=(e,t,s)=>le(le(le(De,S(e)),S(t)),S(s)),us=()=>ie(He),hs=()=>ae(He),fs=e=>le(He,S(e)),gs=()=>!Y(De),Ts=e=>X(De,S(e)),bs=(e,t)=>X(le(xe,S(e)),S(t)),vs=(e,t)=>X(le(De,S(e)),S(t)),Cs=(e,t,s)=>X(le(le(De,S(e)),S(t)),S(s)),Vs=()=>!Y(He),ws=e=>X(He,S(e)),Ss=e=>ss((()=>(e=>q(e,Ct,Kt))(e)?Jt(e):0)),Is=e=>ss((()=>St(e)?Pt(e):0)),ys=e=>{try{Lt(Ee(e))}catch{}return ks},Rs=t=>ss((()=>{if((e=q(t,(e=>q(e,bt))))&&(mt(t),!Y(De))){const e=as();ps(),Ss(e)}})),ms=e=>ss((()=>{if(s=(e=>q(e,bt))(e)){const t=us();Os(),Es(),s=!0,pt(e),Is(t)}})),ps=()=>ss((()=>Jt({}))),Ls=e=>ss((e=>X(De,e)?Nt(e):0),e),Js=(e,t)=>ss(((e,t)=>R(le(De,e),(s=>X(s,t)?jt(e,s,t):0))),e,t),Es=()=>ss((()=>Pt({}))),Fs=()=>ss((()=>{mt({}),e=!1})),Os=()=>ss((()=>{pt({}),s=!1})),zs=(e,t)=>{if(-1!=i){Ms();const s=e();return Ps(t),s}},Ms=()=>(-1!=i&&i++,1==i&&(I[0]?.(),ft(dt)),ks),Ps=e=>(i>0&&(i--,0==i&&(i=1,Yt(1),Y(j)||es(1),Zt(1),Y(Z)||ts(1),e?.(ks)&&(ee(j,((e,t)=>ee(e,((e,s)=>ee(e,(([e],a)=>pe(ks,t,s,a,e))))))),_(j),ee(Z,(([e],t)=>Le(ks,t,e))),_(Z)),ft(ut[0],void 0),i=-1,Yt(0),Y(j)||es(0),Zt(0),Y(Z)||ts(0),I[1]?.(),ft(ut[1],void 0),I[2]?.(),i=0,a=gs(),n=Vs(),F([M,P,k,A,N,j,Ce,B,Z,Je],_))),ks),ks={getContent:()=>[as(),us()],getTables:as,getTableIds:ls,getTable:e=>de(le(De,S(e))),getTableCellIds:ns,getRowCount:rs,getRowIds:os,getSortedRowIds:cs,getRow:(e,t)=>ie(le(le(De,S(e)),S(t))),getCellIds:is,getCell:ds,getValues:us,getValueIds:hs,getValue:fs,hasTables:gs,hasTable:Ts,hasTableCell:bs,hasRow:vs,hasCell:Cs,hasValues:Vs,hasValue:ws,getTablesJson:()=>Fe(De),getValuesJson:()=>Fe(He),getJson:()=>Fe([De,He]),getTablesSchemaJson:()=>Fe(Me),getValuesSchemaJson:()=>Fe(ke),getSchemaJson:()=>Fe([Me,ke]),hasTablesSchema:()=>e,hasValuesSchema:()=>s,setContent:e=>ss((()=>{const t=p(e)?e():e;vt(t)&&(([e,t])=>{($(e)?ps:Ss)(e),($(t)?Es:Is)(t)})(t)})),setTables:Ss,setTable:(e,t)=>ss((e=>Ct(t,e)?Et(e,t):0),e),setRow:(e,t,s)=>ss(((e,t)=>Vt(e,t,s)?Ft(e,At(e),t,s):0),e,t),addRow:(e,t,s=!0)=>zs((()=>{let a;return Vt(e,a,t)&&(e=S(e),Ft(e,At(e),a=((e,t)=>{const[s]=le(je,e);let a;do{a=s(t)}while(X(le(De,e),a));return a})(e,s?1:0),t)),a})),setPartialRow:(e,t,s)=>ss(((e,t)=>{if(Vt(e,t,s,1)){const a=At(e);W(s,((s,l)=>zt(e,a,t,l,s)))}}),e,t),setCell:(e,t,s,a)=>ss(((e,t,s)=>R(wt(e,t,s,p(a)?a(ds(e,t,s)):a),(a=>zt(e,At(e),t,s,a)))),e,t,s),setValues:Is,setPartialValues:e=>ss((()=>St(e,1)?W(e,((e,t)=>kt(t,e))):0)),setValue:(e,t)=>ss((e=>R(It(e,p(t)?t(fs(e)):t),(t=>kt(e,t)))),e),applyChanges:e=>ss((()=>{W(e[0],((e,t)=>y(e)?Ls(t):W(e,((e,s)=>y(e)?Js(t,s):W(e,((e,a)=>pe(ks,t,s,a,e))))))),W(e[1],((e,t)=>Le(ks,t,e)))})),setTablesJson:ys,setValuesJson:e=>{try{Mt(Ee(e))}catch{}return ks},setJson:e=>ss((()=>{try{const[t,s]=Ee(e);Lt(t),Mt(s)}catch{ys(e)}})),setTablesSchema:Rs,setValuesSchema:ms,setSchema:(e,t)=>ss((()=>{Rs(e),ms(t)})),delTables:ps,delTable:Ls,delRow:Js,delCell:(e,t,s,a)=>ss(((e,t,s)=>R(le(De,e),(l=>R(le(l,t),(n=>X(n,s)?xt(e,l,t,n,s,a):0))))),e,t,s),delValues:Es,delValue:e=>ss((e=>X(He,e)?Dt(e):0),e),delTablesSchema:Fs,delValuesSchema:Os,delSchema:()=>ss((()=>{Fs(),Os()})),transaction:zs,startTransaction:Ms,getTransactionChanges:()=>[ie(j,((e,t)=>-1===le(M,t)?void 0:ie(e,((e,s)=>-1===le(le(A,t),s)?void 0:ie(e,(([,e])=>e),(e=>Re(e)))),Y,$)),Y,$),ie(Z,(([,e])=>e),(e=>Re(e))),1],getTransactionLog:()=>[!Y(j),!Y(Z),ue(j,ye,Re),ue(Ce),ie(Z,ye,Re),ie(Je),ie(M),de(A),ue(N),ie(B)],finishTransaction:Ps,forEachTable:e=>ee(De,((t,s)=>e(s,(e=>ee(t,((t,s)=>e(s,(e=>ne(t,e))))))))),forEachTableCell:(e,t)=>ne(le(xe,S(e)),t),forEachRow:(e,t)=>ee(le(De,S(e)),((e,s)=>t(s,(t=>ne(e,t))))),forEachCell:(e,t,s)=>ne(le(le(De,S(e)),S(t)),s),forEachValue:e=>ne(He,e),addSortedRowIdsListener:(e,t,s,a,l,n,r)=>{let o=cs(e,t,s,a,l);return ht((()=>{const r=cs(e,t,s,a,l);var c,i,d;i=o,E(c=r)===E(i)&&(d=(e,t)=>i[t]===e,c.every(d))||(o=r,n(ks,e,t,s,a,l,o))}),Ye[r?1:0],[e,t],[ls])},addStartTransactionListener:e=>ht(e,dt),addWillFinishTransactionListener:e=>ht(e,ut[0]),addDidFinishTransactionListener:e=>ht(e,ut[1]),callListener:e=>(Tt(e),ks),delListener:e=>(gt(e),ks),getListenerStats:()=>({hasTables:Se(We),tables:Se($e),tableIds:Se(qe),hasTable:Se(Be),table:Se(Ge),tableCellIds:Se(Ke),hasTableCell:Se(Qe,Q),rowCount:Se(Ue),rowIds:Se(Xe),sortedRowIds:Se(Ye),hasRow:Se(Ze,Q),row:Se(_e,Q),cellIds:Se(et,Q),hasCell:Se(tt,U),cell:Se(st,U),invalidCell:Se(at,U),hasValues:Se(nt),values:Se(rt),valueIds:Se(ot),hasValue:Se(ct),value:Se(it),invalidValue:Se(lt),transaction:K(dt)+Se(ut)}),isMergeable:()=>!1,createStore:ze,addListener:ht,callListeners:ft,setInternalListeners:(e,t,s,a,l)=>I=[e,t,s,a,l]};return W({[c+u]:[0,We,[],()=>[gs()]],[u]:[0,$e],[h]:[0,qe],[c+d]:[1,Be,[ls],e=>[Ts(...e)]],[d]:[1,Ge,[ls]],[d+v]:[1,Ke,[ls]],[c+d+b]:[2,Qe,[ls,ns],e=>[bs(...e)]],[g]:[1,Ue,[ls]],[T]:[1,Xe,[ls]],[c+f]:[2,Ze,[ls,os],e=>[vs(...e)]],[f]:[2,_e,[ls,os]],[v]:[2,et,[ls,os]],[c+b]:[3,tt,[ls,os,is],e=>[Cs(...e)]],[b]:[3,st,[ls,os,is],e=>we(ds(...e))],InvalidCell:[3,at],[c+V]:[0,nt,[],()=>[Vs()]],[V]:[0,rt],[w]:[0,ot],[c+C]:[1,ct,[hs],e=>[ws(...e)]],[C]:[1,it,[hs],e=>we(fs(e[0]))],InvalidValue:[1,lt]},(([e,t,s,a],l)=>{ks["add"+l+"Listener"]=(...l)=>ht(l[e],t[l[e+1]?1:0],e>0?J(l,0,e):void 0,s,a)})),x(ks)};exports.createStore=ze;
